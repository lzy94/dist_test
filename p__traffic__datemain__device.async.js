(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{hoqc:function(e,a,t){"use strict";t.r(a);var l,n=t("pVnL"),i=t.n(n),r=(t("IzEo"),t("bx4M")),s=(t("14J3"),t("BMrR")),o=(t("jCWc"),t("kPKH")),c=(t("miYZ"),t("tsqr")),d=t("MVZn"),p=t.n(d),m=(t("P2fV"),t("NJEC")),u=(t("/zsF"),t("PArb")),h=(t("5Dmo"),t("3S7+")),f=(t("+L6B"),t("2/Rp")),g=t("lwsE"),b=t.n(g),E=t("W8MJ"),y=t.n(E),C=t("a1gu"),v=t.n(C),S=t("Nsbk"),w=t.n(S),k=t("PJYZ"),F=t.n(k),V=t("7W2i"),M=t.n(V),D=(t("2qtc"),t("kLXV")),N=(t("5NDa"),t("5rEg")),q=(t("OaEy"),t("2fM7")),L=(t("y8nQ"),t("Vl3Y")),x=t("q1tI"),B=t.n(x),I=t("MuoO"),O=t("mf+E"),R=t("CkN6"),U=t("9zHi"),T=t.n(U),J=t("ns75"),z=t.n(J),P=t("+n12"),j=t("ZP6J"),A=t.n(j),Z=L.a.Item,H=q.a.Option,W=["APP","PC","执法仪","其它"],Y=["/datemain/device"],K=L.a.create()(function(e){var a=e.modalVisible,t=e.form,l=e.handleAdd,n=e.handleModalVisible,i=e.userSite,r=e.siteSelectChange;return B.a.createElement(D.a,{destroyOnClose:!0,title:"添加设备",className:A.a.formModal,visible:a,onOk:function(){t.validateFields(function(e,a){e||(t.resetFields(),l(a))})},onCancel:function(){return n()}},B.a.createElement("div",{className:A.a.formModalBody},B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"设备名称"},t.getFieldDecorator("equipmentName",{rules:[{required:!0,message:"请输入设备名称！"}]})(B.a.createElement(N.a,{placeholder:"请输入"}))),B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"设备编码"},t.getFieldDecorator("equipmentCode",{rules:[{required:!0,message:"请输入设备编码！"}]})(B.a.createElement(N.a,{placeholder:"请输入"}))),B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"所属人员"},t.getFieldDecorator("userId",{rules:[{required:!0,message:"请输入所属人员！"}]})(B.a.createElement(N.a,{placeholder:"请输入"}))),B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"站点"},t.getFieldDecorator("siteIndex",{rules:[{required:!0,message:"请选择站点！"}]})(B.a.createElement(q.a,{placeholder:"请选择",style:{width:"100%"},onChange:r},i.map(function(e,a){return B.a.createElement(H,{key:a,value:a},e.name)})))),B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"设备类型"},t.getFieldDecorator("type",{rules:[{required:!0,message:"请选择设备类型！"}]})(B.a.createElement(q.a,{placeholder:"请选择",style:{width:"100%"}},W.map(function(e,a){return B.a.createElement(H,{key:a,value:a+1},e)}))))))}),G=L.a.create()(function(e){var a=e.modalVisible,t=e.form,l=e.handleUpdate,n=e.handleModalVisible,i=e.userSite,r=e.siteSelectChange,s=e.detail;return B.a.createElement(D.a,{destroyOnClose:!0,title:"编辑设备",className:A.a.formModal,visible:a,onOk:function(){t.validateFields(function(e,a){e||(t.resetFields(),l(a))})},onCancel:function(){return n()}},B.a.createElement("div",{className:A.a.formModalBody},B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"设备名称"},t.getFieldDecorator("equipmentName",{initialValue:s.equipmentName,rules:[{required:!0,message:"请输入设备名称！"}]})(B.a.createElement(N.a,{placeholder:"请输入"}))),B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"设备编码"},t.getFieldDecorator("equipmentCode",{initialValue:s.equipmentCode,rules:[{required:!0,message:"请输入设备编码！"}]})(B.a.createElement(N.a,{disabled:!0,placeholder:"请输入"}))),B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"所属人员"},t.getFieldDecorator("userId",{initialValue:s.userId,rules:[{required:!0,message:"请输入所属人员！"}]})(B.a.createElement(N.a,{placeholder:"请输入"}))),B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"站点"},t.getFieldDecorator("siteIndex",{initialValue:function(e){for(var a="",t=0;t<i.length;t++)if(e===i[t].code){a=i[t].name;break}return a}(s.siteCode),rules:[{required:!0,message:"请选择站点！"}]})(B.a.createElement(q.a,{placeholder:"请选择",style:{width:"100%"},onChange:r},i.map(function(e,a){return B.a.createElement(H,{key:a,value:a},e.name)})))),B.a.createElement(Z,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"设备类型"},t.getFieldDecorator("type",{initialValue:parseInt(s.type),rules:[{required:!0,message:"请选择设备类型！"}]})(B.a.createElement(q.a,{placeholder:"请选择",style:{width:"100%"}},W.map(function(e,a){return B.a.createElement(H,{key:a,value:a+1},e)}))))))}),Q=Object(I.connect)(function(e){return{system:e.system,LawenforDevice:e.LawenforDevice,loading:e.loading.models.LawenforDevice}})(l=L.a.create()(l=function(e){function a(){var e,t;b()(this,a);for(var l=arguments.length,n=new Array(l),i=0;i<l;i++)n[i]=arguments[i];return(t=v()(this,(e=w()(a)).call.apply(e,[this].concat(n)))).state={modalVisible:!1,updateModalVisible:!1,selectedRows:[],formValues:[],userSite:[],detail:{},fieldSite:[],pageBean:{page:1,pageSize:10,showTotal:!0}},t.columns=[{title:"设备名称",dataIndex:"equipmentName"},{title:"设备编码",dataIndex:"equipmentCode"},{title:"设备类型",dataIndex:"type",render:function(e){return W[parseInt(e)-1]}},{title:"站点名称",dataIndex:"siteName"},{title:"所属人员",dataIndex:"userId"},{title:"操作",width:100,render:function(e,a){return B.a.createElement(x.Fragment,null,B.a.createElement(x.Fragment,null,B.a.createElement(h.a,{placement:"left",title:"编辑"},B.a.createElement(f.a,{onClick:function(){return t.showUpdateModal(a)},type:"primary",shape:"circle",icon:"edit",size:"small"})),B.a.createElement(u.a,{type:"vertical"}),B.a.createElement(m.a,{title:"是否删除数据?",onConfirm:function(){return t.dataDel(a.id)},okText:"确定",cancelText:"取消"},B.a.createElement(h.a,{placement:"left",title:"删除"},B.a.createElement(f.a,{type:"danger",shape:"circle",icon:"delete",size:"small"})))))}}],t.getList=function(e){(0,t.props.dispatch)({type:"LawenforDevice/fetch",payload:e})},t.showUpdateModal=function(e){t.setState({detail:e,fieldSite:[e.siteCode,e.siteName]},function(){t.handleUpdateModalVisible(!0)})},t.batchDel=function(){var e=t.state.selectedRows;if(e){var a=F()(t);D.a.confirm({title:"批量删除",content:"您确定要批量删除吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){a.delUtil(e.map(function(e){return e.id}).join())}})}},t.dataDel=function(e){t.delUtil(e)},t.delUtil=function(e){var a=t.props.dispatch,l=t.state.pageBean;a({type:"LawenforDevice/remove",payload:{ids:e},callback:function(){t.setState({selectedRows:[]}),t.getList({pageBean:l})}})},t.getUserSite=function(e,a){(0,t.props.dispatch)({type:"system/userSite",payload:{siteType:e},callback:function(e){var t=e.map(function(e,a){var t=Object.keys(e);return{index:a+1,code:t[0],name:e[t[0]],direction:[e[t[1]],e[t[2]]]}});a(t)}})},t.handleStandardTableChange=function(e){var a=t.state.formValues,l={pageBean:{page:e.current,pageSize:e.pageSize,showTotal:!0},querys:a};t.getList(l)},t.handleFormReset=function(){var e=t.props.form,a=t.state.pageBean;e.resetFields(),t.setState({formValues:[],selectedRows:[]}),t.getList({pageBean:a})},t.handleSelectRows=function(e){t.setState({selectedRows:e})},t.handleSearch=function(e){e.preventDefault(),t.props.form.validateFields(function(e,a){if(!e){var l=t.state.pageBean,n=p()({},a),i=Object.keys(n).map(function(e){return n[e]?{property:e,value:n[e],group:"main",operation:"LIKE",relation:"OR"}:""}).filter(function(e){return e});t.setState({formValues:i}),t.getList({pageBean:l,querys:i})}})},t.handleModalVisible=function(e){t.setState({modalVisible:!!e})},t.handleUpdateModalVisible=function(e){t.setState({updateModalVisible:!!e}),e||t.setState({detail:{}})},t.handleAdd=function(e){var a=t.props.dispatch,l=t.state,n=l.pageBean,i=l.fieldSite;e.siteCode=i[0],e.siteName=i[1],delete e.siteIndex,a({type:"LawenforDevice/add",payload:e,callback:function(){c.a.success("添加成功"),setTimeout(function(){t.handleModalVisible(),t.getList({pageBean:n})},500)}})},t.handleUpdate=function(e){var a=t.props.dispatch,l=t.state,n=l.pageBean,i=l.detail,r=l.fieldSite,s=JSON.parse(JSON.stringify(i));e.id=i.id,e.siteCode=r[0],e.siteName=r[1],delete e.siteIndex;var o=Object.keys(e);for(var d in o)s[o[d]]=e[o[d]];t.setState({detail:s}),a({type:"LawenforDevice/update",payload:e,callback:function(){c.a.success("编辑成功"),setTimeout(function(){t.handleUpdateModalVisible(),t.getList({pageBean:n})},500)}})},t.siteSelectChange=function(e){var a=t.state.userSite;t.setState({fieldSite:[a[e].code,a[e].name]})},t}return M()(a,e),y()(a,[{key:"componentDidMount",value:function(){var e=this;if(Object(P.c)(Y[0])){var a=this.state.pageBean;this.getList({pageBean:a}),this.getUserSite(1,function(a){e.getUserSite(2,function(t){e.setState({userSite:a.concat(t)})})})}}},{key:"renderSimpleForm",value:function(){var e=this.props.form.getFieldDecorator,a=this.state.userSite;return B.a.createElement(L.a,{onSubmit:this.handleSearch,layout:"inline"},B.a.createElement(s.a,{gutter:{md:8,lg:16,xl:32}},B.a.createElement(o.a,{md:5,sm:24},B.a.createElement("div",{className:z.a.inputMain},B.a.createElement("span",{style:{width:"60px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"站点"),B.a.createElement(Z,{style:{flex:1}},e("siteCode")(B.a.createElement(q.a,{className:z.a.inputGroupLeftRadius,placeholder:"请选择"},a.map(function(e,a){return B.a.createElement(H,{key:a,value:e.code},e.name)})))))),B.a.createElement(o.a,{md:5,sm:24},B.a.createElement(Z,null,e("equipmentName")(B.a.createElement(N.a,{addonBefore:"设备名称",placeholder:"请输入"})))),B.a.createElement(o.a,{md:5,sm:24},B.a.createElement(Z,null,e("equipmentCode")(B.a.createElement(N.a,{addonBefore:"设备编码",placeholder:"请输入"})))),B.a.createElement(o.a,{md:5,sm:24},B.a.createElement("span",{className:T.a.submitButtons},B.a.createElement(f.a,{type:"primary",htmlType:"submit"},"查询"),B.a.createElement(f.a,{style:{marginLeft:8},onClick:this.handleFormReset},"重置")))))}},{key:"render",value:function(){var e=this,a=this.props,t=a.LawenforDevice.data,l=a.loading,n=this.state,s=n.selectedRows,o=n.modalVisible,c=n.userSite,d=n.updateModalVisible,p=n.detail,m={handleAdd:this.handleAdd,userSite:c,handleModalVisible:this.handleModalVisible,siteSelectChange:this.siteSelectChange},u={handleUpdate:this.handleUpdate,userSite:c,detail:p,handleModalVisible:this.handleUpdateModalVisible,siteSelectChange:this.siteSelectChange};return B.a.createElement(x.Fragment,null,Object(P.c)(Y[0])?null:B.a.createElement(O.a,{to:"/exception/403"}),B.a.createElement(r.a,{bordered:!1},B.a.createElement("div",{className:T.a.tableList},B.a.createElement("div",{className:T.a.tableListForm},this.renderSimpleForm()),B.a.createElement("div",{className:T.a.tableListOperator},B.a.createElement(f.a,{icon:"plus",type:"primary",onClick:function(){return e.handleModalVisible(!0)}},"新建"),s.length>0&&B.a.createElement("span",null,B.a.createElement(f.a,{type:"danger",onClick:function(){return e.batchDel()}},"批量操作"))),B.a.createElement(R.a,{size:"middle",tableAlert:!0,selectedRows:s,loading:l,data:t,columns:this.columns,onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange}))),B.a.createElement(K,i()({},m,{modalVisible:o})),d&&"{}"!==JSON.stringify(p)?B.a.createElement(G,i()({},u,{modalVisible:d})):null)}}]),a}(x.PureComponent))||l)||l;a.default=Q}}]);