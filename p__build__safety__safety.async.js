(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{"/ebf":function(e,t,a){"use strict";a.r(t);var l=a("pVnL"),n=a.n(l),i=(a("IzEo"),a("bx4M")),r=(a("14J3"),a("BMrR")),o=(a("jCWc"),a("kPKH")),s=(a("5NDa"),a("5rEg")),c=(a("miYZ"),a("tsqr")),d=(a("2qtc"),a("kLXV")),u=(a("P2fV"),a("NJEC")),f=(a("/zsF"),a("PArb")),m=(a("5Dmo"),a("3S7+")),p=(a("+L6B"),a("2/Rp")),h=a("lwsE"),y=a.n(h),g=a("W8MJ"),b=a.n(g),E=a("a1gu"),v=a.n(E),C=a("Nsbk"),S=a.n(C),k=a("7W2i"),x=a.n(k),M=(a("y8nQ"),a("Vl3Y")),B=a("q1tI"),w=a.n(B),F=a("MuoO"),L=a("CkN6"),V=a("MVZn"),D=a.n(V),I=(a("DZo9"),a("8z0m")),q=(a("Pwec"),a("CtXQ")),R=(a("iQDF"),a("+eQT")),j=(a("OaEy"),a("2fM7")),T=a("wd/R"),N=a.n(T),U=a("+n12"),O=a("YP4+"),P=M.a.Item,z=j.a.Option;var Y=M.a.create({mapPropsToFields:function(e){return function(e){for(var t=Object.keys(e),a={},l=0;l<t.length;l+=1)a[t[l]]=M.a.createFormField(D()({},e[t[l]],{value:"inspectorTime"===t[l]?N()(new Date(e[t[l]].value),"YYYY-MM-DD"):e[t[l]].value}));return a}(e.field)},onFieldsChange:function(e,t){e.onChange(t)}})(function(e){var t=e.form,a=e.fileList,l=e.uploadChange,i=e.setCateIndex,c=e.cateIndex;return w.a.createElement(r.a,{gutter:20},w.a.createElement(o.a,{span:12},w.a.createElement(P,{label:"项目名称"},t.getFieldDecorator("projectName",{rules:[{required:!0,message:"请输入项目名称！"}]})(w.a.createElement(s.a,{placeholder:"请输入"}))),w.a.createElement(P,{label:"督查人员"},t.getFieldDecorator("inspectors",{rules:[{required:!0,message:"请输入督查人员！"}]})(w.a.createElement(s.a,{placeholder:"请输入"}))),w.a.createElement(P,{label:"督查时间"},t.getFieldDecorator("inspectorTime",{rules:[{required:!0,message:"请选择督查时间！"}]})(w.a.createElement(R.a,{style:{width:"100%"},placeholder:"请输入"}))),w.a.createElement(P,{label:"问题描述"},t.getFieldDecorator("questionDesc",{rules:[{required:!0,message:"请输入问题描述！"}]})(w.a.createElement(s.a.TextArea,{placeholder:"请输入"}))),w.a.createElement(P,{label:"整改要求"},t.getFieldDecorator("improveRequire",{rules:[{required:!0,message:"请输入整改要求"}]})(w.a.createElement(s.a.TextArea,{placeholder:"请输入"})))),w.a.createElement(o.a,{span:12},w.a.createElement(P,{label:"问题分类"},t.getFieldDecorator("questionCategory",{initialValue:O.b[0],rules:[{required:!0,message:"请选择问题分类"}]})(w.a.createElement(j.a,{style:{width:"100%"},placeholder:"请选择",onChange:function(e,a){t.setFieldsValue({specificType:void 0}),i(a.props.index)}},O.b.map(function(e,t){return w.a.createElement(z,{value:e,key:e,index:t},e)})))),w.a.createElement(P,{label:"具体类型"},t.getFieldDecorator("specificType",{rules:[{required:!0,message:"请选择具体类型"}]})(w.a.createElement(j.a,{style:{width:"100%"},placeholder:"请选择"},O.c[c].map(function(e){return w.a.createElement(z,{value:e,key:e},e)})))),w.a.createElement(P,{label:"责任单位"},t.getFieldDecorator("dutyUnit",{rules:[{required:!0,message:"请选择责任单位"}]})(w.a.createElement(j.a,{style:{width:"100%"},placeholder:"请选择"},O.d.map(function(e){return w.a.createElement(z,{value:e,key:e},e)})))),w.a.createElement(P,{label:"整改情况"},t.getFieldDecorator("improveCondition",{rules:[{required:!0,message:"请选择整改情况"}]})(w.a.createElement(j.a,{style:{width:"100%"},placeholder:"请选择"},O.e.map(function(e){return w.a.createElement(z,{value:e,key:e},e)})))),w.a.createElement(P,{label:"附件"},t.getFieldDecorator("annexUrl",{})(w.a.createElement(I.a,n()({},{name:"files",action:"/result/api/file/v1/fileUpload",listType:"picture",accept:".pdf,.doc,.docx,.zip",className:"upload-list-inline",data:{type:9},headers:{Authorization:"Bearer ".concat(Object(U.w)("token")[0]),"x-requested-with":"XMLHttpRequest"},beforeUpload:U.p,onChange:l},{defaultFileList:a}),!a.length&&w.a.createElement(p.a,null,w.a.createElement(q.a,{type:"upload"})," 整改资料( pdf , doc, docx, zip)"))))))});Y.defaultProps={field:{},cateIndex:0,fileList:[],uploadChange:function(){},onChange:function(){},setCateIndex:function(){}};var A,J,Q,Z,H,W,X,K=Y,G=a("ZP6J"),$=a.n(G),_=Object(F.connect)(function(e){return{BuildSafetySafety:e.BuildSafetySafety,loading:e.loading.models.BuildSafetySafety}})((Q=J=function(e){function t(e){var a;return y()(this,t),(a=v()(this,S()(t).call(this,e))).state={fileList:[],field:{},cateIndex:0},a.uploadChange=function(e){"done"===e.file.status?200===e.file.response.code?(c.a.success("上传成功"),a.setState({fileList:e.fileList})):c.a.error(e.file.response.code.msg):"error"===e.file.status?c.a.error("上传失败"):"removed"===e.file.status&&a.setState({fileList:e.fileList})},a.fieldChange=function(e){a.setState(function(t){var a=t.field;return{field:D()({},a,e)}})},a.save=function(){a.MyForm.current.validateFields(function(e,t){if(!e){var l=a.props,n=l.dispatch,i=l.modalCallback,r=a.state.fileList;n({type:"BuildSafetySafety/add",payload:D()({},t,{annexUrl:r.length?r[0].response.filePath:""}),callback:function(){c.a.success("添加成功"),i(),a.cancelClick()}})}})},a.cancelClick=function(){(0,a.props.handleModalVisible)()},a.setCateIndex=function(e){a.setState({cateIndex:e})},a.MyForm=w.a.createRef(),a}return x()(t,e),b()(t,[{key:"render",value:function(){var e=this.props,t=e.loading,a=e.modalVisible,l=this.state,n=l.fileList,i=l.field,r=l.cateIndex;return w.a.createElement(d.a,{destroyOnClose:!0,title:"新建质量安全监督",className:$.a.formModal,visible:a,onCancel:this.cancelClick,width:800,footer:[w.a.createElement(p.a,{key:"back",onClick:this.cancelClick},"取消"),w.a.createElement(p.a,{key:"submit",type:"primary",loading:t,onClick:this.save},"确定")]},w.a.createElement("div",{className:$.a.formModalBody},w.a.createElement(K,{cateIndex:r,setCateIndex:this.setCateIndex,onChange:this.fieldChange,uploadChange:this.uploadChange,fileList:n,field:i,ref:this.MyForm})))}}]),t}(B.PureComponent),J.defaultProps={modalVisible:!1,handleModalVisible:function(){},modalCallback:function(){}},A=Q))||A,ee=Object(F.connect)(function(e){return{BuildSafetySafety:e.BuildSafetySafety,loading:e.loading.models.BuildSafetySafety}})((W=H=function(e){function t(e){var a;return y()(this,t),(a=v()(this,S()(t).call(this,e))).state={fileList:[],field:{},isSet:!1,cateIndex:0},a.uploadChange=function(e){"done"===e.file.status?200===e.file.response.code?(c.a.success("上传成功"),a.setState({fileList:e.fileList})):c.a.error(e.file.response.code.msg):"error"===e.file.status?c.a.error("上传失败"):"removed"===e.file.status&&a.setState({fileList:e.fileList})},a.fieldChange=function(e){a.setState(function(t){var a=t.detail;return{detail:D()({},a,e)}})},a.save=function(){a.MyForm.current.validateFields(function(e,t){if(!e){for(var l=a.props,n=l.dispatch,i=l.modalCallback,r=a.state,o=r.field,s=r.detail,d=D()({},o,t),u=D()({},s),f=Object.keys(t),m=0;m<f.length;m+=1)u[f[m]]={value:t[f[m]]};if("object"==typeof t.annexUrl){var p=t.annexUrl.file.response;d.annexUrl=p?p.filePath:""}a.setState({detail:u}),n({type:"BuildSafetySafety/add",payload:d,callback:function(){c.a.success("编辑成功"),i(),a.cancelClick()}})}})},a.setCateIndex=function(e){a.setState({cateIndex:e})},a.cancelClick=function(){(0,a.props.handleModalVisible)()},a.MyForm=w.a.createRef(),a}return x()(t,e),b()(t,[{key:"render",value:function(){var e=this.props,t=e.loading,a=e.modalVisible,l=this.state,n=l.detail,i=l.fileList,r=l.cateIndex;return w.a.createElement(d.a,{destroyOnClose:!0,title:"编辑质量安全监督",className:$.a.formModal,visible:a,onCancel:this.cancelClick,width:800,footer:[w.a.createElement(p.a,{key:"back",onClick:this.cancelClick},"取消"),w.a.createElement(p.a,{key:"submit",type:"primary",loading:t,onClick:this.save},"确定")]},w.a.createElement("div",{className:$.a.formModalBody},w.a.createElement(K,{onChange:this.fieldChange,uploadChange:this.uploadChange,cateIndex:r,setCateIndex:this.setCateIndex,fileList:i,field:n,ref:this.MyForm})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=e.detail,l=t.isSet;if(!l){for(var n=Object.keys(a),i={},r=0;r<n.length;r+=1)i[n[r]]={value:a[n[r]]};return{isSet:!l,field:a,detail:i,fileList:a.annexUrl?[{uid:"-1",name:"当前文件",status:"done",url:U.B+a.annexUrl}]:[]}}return null}}]),t}(B.PureComponent),H.defaultProps={modalVisible:!1,handleModalVisible:function(){},modalCallback:function(){}},Z=W))||Z,te=a("9zHi"),ae=a.n(te),le=M.a.Item,ne=Object(F.connect)(function(e){return{BuildSafetySafety:e.BuildSafetySafety,loading:e.loading.models.BuildSafetySafety}})(X=M.a.create()(X=function(e){function t(){var e,a;y()(this,t);for(var l=arguments.length,n=new Array(l),i=0;i<l;i++)n[i]=arguments[i];return(a=v()(this,(e=S()(t)).call.apply(e,[this].concat(n)))).state={modalVisible:!1,updateModalVisible:!1,selectedRows:[],formValues:[],detail:{},pageBean:{page:1,pageSize:10,showTotal:!0}},a.columns=[{title:"项目名称",dataIndex:"projectName"},{title:"督查人员",dataIndex:"inspectors"},{title:"督查时间",dataIndex:"inspectorTime",render:function(e){return N()(e).format("YYYY-MM-DD")}},{title:"问题描述",dataIndex:"questionDesc"},{title:"整改要求",dataIndex:"improveRequire"},{title:"操作",width:100,render:function(e,t){return w.a.createElement(B.Fragment,null,w.a.createElement(m.a,{placement:"left",title:"编辑"},w.a.createElement(p.a,{onClick:function(){return a.showDetailModal(t.id)},type:"primary",shape:"circle",icon:"file-search",size:"small"})),w.a.createElement(f.a,{type:"vertical"}),w.a.createElement(u.a,{title:"是否删除数据?",onConfirm:function(){return a.delUtil(t.id)},okText:"确定",cancelText:"取消"},w.a.createElement(m.a,{placement:"left",title:"删除"},w.a.createElement(p.a,{type:"danger",shape:"circle",icon:"delete",size:"small"}))))}}],a.batchDel=function(){d.a.confirm({title:"提示",content:"确定要删除数据吗？",okType:"danger",onOk:function(){var e=a.state.selectedRows;a.delUtil(e.map(function(e){return e.id}).join())}})},a.delUtil=function(e){(0,a.props.dispatch)({type:"BuildSafetySafety/remove",payload:{ids:e},callback:function(){c.a.success("删除成功");var e=a.state.pageBean;a.getList({pageBean:e}),a.setState({selectedRows:[]})}})},a.getList=function(e){(0,a.props.dispatch)({type:"BuildSafetySafety/fetch",payload:e})},a.showDetailModal=function(e){(0,a.props.dispatch)({type:"BuildSafetySafety/detail",payload:e,callback:function(e){a.setState({detail:e},function(){return a.handleUpdateModalVisible(!0)})}})},a.handleStandardTableChange=function(e){var t=a.state.formValues,l={pageBean:{page:e.current,pageSize:e.pageSize,showTotal:!0},querys:t};a.getList(l)},a.handleFormReset=function(){var e=a.props.form,t=a.state.pageBean;e.resetFields(),a.setState({formValues:[],selectedRows:[]}),a.getList({pageBean:t})},a.handleSelectRows=function(e){a.setState({selectedRows:e})},a.handleSearch=function(e){e.preventDefault();var t=a.props.form,l=a.state.pageBean;t.validateFields(function(e,t){if(!e){var n={projectName:t.name,inspectors:t.jcry,underUnit:t.sjdw},i=Object.keys(n).map(function(e){return n[e]?{property:e,value:n[e],group:"main",operation:"LIKE",relation:"AND"}:""}).filter(function(e){return e});a.setState({formValues:i}),a.getList({pageBean:l,querys:i})}})},a.handleModalVisible=function(e){a.setState({modalVisible:!!e})},a.handleUpdateModalVisible=function(e){a.setState({updateModalVisible:!!e}),e||a.setState({detail:{}})},a.modalCallback=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add",t=a.state,l=t.pageBean,n=t.formValues;return"add"===e?a.getList({pageBean:l}):a.getList({pageBean:l,querys:n})},a}return x()(t,e),b()(t,[{key:"componentDidMount",value:function(){var e=this.state.pageBean;this.getList({pageBean:e})}},{key:"renderSimpleForm",value:function(){var e=this.props.form.getFieldDecorator;return w.a.createElement(M.a,{onSubmit:this.handleSearch,layout:"inline"},w.a.createElement(r.a,{gutter:16},w.a.createElement(o.a,{md:5,sm:24},w.a.createElement(le,null,e("name")(w.a.createElement(s.a,{addonBefore:"项目名称",placeholder:"请输入"})))),w.a.createElement(o.a,{md:5,sm:24},w.a.createElement(le,null,e("jcry")(w.a.createElement(s.a,{addonBefore:"检查人员",placeholder:"请输入"})))),w.a.createElement(o.a,{md:5,sm:24},w.a.createElement(le,null,e("sjdw")(w.a.createElement(s.a,{addonBefore:"受检单位",placeholder:"请输入"})))),w.a.createElement(o.a,{md:4,sm:24},w.a.createElement("span",{className:ae.a.submitButtons},w.a.createElement(p.a,{type:"primary",htmlType:"submit"},"查询"),w.a.createElement(p.a,{style:{marginLeft:8},onClick:this.handleFormReset},"重置")))))}},{key:"render",value:function(){var e=this,t=this.props,a=t.BuildSafetySafety.data,l=t.loading,r=this.state,o=r.selectedRows,s=r.modalVisible,c=r.updateModalVisible,d=r.detail,u={modalCallback:this.modalCallback},f={handleModalVisible:this.handleModalVisible},m={detail:d,handleModalVisible:this.handleUpdateModalVisible};return w.a.createElement(B.Fragment,null,w.a.createElement(i.a,{bordered:!1},w.a.createElement("div",{className:ae.a.tableList},w.a.createElement("div",{className:ae.a.tableListForm},this.renderSimpleForm()),w.a.createElement("div",{className:ae.a.tableListOperator},w.a.createElement(p.a,{icon:"plus",type:"primary",onClick:function(){return e.handleModalVisible(!0)}},"新建"),o.length>0&&w.a.createElement(p.a,{type:"danger",onClick:this.batchDel},"批量删除")),w.a.createElement(L.a,{tableAlert:!0,selectedRows:o,loading:l,data:a,size:"middle",columns:this.columns,onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange}))),s&&w.a.createElement(_,n()({},u,f,{modalVisible:s})),c&&Object.keys(d).length&&w.a.createElement(ee,n()({},u,m,{modalVisible:c})))}}]),t}(B.PureComponent))||X)||X;t.default=ne}}]);