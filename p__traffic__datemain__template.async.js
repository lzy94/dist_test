(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{ldC6:function(e,t,a){"use strict";a.r(t);a("IzEo");var n,l=a("bx4M"),i=(a("T2oS"),a("W9HT")),r=(a("14J3"),a("BMrR")),s=(a("5NDa"),a("5rEg")),o=(a("jCWc"),a("kPKH")),c=a("MVZn"),d=a.n(c),m=(a("miYZ"),a("tsqr")),p=(a("5Dmo"),a("3S7+")),u=a("lwsE"),f=a.n(u),h=a("W8MJ"),g=a.n(h),E=a("a1gu"),b=a.n(E),y=a("Nsbk"),w=a.n(y),L=a("PJYZ"),v=a.n(L),C=a("7W2i"),k=a.n(C),S=(a("2qtc"),a("kLXV")),T=(a("DZo9"),a("8z0m")),B=a("pVnL"),F=a.n(B),N=(a("+L6B"),a("2/Rp")),V=(a("Pwec"),a("CtXQ")),R=(a("nRaC"),a("5RzL")),x=(a("y8nQ"),a("Vl3Y")),I=a("q1tI"),M=a.n(I),O=a("MuoO"),D=a("mf+E"),q=a("CkN6"),z=a("+n12"),P=a("9zHi"),j=a.n(P),A=a("ns75"),H=a.n(A),J=a("ZP6J"),U=a.n(J),Z=["/datemain/template"],W=x.a.Item,_=x.a.create()(function(e){var t=e.modalVisible,a=e.handleModalVisible,n=e.form,l=e.handleAdd,i=e.fileList,r=e.uploadChange,s=e.treeList,o={name:"files",action:"/result/api/file/v1/fileUpload",accept:".doc,.docx,.pdf",data:{type:3,params:null},headers:{Authorization:"Bearer ".concat(Object(z.w)("token")[0]),"x-requested-with":"XMLHttpRequest"},onChange:r,beforeUpload:z.n};return M.a.createElement(S.a,{destroyOnClose:!0,title:"添加模板",className:U.a.formModal,visible:t,onOk:function(){n.validateFields(function(e,t){e||l(t,function(){return n.resetFields()})})},onCancel:function(){return a()}},M.a.createElement("div",{className:U.a.formModalBody},M.a.createElement(W,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"机构"},n.getFieldDecorator("organCode",{rules:[{required:!0,message:"请选择机构！"}]})(M.a.createElement(R.a,{treeData:s,style:{width:"100%"},placeholder:"请选择"}))),M.a.createElement(W,{labelCol:{span:5},wrapperCol:{span:15},label:"文件上传"},n.getFieldDecorator("file",{rules:[{required:!0,message:"请选择文件!"}]})(M.a.createElement(T.a,F()({},o,{defaultFileList:i}),i.length>0?null:M.a.createElement(N.a,null,M.a.createElement(V.a,{type:"upload"})," 选择文件（请上传 ‘pdf’ 及 ‘doc’ 文件）"))))))}),K=Object(O.connect)(function(e){var t=e.loading,a=e.File,n=e.LawEmforcementTemplate;return{system:e.system,File:a,fileLoading:t.models.File,LawEmforcementTemplate:n,loading:t.models.LawEmforcementTemplate}})(n=x.a.create()(n=function(e){function t(){var e,a;f()(this,t);for(var n=arguments.length,l=new Array(n),i=0;i<n;i++)l[i]=arguments[i];return(a=b()(this,(e=w()(t)).call.apply(e,[this].concat(l)))).state={formValues:[],selectedRows:[],fileList:[],modalVisible:!1,pageBean:{page:1,pageSize:10,showTotal:!0}},a.columns=[{title:"上传者",dataIndex:"createBy"},{title:"机构",dataIndex:"organName"},{title:"文件名",dataIndex:"fileName",render:function(e){return e.length>15?M.a.createElement(p.a,{title:e},M.a.createElement("span",{style:{cursor:"pointer"}},e.substr(0,15)+"......")):e}},{title:"上传时间",dataIndex:"createTime"},{title:"操作",width:70,render:function(e,t){return M.a.createElement(I.Fragment,null,M.a.createElement(p.a,{placement:"left",title:"预览"},M.a.createElement(N.a,{onClick:function(){return a.previcew(t)},type:"primary",shape:"circle",icon:"eye",size:"small"})))}}],a.previcew=function(e){var t=a.props.dispatch;"pdf"===e.filePath.substring(e.filePath.lastIndexOf(".")+1)?window.open(z.q+e.filePath,"_blank"):t({type:"File/preview",payload:{fileId:e.fileId},callback:function(e){if(e){var a=e.pdfUrl.split("/"),n=a[a.length-1];t({type:"File/preview_",payload:n,callback:function(e){if(200!==e.code)return m.a.error("模板读取失败！");window.open(e.data,"_blank")}})}}})},a.delBatch=function(){var e=a.state.selectedRows;if(e){var t=v()(a);S.a.confirm({title:"批量删除",content:"您确定要批量删除吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){t.delUtil(e.map(function(e){return e.id}).join())},onCancel:function(){}})}},a.delUtil=function(e){var t=a.state.pageBean;(0,a.props.dispatch)({type:"LawEmforcementTemplate/remove",payload:{ids:e},callback:function(){m.a.success("删除成功"),setTimeout(function(){return a.getList({pageBean:t})},100),a.setState({selectedRows:[]})}})},a.getList=function(e){(0,a.props.dispatch)({type:"LawEmforcementTemplate/fetch",payload:e})},a.handleStandardTableChange=function(e){var t=a.state.formValues,n={pageBean:{page:e.current,pageSize:e.pageSize,showTotal:!0},querys:t};a.getList(n)},a.handleFormReset=function(){var e=a.props.form,t=a.state.pageBean;e.resetFields(),a.setState({formValues:[]}),a.getList({pageBean:t})},a.handleSearch=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var n=a.state.pageBean,l=d()({},t),i=Object.keys(l).map(function(e){return l[e]?{property:e,value:l[e],group:"main",operation:"fileName"===e?"LIKE":"RIGHT_LIKE",relation:"AND"}:""}).filter(function(e){return e});a.setState({formValues:i}),a.getList({pageBean:n,querys:i})}})},a.handleSelectRows=function(e){a.setState({selectedRows:e})},a.uploadChange=function(e){"done"===e.file.status?200===e.file.response.code?(m.a.success("上传成功"),a.setState({fileList:e.fileList})):(m.a.error("上传失败"),m.a.error(e.file.response.code.msg)):"error"===e.file.status?m.a.error("上传失败"):"removed"===e.file.status&&a.setState({fileList:e.fileList})},a.handleModalVisible=function(e){a.setState({modalVisible:!!e}),e||a.setState({fileList:[]})},a.handleAdd=function(e,t){var n=a.props.dispatch,l=a.state,i=l.pageBean,r=l.fileList,s=e.file.file.response;if(e.fileId=s.fileId,e.fileName=s.fileName.substring(0,s.fileName.lastIndexOf(".")),e.filePath=s.filePath,e.fileType="",!r.length)return m.a.error("请上传文件");n({type:"LawEmforcementTemplate/add",payload:e,callback:function(){a.handleModalVisible(),setTimeout(function(){return a.getList({pageBean:i})},300),t&&t()}})},a}return k()(t,e),g()(t,[{key:"componentDidMount",value:function(){if(Object(z.b)(Z[0])){var e=this.state.pageBean;this.getList({pageBean:e})}}},{key:"renderSimpleForm",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.system.treeList;return M.a.createElement(x.a,{onSubmit:this.handleSearch,layout:"inline"},M.a.createElement(r.a,{gutter:{md:8,lg:16,xl:32}},M.a.createElement(o.a,{md:5,sm:24},M.a.createElement("div",{className:H.a.inputMain},M.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"机构"),M.a.createElement(W,{style:{flex:1}},t("organCode")(M.a.createElement(R.a,{className:H.a.inputGroupLeftRadius,treeData:a,style:{width:"100%"},placeholder:"请选择"}))))),M.a.createElement(o.a,{md:5,sm:24},M.a.createElement(W,null,t("fileName")(M.a.createElement(s.a,{addonBefore:"文件名称",placeholder:"请输入"})))),M.a.createElement(o.a,{md:5,sm:24},M.a.createElement("span",{className:j.a.submitButtons},M.a.createElement(N.a,{type:"primary",htmlType:"submit"},"查询"),M.a.createElement(N.a,{style:{marginLeft:8},onClick:this.handleFormReset},"重置")))))}},{key:"render",value:function(){var e=this,t=this.props,a=t.LawEmforcementTemplate.data,n=t.loading,r=t.fileLoading,s=t.system.treeList,o=this.state,c=o.selectedRows,d=o.modalVisible,m={treeList:s,fileList:o.fileList,handleAdd:this.handleAdd,uploadChange:this.uploadChange,handleModalVisible:this.handleModalVisible};return M.a.createElement(I.Fragment,null,Object(z.b)(Z[0])?null:M.a.createElement(D.a,{to:"/exception/403"}),M.a.createElement(l.a,{bordered:!1},M.a.createElement("div",{className:j.a.tableList},M.a.createElement("div",{className:j.a.tableListForm},this.renderSimpleForm()),M.a.createElement("div",{className:j.a.tableListOperator},M.a.createElement(N.a,{type:"primary",icon:"plus",onClick:function(){return e.handleModalVisible(!0)}},"新增"),c.length>0&&M.a.createElement(N.a,{type:"danger",onClick:function(){return e.delBatch()}},"批量删除")),M.a.createElement(i.a,{spinning:!!r},M.a.createElement(q.a,{size:"middle",selectedRows:c,loading:n,data:a,columns:this.columns,onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange})))),M.a.createElement(_,F()({},m,{modalVisible:d})))}}]),t}(I.PureComponent))||n)||n;t.default=K}}]);