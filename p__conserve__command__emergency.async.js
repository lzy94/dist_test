(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{Fdez:function(e,a,t){"use strict";t.r(a);var l,n,r,i=t("pVnL"),s=t.n(i),c=(t("IzEo"),t("bx4M")),o=(t("14J3"),t("BMrR")),d=(t("jCWc"),t("kPKH")),m=t("MVZn"),u=t.n(m),p=t("RIqP"),g=t.n(p),h=(t("5Dmo"),t("3S7+")),f=(t("+L6B"),t("2/Rp")),y=t("lwsE"),E=t.n(y),b=t("W8MJ"),v=t.n(b),V=t("a1gu"),C=t.n(V),M=t("Nsbk"),w=t.n(M),L=t("7W2i"),k=t.n(L),D=(t("OaEy"),t("2fM7")),N=(t("y8nQ"),t("Vl3Y")),S=t("q1tI"),x=t.n(S),I=t("MuoO"),F=t("wd/R"),O=t.n(F),P=t("lTPH"),T=t("CkN6"),j=t("AwtQ"),q=(t("2qtc"),t("kLXV")),U=(t("DZo9"),t("8z0m")),B=(t("5NDa"),t("5rEg")),A=(t("iQDF"),t("+eQT")),z=(t("Pwec"),t("CtXQ")),Q=(t("miYZ"),t("tsqr")),H=t("o0o1"),R=t.n(H),Y=t("yXPU"),_=t.n(Y),J=t("ZP6J"),X=t.n(J),Z=t("+n12"),K=t("z1x1"),W=t("DhmK"),G=N.a.Item,$=D.a.Option,ee=[[],[]],ae=Object(I.connect)(function(e){var a=e.ListPlanCategory;return{Emergency:e.Emergency,ListPlanCategory:a,loading:e.loading.models.Emergency}})(l=N.a.create()(l=function(e){function a(e){var t;return E()(this,a),(t=C()(this,w()(a).call(this,e))).state={departmentUserList:[],charger:"",fileList:[],address:"",lnglat:[],categoryName:"",pModalVisible:!1,planName:"",dealType:"",chargerId:"",previewImage:"",previewVisible:!1},t.categoryChange=function(e,a){t.setState({categoryName:a.props.children})},t.parentAddress=function(e,a){t.setState({address:e,lnglat:a})},t.getInputValue=function(e){return t.setState({address:e})},t.handleChange=function(e){var a=e.fileList;return t.setState({fileList:a})},t.uploadConfig=function(){return{name:"files",action:"/result/api/file/v1/fileUpload",listType:"picture-card",accept:".jpg,.jpeg,.png",data:{type:9},headers:{Authorization:"Bearer ".concat(Object(Z.w)("token")[0]),"x-requested-with":"XMLHttpRequest"},beforeUpload:Z.A,onChange:t.handleChange,onPreview:t.handlePreview}},t.handlePreview=function(){var e=_()(R.a.mark(function e(a){return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.url||a.preview){e.next=4;break}return e.next=3,Object(Z.v)(a.originFileObj);case 3:a.preview=e.sent;case 4:t.setState({previewImage:a.url||a.preview}),t.handleCancel(!0);case 6:case"end":return e.stop()}},e)}));return function(a){return e.apply(this,arguments)}}(),t.handleCancel=function(e){return t.setState({previewVisible:!!e})},t.selectData=function(e){t.setState({planName:e.planName,dealType:e.dealType,chargerId:e.chargerId,charger:e.charger})},t.save=function(){var e=t.props,a=e.form,l=e.dispatch,n=e.handleModalVisible,r=e.modalSuccess;a.validateFields(function(e,a){if(!e){var i=t.state,s=i.charger,c=i.fileList,o=i.lnglat,d=i.categoryName,m=i.address,p=i.chargerId,g=i.dealType;if(c.length)if(m){var h=u()({},a);h.dealType=g,h.charger=s,h.chargerId=p,h.addr=m,h.categoryName=d,h.longitude=o[0],h.latitudel=o[1],h.state=2;var f=c.map(function(e){return e.response.filePath});h.imgUrl=f.join(),l({type:"Emergency/add",payload:h,callback:function(){Q.a.success("添加成功"),n(),r()}})}else Q.a.error("请获取地址");else Q.a.error("请选择图片")}})},t.handlePModalVisible=function(e){t.setState({pModalVisible:!!e})},ee=Object(P.o)(),t}return k()(a,e),v()(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,a=this.props,t=a.form,l=a.modalVisible,n=a.handleModalVisible,r=a.loading,i=a.cateList,c=this.state,m=c.fileList,u=(c.departmentUserList,c.pModalVisible),p=c.planName,g=c.previewVisible,h=c.previewImage,y=x.a.createElement("div",null,x.a.createElement(z.a,{type:"plus"}),x.a.createElement("div",{className:"ant-upload-text"},"请选择图片"));return x.a.createElement(S.Fragment,null,x.a.createElement(q.a,{destroyOnClose:!0,title:"新建调度",className:X.a.formModal,visible:l,onCancel:function(){return n()},width:800,footer:[x.a.createElement(f.a,{key:"back",onClick:function(){return n()}},"取消"),x.a.createElement(f.a,{key:"submit",type:"primary",loading:r,onClick:function(){return e.save()}},"下发任务")]},x.a.createElement("div",{className:X.a.formModalBody},x.a.createElement("h3",null,"上报信息"),x.a.createElement(o.a,{gutter:40},x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(G,{label:"对象"},t.getFieldDecorator("planObject",{rules:[{required:!0,message:"请选择对象！"}]})(x.a.createElement(D.a,{style:{width:"100%"},placeholder:"请选择"},ee[1].map(function(e,a){return x.a.createElement($,{key:a,value:ee[0][a]},e)}))))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(G,{label:"类型"},t.getFieldDecorator("categoryId",{rules:[{required:!0,message:"请选择类型！"}]})(x.a.createElement(D.a,{placeholder:"请选择",style:{width:"100%"},onChange:this.categoryChange},i.list.map(function(e,a){return x.a.createElement($,{key:a,value:e.id_},e.categoryName)}))))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(G,{label:"处置时间"},t.getFieldDecorator("sendTime",{rules:[{required:!0,message:"请选择时间！"}]})(x.a.createElement(A.a,{showTime:!0,placeholder:"请选择",style:{width:"100%"}})))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(G,{label:"等级"},t.getFieldDecorator("emergencyLevel",{rules:[{required:!0,message:"请选择等级！"}]})(x.a.createElement(D.a,{placeholder:"请选择",style:{width:"100%"}},P.u.map(function(e,a){return x.a.createElement($,{key:a,value:a+1},e)}))))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(G,{label:"预案"},t.getFieldDecorator("yuan",{initialValue:p,rules:[{required:!0,message:"请选择预案！"}]})(x.a.createElement(B.a,{readOnly:!0,placeholder:"请选择",onClick:function(){return e.handlePModalVisible(!0)}})))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(G,{label:"上报内容"},t.getFieldDecorator("workContent",{rules:[{required:!0,message:"请输入上报内容！"}]})(x.a.createElement(B.a.TextArea,{placeholder:"请输入"})))),x.a.createElement(d.a,{md:24,sm:24},x.a.createElement(K.a,{getInputValue:this.getInputValue,parentAddress:this.parentAddress})))),x.a.createElement("div",{className:X.a.formModalBody,style:{marginTop:10}},x.a.createElement("h3",null,"上报图片"),x.a.createElement("div",{className:"clearfix"},x.a.createElement(G,null,t.getFieldDecorator("imgUrl",{rules:[{required:!0,message:"请上传照片！"}]})(x.a.createElement(U.a,s()({},this.uploadConfig(),{fileList:m}),m.length>=3?null:y)))))),u?x.a.createElement(W.a,{modalVisible:u,handleModalVisible:this.handlePModalVisible,selectData:this.selectData}):null,x.a.createElement(q.a,{visible:g,footer:null,onCancel:function(){return e.handleCancel(!1)}},x.a.createElement("img",{alt:"example",style:{width:"100%"},src:h})))}}]),a}(S.PureComponent))||l)||l,te=t("7DBZ"),le=(x.a.Component,N.a.Item),ne=D.a.Option,re=Object(I.connect)(function(e){var a=e.ListPlanCategory;return{Emergency:e.Emergency,ListPlanCategory:a,loading:e.loading.models.Emergency}})(n=N.a.create()(n=function(e){function a(){var e,t;E()(this,a);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return(t=C()(this,(e=w()(a)).call.apply(e,[this].concat(n)))).state={departmentUserList:[],charger:"",fileList:[],address:"",value:"",lnglat:[],categoryName:"",pModalVisible:!1,detail:{},planName:"",dealType:"",chargerId:""},t.getDepartmentUser=function(){(0,t.props.dispatch)({type:"system/departmentUser",payload:{menuType:-2},callback:function(e){t.setState({departmentUserList:e})}})},t.chargerChange=function(e,a){t.setState({charger:a.props.children})},t.categoryChange=function(e,a){t.setState({categoryName:a.props.children})},t.parentAddress=function(e,a){t.setState({address:e,lnglat:a})},t.handleChange=function(e){var a=e.fileList;return t.setState({fileList:a})},t.uploadConfig=function(){return{name:"files",action:"/result/api/file/v1/fileUpload",listType:"picture-card",accept:".jpg,.jpeg,.png",data:{type:9},headers:{Authorization:"Bearer ".concat(Object(Z.w)("token")[0]),"x-requested-with":"XMLHttpRequest"},onChange:t.handleChange}},t.selectData=function(e){t.setState({planName:e.planName,dealType:e.dealType,chargerId:e.chargerId,charger:e.charger})},t.save=function(){var e=t.props,a=e.form,l=e.dispatch,n=e.handleModalVisible,r=e.modalSuccess;a.validateFields(function(e,a){if(!e){var i=t.state,s=i.charger,c=i.fileList,o=i.lnglat,d=i.categoryName,m=i.detail,p=i.address,g=i.chargerId,h=i.dealType,f=u()({},a),y=u()({},m);if(!o[0])return Q.a.error("请选择位置");f.dealType=h,f.charger=s,f.addr=p,f.chargerId=g,f.categoryName=d,f.longitude=o[0],f.latitudel=o[1],f.state=2;var E="";for(var b in E="object"==typeof f.imgUrl?c.map(function(e){return e.response.filePath}):c.map(function(e){return e.path}),f.imgUrl=E.join(),f)y[b]=f[b];t.setState({detail:y}),l({type:"Emergency/update",payload:y,callback:function(){Q.a.success("下发成功"),n(),r()}})}})},t.handlePModalVisible=function(e){t.setState({pModalVisible:!!e})},t}return k()(a,e),v()(a,[{key:"componentDidMount",value:function(){this.getDepartmentUser();var e=this.props.detail;if(this.setState({detail:e,value:e.addr,charger:e.charger,categoryName:e.categoryName,lnglat:[e.longitude,e.latitudel]}),e.imgUrl){var a=e.imgUrl.split(",").map(function(e,a){return{uid:a,name:"当前图片",status:"done",url:Z.B+e,path:e}});this.setState({fileList:a})}}},{key:"render",value:function(){var e=this,a=this.props,t=a.form,l=a.modalVisible,n=a.handleModalVisible,r=a.loading,i=a.cateList,c=this.state,m=c.fileList,u=(c.departmentUserList,c.detail),p=c.pModalVisible,g=c.planName;return x.a.createElement(S.Fragment,null,x.a.createElement(q.a,{destroyOnClose:!0,title:"编辑下发",className:X.a.formModal,visible:l,onCancel:function(){return n()},width:800,footer:[x.a.createElement(f.a,{key:"back",onClick:function(){return n()}},"取消"),x.a.createElement(f.a,{key:"submit",type:"primary",loading:r,onClick:function(){return e.save()}},"下发任务")]},x.a.createElement("div",{className:X.a.formModalBody},x.a.createElement("h3",null,"上报信息"),x.a.createElement(o.a,{gutter:40},x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(le,{label:"对象"},t.getFieldDecorator("planObject",{initialValue:u.planObject,rules:[{required:!0,message:"请选择对象！"}]})(x.a.createElement(D.a,{style:{width:"100%"},placeholder:"请选择"},P.s.map(function(e,a){return x.a.createElement(ne,{key:a,value:P.t[a]},e)}))))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(le,{label:"类型"},t.getFieldDecorator("categoryId",{initialValue:u.categoryId,rules:[{required:!0,message:"请选择类型！"}]})(x.a.createElement(D.a,{placeholder:"请选择",style:{width:"100%"},onChange:this.categoryChange},i.list.map(function(e,a){return x.a.createElement(ne,{key:a,value:e.id_},e.categoryName)}))))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(le,{label:"处置时间"},t.getFieldDecorator("sendTime",{rules:[{required:!0,message:"请选择时间！"}]})(x.a.createElement(A.a,{showTime:!0,placeholder:"请选择",style:{width:"100%"}})))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(le,{label:"等级"},t.getFieldDecorator("emergencyLevel",{initialValue:u.emergencyLevel,rules:[{required:!0,message:"请选择等级！"}]})(x.a.createElement(D.a,{placeholder:"请选择",style:{width:"100%"}},P.u.map(function(e,a){return x.a.createElement(ne,{key:a,value:a+1},e)}))))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(le,{label:"预案"},t.getFieldDecorator("yuan",{initialValue:g,rules:[{required:!0,message:"请选择预案！"}]})(x.a.createElement(B.a,{readOnly:!0,placeholder:"请选择",onClick:function(){return e.handlePModalVisible(!0)}})))),x.a.createElement(d.a,{md:12,sm:24},x.a.createElement(le,{label:"上报内容"},t.getFieldDecorator("workContent",{rules:[{required:!0,message:"请输入上报内容！"}]})(x.a.createElement(B.a.TextArea,{placeholder:"请输入"})))),x.a.createElement(d.a,{md:24,sm:24},Object.keys(u).length?x.a.createElement(K.a,{lngLat:u.longitude?{longitude:u.longitude,latitude:u.latitudel}:null,address:u.addr,parentAddress:this.parentAddress}):null))),x.a.createElement("div",{className:X.a.formModalBody,style:{marginTop:10}},x.a.createElement("h3",null,"上报图片"),x.a.createElement("div",{className:"clearfix"},x.a.createElement(le,null,t.getFieldDecorator("imgUrl",{initialValue:u.imgUrl,rules:[{required:!0,message:"请上传照片！"}]})(x.a.createElement(U.a,s()({},this.uploadConfig(),{fileList:m}))))))),p?x.a.createElement(W.a,{modalVisible:p,handleModalVisible:this.handlePModalVisible,selectData:this.selectData}):null)}}]),a}(S.PureComponent))||n)||n,ie=t("9zHi"),se=t.n(ie),ce=t("ns75"),oe=t.n(ce),de=N.a.Item,me=D.a.Option,ue=["新建","已派","处理中","已完成"],pe=[[],[]],ge=Object(I.connect)(function(e){var a=e.ListPlanCategory;return{Emergency:e.Emergency,ListPlanCategory:a,loading:e.loading.models.Emergency}})(r=N.a.create()(r=function(e){function a(e){var t;return E()(this,a),(t=C()(this,w()(a).call(this,e))).state={modalVisible:!1,updateModalVisible:!1,detailModalVisible:!1,formValues:[],detail:{},pageBean:{page:1,pageSize:10,showTotal:!0},defaultQuery:{}},t.columns=[{title:"对象",dataIndex:"planObject",render:function(e){return pe[1][pe[0].indexOf(e)]}},{title:"类型",dataIndex:"categoryName"},{title:"等级",dataIndex:"emergencyLevel",render:function(e){return P.u[e-1]}},{title:"上报时间",dataIndex:"createdTime",width:170,render:function(e){return O()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"状态",dataIndex:"state",render:function(e){return ue[e-1]}},{title:"操作",width:80,render:function(e,a){return x.a.createElement(S.Fragment,null,1===a.state?x.a.createElement(h.a,{placement:"left",title:"下发"},x.a.createElement(f.a,{onClick:function(){return t.editData(a.id_)},type:"primary",shape:"circle",icon:"edit",size:"small"})):null,1!==a.state?x.a.createElement(h.a,{placement:"left",title:"详情"},x.a.createElement(f.a,{onClick:function(){return t.detailData(a.id_)},type:"primary",shape:"circle",icon:"eye",size:"small"})):null)}}],t.editData=function(e){t.getDetail(e,function(){return t.handleUpdateModalVisible(!0)})},t.detailData=function(e){t.getDetail(e,function(){return t.handleDetailModalVisible(!0)})},t.getDetail=function(e,a){(0,t.props.dispatch)({type:"Emergency/detail",payload:{id:e},callback:function(e){return t.setState({detail:e},function(){return a()})}})},t.getList=function(e){(0,t.props.dispatch)({type:"Emergency/fetch",payload:e})},t.getCate=function(){(0,t.props.dispatch)({type:"ListPlanCategory/fetch",payload:{planObject:pe[0].join()}})},t.handleStandardTableChange=function(e){var a=t.state,l=a.formValues,n=a.defaultQuery,r={pageBean:{page:e.current,pageSize:e.pageSize,showTotal:!0},querys:[n].concat(g()(l))};t.getList(r)},t.handleFormReset=function(){var e=t.props.form,a=t.state,l=a.defaultQuery,n=a.pageBean;e.resetFields(),t.setState({formValues:[]}),t.getList({pageBean:n,querys:[l]})},t.handleSearch=function(e){e.preventDefault(),t.props.form.validateFields(function(e,a){if(!e){var l=t.state,n=l.pageBean,r=l.defaultQuery,i=u()({},a),s=Object.keys(i).map(function(e){return i[e]?{property:e,value:i[e],group:"main",operation:"EQUAL",relation:"AND"}:""}).filter(function(e){return e});t.setState({formValues:s}),t.getList({pageBean:n,querys:[r].concat(g()(s))})}})},t.handleModalVisible=function(e){t.setState({modalVisible:!!e})},t.handleUpdateModalVisible=function(e){t.setState({updateModalVisible:!!e})},t.handleDetailModalVisible=function(e){t.setState({detailModalVisible:!!e})},t.modalSuccess=function(){var e=t.state,a=e.pageBean,l=e.defaultQuery;t.getList({pageBean:a,querys:[l]}),t.setState({detail:{}})},pe=Object(P.o)(),t}return k()(a,e),v()(a,[{key:"componentDidMount",value:function(){var e={property:"planObject",value:pe[0],group:"main",operation:"IN",relation:"AND"};this.getList({pageBean:this.state.pageBean,querys:[e]}),this.setState({defaultQuery:e}),this.getCate()}},{key:"renderSimpleForm",value:function(){var e=this.props,a=e.form.getFieldDecorator,t=e.ListPlanCategory.data;return x.a.createElement(N.a,{onSubmit:this.handleSearch,layout:"inline"},x.a.createElement(o.a,{gutter:{md:8,lg:16,xl:32}},x.a.createElement(d.a,{md:6,sm:24},x.a.createElement("div",{className:oe.a.inputMain},x.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"类型"),x.a.createElement(de,{style:{flex:1}},a("categoryId")(x.a.createElement(D.a,{placeholder:"请选择",style:{width:"100%"}},t.list.map(function(e,a){return x.a.createElement(me,{key:a,value:e.id_},e.categoryName)})))))),x.a.createElement(d.a,{md:6,sm:24},x.a.createElement("div",{className:oe.a.inputMain},x.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"状态"),x.a.createElement(de,{style:{flex:1}},a("state")(x.a.createElement(D.a,{placeholder:"请选择",style:{width:"100%"}},ue.map(function(e,a){return x.a.createElement(me,{key:a,value:a+1},e)})))))),x.a.createElement(d.a,{md:6,sm:24},x.a.createElement("div",{className:oe.a.inputMain},x.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"等级"),x.a.createElement(de,{style:{flex:1}},a("emergencyLevel")(x.a.createElement(D.a,{placeholder:"请选择",style:{width:"100%"}},P.u.map(function(e,a){return x.a.createElement(me,{key:a,value:a+1},e)})))))),x.a.createElement(d.a,{md:6,sm:24},x.a.createElement("span",{className:se.a.submitButtons},x.a.createElement(f.a,{type:"primary",htmlType:"submit"},"查询"),x.a.createElement(f.a,{style:{marginLeft:8},onClick:this.handleFormReset},"重置")))))}},{key:"render",value:function(){var e=this,a=this.props,t=a.Emergency.dataList,l=a.ListPlanCategory.data,n=a.loading,r=this.state,i=r.modalVisible,o=r.updateModalVisible,d=r.detail,m=r.detailModalVisible,u={cateList:l,modalSuccess:this.modalSuccess,handleModalVisible:this.handleModalVisible},p={cateList:l,detail:d,modalSuccess:this.modalSuccess,handleModalVisible:this.handleUpdateModalVisible},g={detail:d,modalSuccess:this.modalSuccess,handleModalVisible:this.handleDetailModalVisible};return x.a.createElement(S.Fragment,null,x.a.createElement(c.a,{bordered:!1},x.a.createElement("div",{className:se.a.tableList},x.a.createElement("div",{className:se.a.tableListForm},this.renderSimpleForm()),x.a.createElement("div",{className:se.a.tableListOperator},x.a.createElement(f.a,{icon:"plus",type:"primary",onClick:function(){return e.handleModalVisible(!0)}},"新建")),x.a.createElement(T.a,{rowKey:"id_",size:"middle",tableAlert:!1,selectedRows:0,rowSelection:null,loading:n,data:t,columns:this.columns,onChange:this.handleStandardTableChange}))),i?x.a.createElement(ae,s()({},u,{modalVisible:i})):null,m&&Object.keys(d).length?x.a.createElement(j.a,s()({},g,{modalVisible:m})):null,o&&Object.keys(d).length?x.a.createElement(re,s()({},p,{modalVisible:o})):null)}}]),a}(S.PureComponent))||r)||r;a.default=ge}}]);