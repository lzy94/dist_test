(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{XJfC:function(e,t,a){"use strict";a.r(t);var n,i=a("pVnL"),o=a.n(i),r=a("RIqP"),s=a.n(r),l=(a("bP8k"),a("gFTJ")),c=(a("2qtc"),a("kLXV")),u=(a("IzEo"),a("bx4M")),m=(a("fV52"),a("3I+P")),d=(a("Pwec"),a("CtXQ")),p=(a("y8nQ"),a("Vl3Y")),f=a("lwsE"),y=a.n(f),h=a("W8MJ"),g=a.n(h),v=a("a1gu"),C=a.n(v),E=a("Nsbk"),b=a.n(E),S=a("7W2i"),N=a.n(S),T=(a("aHsQ"),a("sGsY")),k=a("q1tI"),L=a.n(k),I=a("7DBZ"),M=a("MuoO"),V=a("Py4S"),A=a.n(V),w=a("mf+E"),x=a("2c/C"),O=a.n(x),D=a("+n12"),F=a("9X8c"),P=a.n(F),G=a("mn69"),R=a.n(G),j=a("15hv"),J=a.n(j),U=a("0jMW"),W=a.n(U),z=T.a.Countdown,H=["/overview/gis"],X=null,_=null,q=null,B=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=C()(this,(e=b()(t)).call.apply(e,[this].concat(i)))).getOrganId=function(){for(var e=localStorage.getItem("organId")||"510000",t=6-e.length,a=0;a<t;a+=1)e+="0";return e},a.switchAreaNode=function(e){q&&""+q.getAdcode()==""+e||_.loadAreaNode(e,function(t,n){q=window.currentAreaNode=n,_.setAreaNodesForLocating([q]),_.setHoverFeature(null),a.renderAreaPolygons(e)})},a.loadUI=function(e){window.AMapUI.loadUI(["geo/DistrictExplorer"],function(t){_=new t({map:X}),a.renderAreaPolygons(e)})},a.renderAreaPolygons=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:51e4;_.loadAreaNode(e,function(e,t){(t||void 0!==t)&&(X.setBounds(t.getBounds(),null,null,!0),_.clearFeaturePolygons(),_.renderParentFeature(t,{cursor:"default",bubble:!0,strokeColor:"#000",strokeOpacity:.5,strokeWeight:1,fillColor:"#fff",fillOpacity:.5}))})},a}return N()(t,e),g()(t,[{key:"componentDidMount",value:function(){X=this.props.__map__;var e=this.getOrganId();this.loadUI(e)}},{key:"render",value:function(){return L.a.createElement(L.a.Fragment,null)}}]),t}(k.Component),Q=p.a.create()(function(e){var t=e.data,a=e.modalVisible,n=e.handleModalVisible,i=e.onFinishCount,o=e.finishCountType,r=e.handleFinishCountVisible,s=e.mySiteCarousel,l=e.next,p=e.prev,f=t.siteInfo,y=t.count[0],h=new Date(f.verificationDate).getTime();h&&h<(new Date).getTime()&&r(!0);var g=function(){i()},v=f.siteImg?f.siteImg.split(","):[],C=v.map(function(e){return{src:D.E+e,alt:f.siteName}});return L.a.createElement(c.a,{destroyOnClose:!0,title:L.a.createElement("div",{style:{paddingRight:30,overflow:"hidden"}},L.a.createElement("span",{className:O.a.title},f.siteName),h?o?L.a.createElement("span",{className:O.a.title,style:{color:"red",float:"right"}},"已到检定时间"):L.a.createElement(z,{onFinish:g,valueStyle:{fontSize:15,lineHeight:1},style:{float:"right"},title:"下次检定时间",value:h,format:"D 天 H 时 m 分 s 秒 SSS"}):null),visible:a,onCancel:function(){return n()},footer:null,bodyStyle:{padding:0},wrapClassName:O.a.modalMain},L.a.createElement("div",{className:O.a.myCarousel},L.a.createElement(d.a,{onClick:p,className:"".concat(O.a.pos," ").concat(O.a.prev),type:"left-circle",theme:"filled"}),L.a.createElement(d.a,{onClick:l,className:"".concat(O.a.pos," ").concat(O.a.next),type:"right-circle",theme:"filled"}),L.a.createElement(m.a,{ref:s,autoplay:!0},v.length?C.map(function(e,t){return L.a.createElement(A.a,{key:e.src,backdrop:"rgba(255,255,255,.3)",defaultPage:t,style:{height:250},src:e.src,set:C})}):L.a.createElement("img",{className:O.a.notImg,src:J.a,alt:""}))),L.a.createElement("div",{className:O.a.address},L.a.createElement(d.a,{type:"environment",style:{marginRight:5}}),f.address),L.a.createElement(u.a,null,L.a.createElement(u.a.Grid,{style:{width:"33.3333%"}},L.a.createElement(T.a,{title:"今日检测数",value:y.TOTAL,valueStyle:{color:"#0a67fb"}})),L.a.createElement(u.a.Grid,{style:{width:"33.3333%"}},L.a.createElement(T.a,{title:"今日超限数",value:y.OVERLOADTOTAL,valueStyle:{color:"#ff4343"}})),L.a.createElement(u.a.Grid,{style:{width:"33.3333%"}},L.a.createElement(T.a,{title:"今日超限率",value:(100*(y.OVERLOADTOTAL/y.TOTAL||0)).toFixed(2),precision:2,valueStyle:{color:"#d338ff"},suffix:"%"}))))}),Y=p.a.create()(function(e){var t=e.data,a=e.modalVisible,n=e.handleModalVisible,i=e.mySourceCarousel,o=e.prev,r=e.next,s=t.companyImg?t.companyImg.split(","):[],p=s.map(function(e){return{src:D.E+e,alt:t.companyName}});return L.a.createElement(c.a,{destroyOnClose:!0,title:L.a.createElement("div",{style:{padding:"8px 0"}},t.companyName),visible:a,onCancel:function(){return n()},footer:null,bodyStyle:{padding:0},wrapClassName:O.a.modalMain},L.a.createElement("div",{className:O.a.myCarousel},L.a.createElement(d.a,{onClick:o,className:"".concat(O.a.pos," ").concat(O.a.prev),type:"left-circle",theme:"filled"}),L.a.createElement(d.a,{onClick:r,className:"".concat(O.a.pos," ").concat(O.a.next),type:"right-circle",theme:"filled"}),L.a.createElement(m.a,{ref:i,autoplay:!0},s.length?p.map(function(e,t){return L.a.createElement(A.a,{key:e.src,backdrop:"rgba(255,255,255,.3)",defaultPage:t,style:{height:250},src:e.src,set:p})}):L.a.createElement("img",{className:O.a.notImg,src:J.a,alt:""}))),L.a.createElement("div",{className:O.a.address},L.a.createElement(d.a,{type:"environment",style:{marginRight:5}}),t.address),L.a.createElement(u.a,null,L.a.createElement(l.a,{column:1,bordered:!0,size:"small"},L.a.createElement(l.a.Item,{label:"年吞吐量"},t.throughput),L.a.createElement(l.a.Item,{label:"监管人"},t.supervisionMan),L.a.createElement(l.a.Item,{label:"监管人联系方式"},t.supervisionTel))))}),Z=Object(M.connect)(function(e){var t=e.TrafficApiV2Count,a=e.GisMap,n=e.loading;return{GisMap:a,loading:n.models.GisMap,TrafficApiV2Count:t,apiV2Loading:n.models.TrafficApiV2Count}})(n=function(e){function t(e){var a;return y()(this,t),(a=C()(this,b()(t).call(this,e))).state={sourceList:[],siteList:[],siteCodeLists:[],infoVisible:!1,sourceVisible:!1,finishCountType:!1,sourceData:{},siteData:{count:[{}],siteInfo:{}}},a.getAllSite=function(){var e=Object(D.z)("organId");(0,a.props.dispatch)({type:"GisMap/allSite",payload:{cityCode:e},callback:function(e){var t=a.formatTree(e);a.setState({treeList:t})}})},a.formatTree=function(e){return e.map(function(e){return{title:e.areaName,key:e.code,siteType:0,children:e.children.length?a.formatTree(e.children).concat(a.formatSite(e.siteList)).concat(a.formatSource(e.companyList)):[].concat(a.formatSite(e.siteList)).concat(a.formatSource(e.companyList))}})},a.myIsNaN=function(e){return"number"==typeof e&&!isNaN(e)},a.formatSource=function(e){return e.map(function(e){if(a.sourceCodeList.indexOf("".concat(e.id,"-3"))){a.sourceCodeList.push("".concat(e.id,"-3"));var t=a.state,n=t.sourceList,i=t.siteCodeLists;return a.setState({sourceList:[{companyName:e.companyName,siteCode:"".concat(e.id,"-3"),siteType:"3",position:{latitude:a.myIsNaN(parseInt(e.latitude,10))?e.latitude:0,longitude:a.myIsNaN(parseInt(e.longitude,10))?e.longitude:0}}].concat(s()(n)),siteCodeLists:["".concat(e.id,"-3")].concat(s()(i))}),{siteType:"3",title:e.companyName,key:"".concat(e.id,"-3"),children:[]}}})},a.formatSite=function(e){return e.map(function(e){if(a.siteCodeList.indexOf("".concat(e.siteCode,"-").concat(e.siteType))<0){var t=a.state,n=t.siteList,i=t.siteCodeLists;a.siteCodeList.push("".concat(e.siteCode,"-").concat(e.siteType)),a.setState({siteList:[{siteName:e.siteName,siteCode:"".concat(e.siteCode,"-").concat(e.siteType),siteType:e.siteType,position:{latitude:e.latitude||0,longitude:e.longitude||0}}].concat(s()(n)),siteCodeLists:["".concat(e.siteCode,"-").concat(e.siteType)].concat(s()(i))})}return{siteType:e.siteType,title:e.siteName,key:"".concat(e.siteCode,"-").concat(e.siteType),children:[]}})},a.dyRadioChange=function(e){a.getDynamicOverLimitTop5(e.target.value)},a.staticRadioChange=function(e){a.getStaticOverLimitTop5(e.target.value)},a.handleSourceModalVisible=function(e){a.setState({sourceVisible:!!e}),e||a.setState({sourceData:{}})},a.handleModalMsgVisible=function(e){a.setState({infoVisible:!!e}),e||(a.handleFinishCountVisible(),a.setState({siteData:{count:[{}],siteInfo:{}}}))},a.handleFinishCountVisible=function(e){a.setState({finishCountType:!!e})},a.getSiteAndCount=function(e){(0,a.props.dispatch)({type:"GisMap/siteAndCount",payload:{siteCode:e.split("-")[0]},callback:function(e){a.handleModalMsgVisible(!0),a.setState({siteData:e})}})},a.getCompanyAndCount=function(e){(0,a.props.dispatch)({type:"GisMap/companyAndCount",payload:{id:e.split("-")[0]},callback:function(e){a.handleSourceModalVisible(!0),a.setState({sourceData:e})}})},a.markerEvents={click:function(e,t){var n=t.getExtData();a.getSiteAndCount(n.siteCode)}},a.markerSourceEvents={click:function(e,t){var n=t.getExtData();a.getCompanyAndCount(n.siteCode)}},a.renderMarkerLayout=function(e){var t={width:25};return"1"===e.siteType?L.a.createElement("a",{href:"javascript:void(0)",title:e.siteName},L.a.createElement("img",{src:P.a,style:t,alt:""})):"2"===e.siteType?L.a.createElement("a",{href:"javascript:void(0)",title:e.siteName},L.a.createElement("img",{src:R.a,style:t,alt:""})):L.a.createElement("a",{href:"javascript:void(0)",title:e.companyName},L.a.createElement("img",{src:W.a,style:t,alt:""}))},a.completionCode=function(e){for(var t="",a=0;a<6-e.length;a+=1)t+="0";return parseInt(e+t,10)},a.onFinishCount=function(){c.a.warning({title:"提示",content:"已到检定时间"}),a.handleFinishCountVisible(!0)},a.sourcePrev=function(){a.mySourceCarousel.prev()},a.sourceNext=function(){a.mySourceCarousel.next()},a.sitePrev=function(){a.mySiteCarousel.prev()},a.siteNext=function(){a.mySiteCarousel.next()},a.mySiteCarousel=L.a.createRef(),a.mySourceCarousel=L.a.createRef(),a.siteCodeList=[],a.sourceCodeList=[],a}return N()(t,e),g()(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.getAllSite()},500)}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){},X&&X.destroy()}},{key:"render",value:function(){var e=this,t=this.state,a=t.siteList,n=t.sourceList,i=t.infoVisible,r=t.siteData,s=t.finishCountType,l=t.sourceData,c=t.sourceVisible,u={data:r,handleModalVisible:this.handleModalMsgVisible,onFinishCount:this.onFinishCount,finishCountType:s,handleFinishCountVisible:this.handleFinishCountVisible,prev:this.sitePrev,next:this.siteNext},m={data:l,handleModalVisible:this.handleSourceModalVisible,prev:this.sourcePrev,next:this.sourceNext};return L.a.createElement("div",null,Object(D.c)(H[0])?null:L.a.createElement(w.a,{to:"/exception/403"}),L.a.createElement("div",{style:{height:"calc(100vh - 65px)",margin:"-20px -20px -20px -20px",background:"#fff",position:"relative"}},i&&"{}"!==JSON.stringify(r.siteInfo)?L.a.createElement(Q,o()({mySiteCarousel:function(t){return e.mySiteCarousel=t}},u,{modalVisible:i})):null,c&&JSON.stringify(l)?L.a.createElement(Y,o()({mySourceCarousel:function(t){return e.mySourceCarousel=t}},m,{modalVisible:c})):null,L.a.createElement(I.Map,{amapkey:"33d3572b08475f40fbec1241868fcbb8",useAMapUI:!0},L.a.createElement(B,null),a.length?L.a.createElement(I.Markers,{markers:a,events:this.markerEvents,render:this.renderMarkerLayout}):null,n.length?L.a.createElement(I.Markers,{markers:n,events:this.markerSourceEvents,render:this.renderMarkerLayout}):null),L.a.createElement("div",{className:"".concat(O.a.mapLeft," ").concat(O.a.onClose)},L.a.createElement("div",{className:O.a.printType},L.a.createElement("div",{className:O.a.printTypeItem},L.a.createElement("img",{src:P.a,alt:""}),"动态站点"),L.a.createElement("div",{className:O.a.printTypeItem},L.a.createElement("img",{src:R.a,alt:""}),"静态站点"),L.a.createElement("div",{className:O.a.printTypeItem},L.a.createElement("img",{src:W.a,alt:""}),"源头企业")))))}}]),t}(k.PureComponent))||n;t.default=Z}}]);