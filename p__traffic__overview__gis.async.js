(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{XJfC:function(e,t,a){"use strict";a.r(t);var n,i=a("RIqP"),r=a.n(i),l=a("pVnL"),o=a.n(l),s=(a("5Dmo"),a("3S7+")),c=(a("bP8k"),a("gFTJ")),d=(a("2qtc"),a("kLXV")),u=(a("IzEo"),a("bx4M")),m=(a("fV52"),a("3I+P")),p=(a("Pwec"),a("CtXQ")),f=(a("y8nQ"),a("Vl3Y")),h=a("lwsE"),y=a.n(h),g=a("W8MJ"),v=a.n(g),C=a("a1gu"),E=a.n(C),N=a("Nsbk"),b=a.n(N),T=a("7W2i"),S=a.n(T),L=(a("aHsQ"),a("sGsY")),k=(a("ozfa"),a("MJZm")),I=(a("7Kak"),a("9yH6")),V=a("q1tI"),M=a.n(V),x=a("7DBZ"),A=a("MuoO"),w=a("CkN6"),O=a("Py4S"),D=a.n(O),F=a("mf+E"),R=a("2c/C"),P=a.n(R),G=a("+n12"),j=a("9X8c"),H=a.n(j),U=a("mn69"),B=a.n(U),J=a("15hv"),W=a.n(J),z=a("0jMW"),X=a.n(z),_=(a("i1Va"),I.a.Group),q=k.a.TreeNode,Q=L.a.Countdown,K=["/overview/gis"],Y=null,Z=null,$=null,ee=function(e){function t(e){var a;return y()(this,t),(a=E()(this,b()(t).call(this,e))).getOrganId=function(){for(var e=localStorage.getItem("organId")||"510000",t=6-e.length,a=0;a<t;a+=1)e+="0";return e},a.switchAreaNode=function(e){$&&""+$.getAdcode()==""+e||Z.loadAreaNode(e,function(t,n){$=window.currentAreaNode=n,Z.setAreaNodesForLocating([$]),Z.setHoverFeature(null),a.renderAreaPolygons(e)})},a.loadUI=function(e){window.AMapUI.loadUI(["geo/DistrictExplorer"],function(t){Z=new t({map:Y}),a.renderAreaPolygons(e)})},a.renderAreaPolygons=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:51e4;Z.loadAreaNode(e,function(e,t){(t||void 0!==t)&&(Y.setBounds(t.getBounds(),null,null,!0),Z.clearFeaturePolygons(),Z.renderParentFeature(t,{cursor:"default",bubble:!0,strokeColor:"#000",strokeOpacity:.5,strokeWeight:1,fillColor:"#fff",fillOpacity:.5}))})},a}return S()(t,e),v()(t,[{key:"componentDidMount",value:function(){Y=this.props.__map__;var e=this.getOrganId();this.loadUI(e)}},{key:"render",value:function(){return M.a.createElement(M.a.Fragment,null)}}]),t}(V.Component),te=f.a.create()(function(e){var t=e.data,a=e.modalVisible,n=e.handleModalVisible,i=e.onFinishCount,r=e.finishCountType,l=e.handleFinishCountVisible,o=e.mySiteCarousel,s=e.next,c=e.prev,f=t.siteInfo,h=t.count[0],y=new Date(f.verificationDate).getTime();y&&y<(new Date).getTime()&&l(!0);var g=function(){i()},v=f.siteImg?f.siteImg.split(","):[],C=v.map(function(e){return{src:G.E+e,alt:f.siteName}});return M.a.createElement(d.a,{destroyOnClose:!0,title:M.a.createElement("div",{style:{paddingRight:30,overflow:"hidden"}},M.a.createElement("span",{className:P.a.title},f.siteName),y?r?M.a.createElement("span",{className:P.a.title,style:{color:"red",float:"right"}},"已到检定时间"):M.a.createElement(Q,{onFinish:g,valueStyle:{fontSize:15,lineHeight:1},style:{float:"right"},title:"下次检定时间",value:y,format:"D 天 H 时 m 分 s 秒 SSS"}):null),visible:a,onCancel:function(){return n()},footer:null,bodyStyle:{padding:0},wrapClassName:P.a.modalMain},M.a.createElement("div",{className:P.a.myCarousel},M.a.createElement(p.a,{onClick:c,className:"".concat(P.a.pos," ").concat(P.a.prev),type:"left-circle",theme:"filled"}),M.a.createElement(p.a,{onClick:s,className:"".concat(P.a.pos," ").concat(P.a.next),type:"right-circle",theme:"filled"}),M.a.createElement(m.a,{ref:o,autoplay:!0},v.length?C.map(function(e,t){return M.a.createElement(D.a,{key:e.src,backdrop:"rgba(255,255,255,.3)",defaultPage:t,style:{height:250},src:e.src,set:C})}):M.a.createElement("img",{className:P.a.notImg,src:W.a,alt:""}))),M.a.createElement("div",{className:P.a.address},M.a.createElement(p.a,{type:"environment",style:{marginRight:5}}),f.address),M.a.createElement(u.a,null,M.a.createElement(u.a.Grid,{style:{width:"33.3333%"}},M.a.createElement(L.a,{title:"今日检测数",value:h.TOTAL,valueStyle:{color:"#0a67fb"}})),M.a.createElement(u.a.Grid,{style:{width:"33.3333%"}},M.a.createElement(L.a,{title:"今日超限数",value:h.OVERLOADTOTAL,valueStyle:{color:"#ff4343"}})),M.a.createElement(u.a.Grid,{style:{width:"33.3333%"}},M.a.createElement(L.a,{title:"今日超限率",value:(100*(h.OVERLOADTOTAL/h.TOTAL||0)).toFixed(2),precision:2,valueStyle:{color:"#d338ff"},suffix:"%"}))))}),ae=f.a.create()(function(e){var t=e.data,a=e.modalVisible,n=e.handleModalVisible,i=e.mySourceCarousel,r=e.prev,l=e.next,o=t.companyImg?t.companyImg.split(","):[],s=o.map(function(e){return{src:G.E+e,alt:t.companyName}});return M.a.createElement(d.a,{destroyOnClose:!0,title:M.a.createElement("div",{style:{padding:"8px 0"}},t.companyName),visible:a,onCancel:function(){return n()},footer:null,bodyStyle:{padding:0},wrapClassName:P.a.modalMain},M.a.createElement("div",{className:P.a.myCarousel},M.a.createElement(p.a,{onClick:r,className:"".concat(P.a.pos," ").concat(P.a.prev),type:"left-circle",theme:"filled"}),M.a.createElement(p.a,{onClick:l,className:"".concat(P.a.pos," ").concat(P.a.next),type:"right-circle",theme:"filled"}),M.a.createElement(m.a,{ref:i,autoplay:!0},o.length?s.map(function(e,t){return M.a.createElement(D.a,{key:e.src,backdrop:"rgba(255,255,255,.3)",defaultPage:t,style:{height:250},src:e.src,set:s})}):M.a.createElement("img",{className:P.a.notImg,src:W.a,alt:""}))),M.a.createElement("div",{className:P.a.address},M.a.createElement(p.a,{type:"environment",style:{marginRight:5}}),t.address),M.a.createElement(u.a,null,M.a.createElement(c.a,{column:1,bordered:!0,size:"small"},M.a.createElement(c.a.Item,{label:"年吞吐量"},t.throughput),M.a.createElement(c.a.Item,{label:"监管人"},t.supervisionMan),M.a.createElement(c.a.Item,{label:"监管人联系方式"},t.supervisionTel))))}),ne=Object(A.connect)(function(e){var t=e.TrafficApiV2Count,a=e.GisMap,n=e.loading;return{GisMap:a,loading:n.models.GisMap,TrafficApiV2Count:t,apiV2Loading:n.models.TrafficApiV2Count}})(n=function(e){function t(e){var a;return y()(this,t),(a=E()(this,b()(t).call(this,e))).columns=[{title:"站名",dataIndex:"siteName",render:function(e){return e.length>7?M.a.createElement(s.a,{title:e},"".concat(e.substring(0,7),"...")):e}},{title:"检测数",dataIndex:"total"},{title:"超限数",dataIndex:"overLoadTotal"},{title:"超限率(%)",dataIndex:"overRate",render:function(e){return"".concat(parseFloat(e).toFixed(2))}}],a.columns2=[{title:"站名",dataIndex:"siteName",render:function(e){return e.length>7?M.a.createElement(s.a,{title:e},"".concat(e.substring(0,7),"...")):e}},{title:"检测数",dataIndex:"total"},{title:"超限数",dataIndex:"overLoadTotal"},{title:"超限率(%)",dataIndex:"rate",render:function(e){return"".concat(parseFloat(100*e).toFixed(2))}}],a.state={sourceList:[],siteList:[],treeList:[],siteCodeLists:[],isRightClose:!0,isLeftClose:!0,infoVisible:!1,sourceVisible:!1,finishCountType:!1,sourceData:{},siteData:{count:[{}],siteInfo:{}}},a.getDynamicOverLimitTop5=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;(0,a.props.dispatch)({type:"TrafficApiV2Count/dynamicOverLimitTop5",payload:e})},a.getStaticOverLimitTop5=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;(0,a.props.dispatch)({type:"GisMap/staticOverLimitTop5",payload:{day:e}})},a.getAllSite=function(){var e=Object(G.z)("organId");(0,a.props.dispatch)({type:"GisMap/allSite",payload:{cityCode:e},callback:function(e){var t=a.formatTree(e);a.setState({treeList:t})}})},a.renderTree=function(){var e=a.state.treeList;return a.renderTreeNodes(e)},a.renderTreeNodes=function(e){return e.map(function(e){var t=null;return"1"===e.siteType?t={icon:M.a.createElement("img",{style:{width:15},src:H.a,alt:""})}:"2"===e.siteType?t={icon:M.a.createElement("img",{style:{width:15},src:B.a,alt:""})}:"3"===e.siteType&&(t={icon:M.a.createElement("img",{style:{width:15},src:X.a,alt:""})}),e.children.length?M.a.createElement(q,o()({},t,{title:e.title,key:e.key,dataRef:e}),a.renderTreeNodes(e.children)):M.a.createElement(q,o()({},t,e,{key:e.key}))})},a.formatTree=function(e){return e.map(function(e){return{title:e.areaName,key:e.code,siteType:0,children:e.children.length?a.formatTree(e.children).concat(a.formatSite(e.siteList)).concat(a.formatSource(e.companyList)):[].concat(a.formatSite(e.siteList)).concat(a.formatSource(e.companyList))}})},a.myIsNaN=function(e){return"number"==typeof e&&!isNaN(e)},a.formatSource=function(e){return e.map(function(e){if(a.sourceCodeList.indexOf("".concat(e.id,"-3"))){a.sourceCodeList.push("".concat(e.id,"-3"));var t=a.state,n=t.sourceList,i=t.siteCodeLists;return a.setState({sourceList:[{companyName:e.companyName,siteCode:"".concat(e.id,"-3"),siteType:"3",position:{latitude:a.myIsNaN(parseInt(e.latitude,10))?e.latitude:0,longitude:a.myIsNaN(parseInt(e.longitude,10))?e.longitude:0}}].concat(r()(n)),siteCodeLists:["".concat(e.id,"-3")].concat(r()(i))}),{siteType:"3",title:e.companyName,key:"".concat(e.id,"-3"),children:[]}}})},a.formatSite=function(e){return e.map(function(e){if(a.siteCodeList.indexOf("".concat(e.siteCode,"-").concat(e.siteType))<0){var t=a.state,n=t.siteList,i=t.siteCodeLists;a.siteCodeList.push("".concat(e.siteCode,"-").concat(e.siteType)),a.setState({siteList:[{siteName:e.siteName,siteCode:"".concat(e.siteCode,"-").concat(e.siteType),siteType:e.siteType,position:{latitude:e.latitude||0,longitude:e.longitude||0}}].concat(r()(n)),siteCodeLists:["".concat(e.siteCode,"-").concat(e.siteType)].concat(r()(i))})}return{siteType:e.siteType,title:e.siteName,key:"".concat(e.siteCode,"-").concat(e.siteType),children:[]}})},a.dyRadioChange=function(e){a.getDynamicOverLimitTop5(e.target.value)},a.staticRadioChange=function(e){a.getStaticOverLimitTop5(e.target.value)},a.handleSourceModalVisible=function(e){a.setState({sourceVisible:!!e}),e||a.setState({sourceData:{}})},a.handleModalMsgVisible=function(e){a.setState({infoVisible:!!e}),e||(a.handleFinishCountVisible(),a.setState({siteData:{count:[{}],siteInfo:{}}}))},a.handleFinishCountVisible=function(e){a.setState({finishCountType:!!e})},a.getSiteAndCount=function(e){(0,a.props.dispatch)({type:"GisMap/siteAndCount",payload:{siteCode:e.split("-")[0]},callback:function(e){a.handleModalMsgVisible(!0),a.setState({siteData:e})}})},a.getCompanyAndCount=function(e){(0,a.props.dispatch)({type:"GisMap/companyAndCount",payload:{id:e.split("-")[0]},callback:function(e){a.handleSourceModalVisible(!0),a.setState({sourceData:e})}})},a.markerEvents={click:function(e,t){var n=t.getExtData();a.getSiteAndCount(n.siteCode)}},a.markerSourceEvents={click:function(e,t){var n=t.getExtData();a.getCompanyAndCount(n.siteCode)}},a.renderMarkerLayout=function(e){var t={width:25};return"1"===e.siteType?M.a.createElement("a",{href:"javascript:void(0)",title:e.siteName},M.a.createElement("img",{src:H.a,style:t,alt:""})):"2"===e.siteType?M.a.createElement("a",{href:"javascript:void(0)",title:e.siteName},M.a.createElement("img",{src:B.a,style:t,alt:""})):M.a.createElement("a",{href:"javascript:void(0)",title:e.companyName},M.a.createElement("img",{src:X.a,style:t,alt:""}))},a.completionCode=function(e){for(var t="",a=0;a<6-e.length;a+=1)t+="0";return parseInt(e+t,10)},a.treeSelect=function(e){a.siteCodeList.indexOf(e[0])>-1?a.getSiteAndCount(e[0]):a.sourceCodeList.indexOf(e[0])>-1?a.getCompanyAndCount(e[0]):e.length&&(a.myUIMarker.switchAreaNode(a.completionCode(e[0])),a.setState({isClickArea:!0,areaCode:a.completionCode(e[0])}))},a.onFinishCount=function(){d.a.warning({title:"提示",content:"已到检定时间"}),a.handleFinishCountVisible(!0)},a.sourcePrev=function(){a.mySourceCarousel.prev()},a.sourceNext=function(){a.mySourceCarousel.next()},a.sitePrev=function(){a.mySiteCarousel.prev()},a.siteNext=function(){a.mySiteCarousel.next()},a.myUIMarker=M.a.createRef(),a.mySiteCarousel=M.a.createRef(),a.mySourceCarousel=M.a.createRef(),a.siteCodeList=[],a.sourceCodeList=[],a}return S()(t,e),v()(t,[{key:"componentDidMount",value:function(){var e=this;this.getDynamicOverLimitTop5(),this.getStaticOverLimitTop5(),setTimeout(function(){e.getAllSite()},500)}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){},Y&&Y.destroy()}},{key:"render",value:function(){var e=this,t=this.props,a=t.loading,n=t.apiV2Loading,i=t.GisMap.staticData,r=t.TrafficApiV2Count.dyTop5Data,l=this.state,s=l.isRightClose,c=l.isLeftClose,d=l.treeList,u=l.siteList,m=l.sourceList,f=l.infoVisible,h=l.siteData,y=l.siteCodeLists,g=l.finishCountType,v=l.sourceData,C=l.sourceVisible,E={tableAlert:!1,selectedRows:0,rowSelection:null,size:"small",bordered:!1,pagination:!1,columns:this.columns},N={data:h,handleModalVisible:this.handleModalMsgVisible,onFinishCount:this.onFinishCount,finishCountType:g,handleFinishCountVisible:this.handleFinishCountVisible,prev:this.sitePrev,next:this.siteNext},b={data:v,handleModalVisible:this.handleSourceModalVisible,prev:this.sourcePrev,next:this.sourceNext};return M.a.createElement("div",null,Object(G.c)(K[0])?null:M.a.createElement(F.a,{to:"/exception/403"}),M.a.createElement("div",{style:{height:"calc(100vh - 140px)",margin:"-20px -20px -20px -20px",background:"#fff",position:"relative"}},f&&"{}"!==JSON.stringify(h.siteInfo)?M.a.createElement(te,o()({mySiteCarousel:function(t){return e.mySiteCarousel=t}},N,{modalVisible:f})):null,C&&JSON.stringify(v)?M.a.createElement(ae,o()({mySourceCarousel:function(t){return e.mySourceCarousel=t}},b,{modalVisible:C})):null,M.a.createElement(x.Map,{amapkey:"33d3572b08475f40fbec1241868fcbb8",useAMapUI:!0},M.a.createElement(ee,{ref:function(t){return e.myUIMarker=t}}),u.length?M.a.createElement(x.Markers,{markers:u,events:this.markerEvents,render:this.renderMarkerLayout}):null,m.length?M.a.createElement(x.Markers,{markers:m,events:this.markerSourceEvents,render:this.renderMarkerLayout}):null),M.a.createElement("div",{className:"".concat(P.a.mapLeft," ").concat(c?"":P.a.onClose)},M.a.createElement("div",{className:P.a.treeList},d.length?M.a.createElement(k.a,{showLine:!0,showIcon:!0,defaultExpandedKeys:y,onSelect:this.treeSelect},this.renderTree()):null),M.a.createElement("div",{className:P.a.leftClose,onClick:function(){return e.setState({isLeftClose:!c})}},c?M.a.createElement(p.a,{className:P.a.closeBtn,type:"double-left"}):M.a.createElement(p.a,{className:P.a.closeBtn,type:"double-right"})),M.a.createElement("div",{className:P.a.printType},M.a.createElement("div",{className:P.a.printTypeItem},M.a.createElement("img",{src:H.a,alt:""}),"动态站点"),M.a.createElement("div",{className:P.a.printTypeItem},M.a.createElement("img",{src:B.a,alt:""}),"静态站点"),M.a.createElement("div",{className:P.a.printTypeItem},M.a.createElement("img",{src:X.a,alt:""}),"源头企业"))),M.a.createElement("div",{className:P.a.rightCloseBtn,onClick:function(){return e.setState({isRightClose:!s})}},M.a.createElement("div",{className:P.a.rotate},s?M.a.createElement(p.a,{className:P.a.closeBtn,type:"double-left"}):M.a.createElement(p.a,{className:P.a.closeBtn,type:"double-right"}))),M.a.createElement("div",{className:"".concat(P.a.mapRight," ").concat(s?"":P.a.rightClose)},M.a.createElement("div",{className:P.a.rightList},M.a.createElement("div",null,M.a.createElement("a",{href:"javascript:void(0)",className:P.a.rightTitle},"动态检测TOP5"),M.a.createElement(_,{style:{float:"right"},defaultValue:7,onChange:this.dyRadioChange},M.a.createElement(I.a,{value:7},"7天"),M.a.createElement(I.a,{value:30},"30天"),M.a.createElement(I.a,{value:90},"90天")),M.a.createElement("div",{style:{minHeight:250,marginTop:10},className:P.a.tabHeadW},M.a.createElement(w.a,o()({},E,{loading:n,data:{list:r}})))),M.a.createElement("div",null,M.a.createElement("a",{href:"javascript:void(0)",className:P.a.rightTitle},"静态检测TOP5"),M.a.createElement(_,{style:{float:"right"},defaultValue:7,onChange:this.staticRadioChange},M.a.createElement(I.a,{value:7},"7天"),M.a.createElement(I.a,{value:30},"30天"),M.a.createElement(I.a,{value:90},"90天")),M.a.createElement("div",{style:{minHeight:250,marginTop:10},className:P.a.tabHeadW},M.a.createElement(w.a,o()({},E,{loading:a,data:i,columns:this.columns2}))))))))}}]),t}(V.PureComponent))||n;t.default=ne},i1Va:function(e,t,a){e.exports=a.p+"static/map.4e1bcbf9.png"}}]);