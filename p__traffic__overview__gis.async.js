(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{XJfC:function(e,t,a){"use strict";a.r(t);var i,n=a("RIqP"),l=a.n(n),s=a("pVnL"),o=a.n(s),c=(a("5Dmo"),a("3S7+")),r=(a("bP8k"),a("gFTJ")),m=(a("2qtc"),a("kLXV")),d=(a("IzEo"),a("bx4M")),u=(a("fV52"),a("3I+P")),p=(a("Pwec"),a("CtXQ")),f=(a("y8nQ"),a("Vl3Y")),y=a("lwsE"),h=a.n(y),g=a("W8MJ"),v=a.n(g),C=a("a1gu"),E=a.n(C),N=a("Nsbk"),T=a.n(N),b=a("7W2i"),S=a.n(b),L=(a("aHsQ"),a("sGsY")),V=(a("ozfa"),a("MJZm")),k=(a("7Kak"),a("9yH6")),x=a("q1tI"),I=a.n(x),M=(a("7DBZ"),a("MuoO")),O=a("CkN6"),w=a("Py4S"),A=a.n(w),D=a("mf+E"),R=a("2c/C"),F=a.n(R),P=a("+n12"),G=a("9X8c"),j=a.n(G),B=a("mn69"),H=a.n(B),J=a("15hv"),W=a.n(J),z=a("0jMW"),X=a.n(z),q=(a("i1Va"),k.a.Group),Q=V.a.TreeNode,U=L.a.Countdown,K=["/overview/gis"],Y=null,Z=null,$=null,_=(x.Component,f.a.create()(function(e){var t=e.data,a=e.modalVisible,i=e.handleModalVisible,n=e.onFinishCount,l=e.finishCountType,s=e.handleFinishCountVisible,o=e.mySiteCarousel,c=e.next,r=e.prev,f=t.siteInfo,y=t.count[0],h=new Date(f.verificationDate).getTime();h&&h<(new Date).getTime()&&s(!0);var g=function(){n()},v=f.siteImg?f.siteImg.split(","):[],C=v.map(function(e){return{src:P.B+e,alt:f.siteName}});return I.a.createElement(m.a,{destroyOnClose:!0,title:I.a.createElement("div",{style:{paddingRight:30,overflow:"hidden"}},I.a.createElement("span",{className:F.a.title},f.siteName),h?l?I.a.createElement("span",{className:F.a.title,style:{color:"red",float:"right"}},"已到检定时间"):I.a.createElement(U,{onFinish:g,valueStyle:{fontSize:15,lineHeight:1},style:{float:"right"},title:"下次检定时间",value:h,format:"D 天 H 时 m 分 s 秒 SSS"}):null),visible:a,onCancel:function(){return i()},footer:null,bodyStyle:{padding:0},wrapClassName:F.a.modalMain},I.a.createElement("div",{className:F.a.myCarousel},I.a.createElement(p.a,{onClick:r,className:"".concat(F.a.pos," ").concat(F.a.prev),type:"left-circle",theme:"filled"}),I.a.createElement(p.a,{onClick:c,className:"".concat(F.a.pos," ").concat(F.a.next),type:"right-circle",theme:"filled"}),I.a.createElement(u.a,{ref:o,autoplay:!0},v.length?C.map(function(e,t){return I.a.createElement(A.a,{key:t,backdrop:"rgba(255,255,255,.3)",defaultPage:t,style:{height:250},src:e.src,set:C})}):I.a.createElement("img",{className:F.a.notImg,src:W.a,alt:""}))),I.a.createElement("div",{className:F.a.address},I.a.createElement(p.a,{type:"environment",style:{marginRight:5}}),f.address),I.a.createElement(d.a,null,I.a.createElement(d.a.Grid,{style:{width:"33.3333%"}},I.a.createElement(L.a,{title:"今日检测数",value:y.TOTAL,valueStyle:{color:"#0a67fb"}})),I.a.createElement(d.a.Grid,{style:{width:"33.3333%"}},I.a.createElement(L.a,{title:"今日超限数",value:y.OVERLOADTOTAL,valueStyle:{color:"#ff4343"}})),I.a.createElement(d.a.Grid,{style:{width:"33.3333%"}},I.a.createElement(L.a,{title:"今日超限率",value:(y.OVERLOADTOTAL/y.TOTAL*100).toFixed(2),precision:2,valueStyle:{color:"#d338ff"},suffix:"%"}))))})),ee=f.a.create()(function(e){var t=e.data,a=e.modalVisible,i=e.handleModalVisible,n=e.mySourceCarousel,l=e.prev,s=e.next,o=t.companyImg?t.companyImg.split(","):[],c=o.map(function(e){return{src:P.B+e,alt:t.companyName}});return I.a.createElement(m.a,{destroyOnClose:!0,title:I.a.createElement("div",{style:{padding:"8px 0"}},t.companyName),visible:a,onCancel:function(){return i()},footer:null,bodyStyle:{padding:0},wrapClassName:F.a.modalMain},I.a.createElement("div",{className:F.a.myCarousel},I.a.createElement(p.a,{onClick:l,className:"".concat(F.a.pos," ").concat(F.a.prev),type:"left-circle",theme:"filled"}),I.a.createElement(p.a,{onClick:s,className:"".concat(F.a.pos," ").concat(F.a.next),type:"right-circle",theme:"filled"}),I.a.createElement(u.a,{ref:n,autoplay:!0},o.length?c.map(function(e,t){return I.a.createElement(A.a,{key:t,backdrop:"rgba(255,255,255,.3)",defaultPage:t,style:{height:250},src:e.src,set:c})}):I.a.createElement("img",{className:F.a.notImg,src:W.a,alt:""}))),I.a.createElement("div",{className:F.a.address},I.a.createElement(p.a,{type:"environment",style:{marginRight:5}}),t.address),I.a.createElement(d.a,null,I.a.createElement(r.a,{column:1,bordered:!0,size:"small"},I.a.createElement(r.a.Item,{label:"年吞吐量"},t.throughput),I.a.createElement(r.a.Item,{label:"监管人"},t.supervisionMan),I.a.createElement(r.a.Item,{label:"监管人联系方式"},t.supervisionTel))))}),te=Object(M.connect)(function(e){var t=e.TrafficApiV2Count,a=e.GisMap,i=e.loading;return{GisMap:a,loading:i.models.GisMap,TrafficApiV2Count:t,apiV2Loading:i.models.TrafficApiV2Count}})(i=function(e){function t(e){var a;return h()(this,t),(a=E()(this,T()(t).call(this,e))).columns=[{title:"站名",dataIndex:"siteName",render:function(e){return e.length>7?I.a.createElement(c.a,{title:e},"".concat(e.substring(0,7),"...")):e}},{title:"检测数",dataIndex:"total"},{title:"超限数",dataIndex:"overLoadTotal"},{title:"超限率(%)",dataIndex:"overRate",render:function(e){return"".concat(parseFloat(e).toFixed(2))}}],a.state={sourceList:[],siteList:[],treeList:[],siteCodeLists:[],isRightClose:!0,isLeftClose:!0,infoVisible:!1,sourceVisible:!1,finishCountType:!1,sourceData:{},siteData:{count:[{}],siteInfo:{}}},a.getDynamicOverLimitTop5=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;(0,a.props.dispatch)({type:"TrafficApiV2Count/dynamicOverLimitTop5",payload:e})},a.getStaticOverLimitTop5=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;(0,a.props.dispatch)({type:"GisMap/staticOverLimitTop5",payload:{day:e}})},a.getAllSite=function(){var e=Object(P.w)("organId");(0,a.props.dispatch)({type:"GisMap/allSite",payload:{cityCode:e},callback:function(e){var t=a.formatTree(e);a.setState({treeList:t})}})},a.renderTree=function(){var e=a.state.treeList;return a.renderTreeNodes(e)},a.renderTreeNodes=function(e){return e.map(function(e){var t=null;return"1"===e.siteType?t={icon:I.a.createElement("img",{style:{width:15},src:j.a,alt:""})}:"2"===e.siteType?t={icon:I.a.createElement("img",{style:{width:15},src:H.a,alt:""})}:"3"===e.siteType&&(t={icon:I.a.createElement("img",{style:{width:15},src:X.a,alt:""})}),e.children.length?I.a.createElement(Q,o()({},t,{title:e.title,key:e.key,dataRef:e}),a.renderTreeNodes(e.children)):I.a.createElement(Q,o()({},t,e,{key:e.key}))})},a.formatTree=function(e){return e.map(function(e){return{title:e.areaName,key:e.code,siteType:0,children:e.children.length?a.formatTree(e.children).concat(a.formatSite(e.siteList)).concat(a.formatSource(e.companyList)):[].concat(a.formatSite(e.siteList)).concat(a.formatSource(e.companyList))}})},a.myIsNaN=function(e){return"number"==typeof e&&!isNaN(e)},a.formatSource=function(e){return e.map(function(e){if(a.sourceCodeList.indexOf("".concat(e.id,"-3"))){a.sourceCodeList.push("".concat(e.id,"-3"));var t=a.state,i=t.sourceList,n=t.siteCodeLists;return a.setState({sourceList:[{companyName:e.companyName,siteCode:"".concat(e.id,"-3"),siteType:"3",position:{latitude:a.myIsNaN(parseInt(e.latitude,10))?e.latitude:0,longitude:a.myIsNaN(parseInt(e.longitude,10))?e.longitude:0}}].concat(l()(i)),siteCodeLists:["".concat(e.id,"-3")].concat(l()(n))}),{siteType:"3",title:e.companyName,key:"".concat(e.id,"-3"),children:[]}}})},a.formatSite=function(e){return e.map(function(e){if(a.siteCodeList.indexOf("".concat(e.siteCode,"-").concat(e.siteType))<0){var t=a.state,i=t.siteList,n=t.siteCodeLists;a.siteCodeList.push("".concat(e.siteCode,"-").concat(e.siteType)),a.setState({siteList:[{siteName:e.siteName,siteCode:"".concat(e.siteCode,"-").concat(e.siteType),siteType:e.siteType,position:{latitude:e.latitude||0,longitude:e.longitude||0}}].concat(l()(i)),siteCodeLists:["".concat(e.siteCode,"-").concat(e.siteType)].concat(l()(n))})}return{siteType:e.siteType,title:e.siteName,key:"".concat(e.siteCode,"-").concat(e.siteType),children:[]}})},a.dyRadioChange=function(e){a.getDynamicOverLimitTop5(e.target.value)},a.staticRadioChange=function(e){a.getStaticOverLimitTop5(e.target.value)},a.handleSourceModalVisible=function(e){a.setState({sourceVisible:!!e}),e||a.setState({sourceData:{}})},a.handleModalMsgVisible=function(e){a.setState({infoVisible:!!e}),e||(a.handleFinishCountVisible(),a.setState({siteData:{count:[{}],siteInfo:{}}}))},a.handleFinishCountVisible=function(e){a.setState({finishCountType:!!e})},a.getSiteAndCount=function(e){(0,a.props.dispatch)({type:"GisMap/siteAndCount",payload:{siteCode:e.split("-")[0]},callback:function(e){a.handleModalMsgVisible(!0),a.setState({siteData:e})}})},a.getCompanyAndCount=function(e){(0,a.props.dispatch)({type:"GisMap/companyAndCount",payload:{id:e.split("-")[0]},callback:function(e){a.handleSourceModalVisible(!0),a.setState({sourceData:e})}})},a.markerEvents={click:function(e,t){var i=t.getExtData();a.getSiteAndCount(i.siteCode)}},a.markerSourceEvents={click:function(e,t){var i=t.getExtData();a.getCompanyAndCount(i.siteCode)}},a.renderMarkerLayout=function(e){var t={width:25};return"1"===e.siteType?I.a.createElement("a",{href:"javascript:void(0)",title:e.siteName},I.a.createElement("img",{src:j.a,style:t,alt:""})):"2"===e.siteType?I.a.createElement("a",{href:"javascript:void(0)",title:e.siteName},I.a.createElement("img",{src:H.a,style:t,alt:""})):I.a.createElement("a",{href:"javascript:void(0)",title:e.companyName},I.a.createElement("img",{src:X.a,style:t,alt:""}))},a.completionCode=function(e){for(var t="",a=0;a<6-e.length;a+=1)t+="0";return parseInt(e+t,10)},a.treeSelect=function(e){a.siteCodeList.indexOf(e[0])>-1?a.getSiteAndCount(e[0]):a.sourceCodeList.indexOf(e[0])>-1?a.getCompanyAndCount(e[0]):e.length&&(a.myUIMarker.switchAreaNode(a.completionCode(e[0])),a.setState({isClickArea:!0,areaCode:a.completionCode(e[0])}))},a.onFinishCount=function(){m.a.warning({title:"提示",content:"已到检定时间"}),a.handleFinishCountVisible(!0)},a.sourcePrev=function(){a.mySourceCarousel.prev()},a.sourceNext=function(){a.mySourceCarousel.next()},a.sitePrev=function(){a.mySiteCarousel.prev()},a.siteNext=function(){a.mySiteCarousel.next()},a.myUIMarker=I.a.createRef(),a.mySiteCarousel=I.a.createRef(),a.mySourceCarousel=I.a.createRef(),a.siteCodeList=[],a.sourceCodeList=[],a}return S()(t,e),v()(t,[{key:"componentDidMount",value:function(){var e=this;this.getDynamicOverLimitTop5(),this.getStaticOverLimitTop5(),setTimeout(function(){e.getAllSite()},500)}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){},Y&&Y.destroy()}},{key:"render",value:function(){var e=this,t=this.props,a=t.loading,i=t.apiV2Loading,n=t.GisMap.staticData,l=t.TrafficApiV2Count.dyTop5Data,s=this.state,c=s.isRightClose,r=s.isLeftClose,m=s.treeList,d=(s.siteList,s.sourceList,s.infoVisible),u=s.siteData,f=s.siteCodeLists,y=s.finishCountType,h=s.sourceData,g=s.sourceVisible,v={tableAlert:!1,selectedRows:0,rowSelection:null,size:"small",bordered:!1,pagination:!1,columns:this.columns},C={data:u,handleModalVisible:this.handleModalMsgVisible,onFinishCount:this.onFinishCount,finishCountType:y,handleFinishCountVisible:this.handleFinishCountVisible,prev:this.sitePrev,next:this.siteNext},E={data:h,handleModalVisible:this.handleSourceModalVisible,prev:this.sourcePrev,next:this.sourceNext};return I.a.createElement("div",null,Object(P.b)(K[0])?null:I.a.createElement(D.a,{to:"/exception/403"}),I.a.createElement("div",{style:{height:"calc(100vh - 140px)",margin:"-20px -20px -20px -20px",background:"#fff",position:"relative"}},d&&"{}"!==JSON.stringify(u.siteInfo)?I.a.createElement(_,o()({mySiteCarousel:function(t){return e.mySiteCarousel=t}},C,{modalVisible:d})):null,g&&JSON.stringify(h)?I.a.createElement(ee,o()({mySourceCarousel:function(t){return e.mySourceCarousel=t}},E,{modalVisible:g})):null,I.a.createElement("div",{className:F.a.mapImg}),I.a.createElement("div",{className:"".concat(F.a.mapLeft," ").concat(r?"":F.a.onClose)},I.a.createElement("div",{className:F.a.treeList},m.length?I.a.createElement(V.a,{showLine:!0,showIcon:!0,defaultExpandedKeys:f,onSelect:this.treeSelect},this.renderTree()):null),I.a.createElement("div",{className:F.a.leftClose,onClick:function(){return e.setState({isLeftClose:!r})}},r?I.a.createElement(p.a,{className:F.a.closeBtn,type:"double-left"}):I.a.createElement(p.a,{className:F.a.closeBtn,type:"double-right"})),I.a.createElement("div",{className:F.a.printType},I.a.createElement("div",{className:F.a.printTypeItem},I.a.createElement("img",{src:j.a,alt:""}),"动态站点"),I.a.createElement("div",{className:F.a.printTypeItem},I.a.createElement("img",{src:H.a,alt:""}),"静态站点"),I.a.createElement("div",{className:F.a.printTypeItem},I.a.createElement("img",{src:X.a,alt:""}),"源头企业"))),I.a.createElement("div",{className:F.a.rightCloseBtn,onClick:function(){return e.setState({isRightClose:!c})}},I.a.createElement("div",{className:F.a.rotate},c?I.a.createElement(p.a,{className:F.a.closeBtn,type:"double-left"}):I.a.createElement(p.a,{className:F.a.closeBtn,type:"double-right"}))),I.a.createElement("div",{className:"".concat(F.a.mapRight," ").concat(c?"":F.a.rightClose)},I.a.createElement("div",{className:F.a.rightList},I.a.createElement("div",null,I.a.createElement("a",{href:"javascript:void(0)",className:F.a.rightTitle},"动态检测TOP5"),I.a.createElement(q,{style:{float:"right"},defaultValue:7,onChange:this.dyRadioChange},I.a.createElement(k.a,{value:7},"7天"),I.a.createElement(k.a,{value:30},"30天"),I.a.createElement(k.a,{value:90},"90天")),I.a.createElement("div",{style:{minHeight:250,marginTop:10},className:F.a.tabHeadW},I.a.createElement(O.a,o()({},v,{loading:i,data:{list:l}})))),I.a.createElement("div",null,I.a.createElement("a",{href:"javascript:void(0)",className:F.a.rightTitle},"静态检测TOP5"),I.a.createElement(q,{style:{float:"right"},defaultValue:7,onChange:this.staticRadioChange},I.a.createElement(k.a,{value:7},"7天"),I.a.createElement(k.a,{value:30},"30天"),I.a.createElement(k.a,{value:90},"90天")),I.a.createElement("div",{style:{minHeight:250,marginTop:10},className:F.a.tabHeadW},I.a.createElement(O.a,o()({},v,{loading:a,data:n}))))))))}}]),t}(x.PureComponent))||i;t.default=te},i1Va:function(e,t,a){e.exports=a.p+"static/map.4e1bcbf9.png"}}]);