(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{"zbA+":function(e,t,a){"use strict";a.r(t);a("T2oS");var n,i=a("W9HT"),r=(a("14J3"),a("BMrR")),l=(a("+L6B"),a("2/Rp")),o=(a("jCWc"),a("kPKH")),s=(a("IzEo"),a("bx4M")),c=(a("aHsQ"),a("sGsY")),m=(a("R9oj"),a("ECub")),p=a("MVZn"),u=a.n(p),d=a("lwsE"),h=a.n(d),f=a("W8MJ"),g=a.n(f),E=a("a1gu"),y=a.n(E),x=a("Nsbk"),v=a.n(x),S=a("7W2i"),C=a.n(S),M=(a("iQDF"),a("+eQT")),T=(a("OaEy"),a("2fM7")),Y=(a("y8nQ"),a("Vl3Y")),b=a("q1tI"),w=a.n(b),L=a("MuoO"),N=a("wd/R"),D=a.n(N),A=a("mf+E"),V=a("cVA7"),P=a.n(V),R=a("ns75"),F=a.n(R),G=a("9zHi"),k=a.n(G),H=a("+n12"),I=Y.a.Item,O=T.a.Option,W=M.a.MonthPicker,B=["/datavideo/shaft"],j=["#1890ff","#2fc25b","#13c2c2","#facc14"],z=Object(L.connect)(function(e){var t=e.system,a=e.TrafficApiV2Count,n=e.ChartStatistics;return{system:t,TrafficApiV2Count:a,loading:e.loading.models.TrafficApiV2Count,ChartStatistics:n}})(n=Y.a.create()(n=function(e){function t(){var e,a;h()(this,t);for(var n=arguments.length,i=new Array(n),p=0;p<n;p++)i[p]=arguments[p];return(a=y()(this,(e=v()(t)).call.apply(e,[this].concat(i)))).state={userSite:[],dateType:1,isopen:!1,formValues:{origin:1,siteCode:"",dateType:1,dateStr:D()(new Date).format("YYYY-MM-DD")}},a.handlePanelChange=function(e){a.props.form.setFieldsValue({dateStr:e}),a.setState({isopen:!1})},a.handleOpenChange=function(e){e?a.setState({isopen:!0}):a.setState({isopen:!1})},a.getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.props.dispatch)({type:"TrafficApiV2Count/axleCount",payload:e})},a.getUserSite=function(e,t){(0,a.props.dispatch)({type:"system/userSite",payload:{siteType:e},callback:function(e){var a=e.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]]}});t(a)}})},a.handleSearch=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var n=u()({},t),i="YYYY-MM-DD";2===n.dateType?i="YYYY-MM":3===n.dateType&&(i="YYYY"),n.dateStr=D()(n.dateStr).format(i),a.setState({formValues:n}),a.getList(n)}})},a.handleFormReset=function(){a.props.form.resetFields();var e={origin:1,siteCode:"",dateType:1,dateStr:D()(new Date).format("YYYY-MM-DD")};a.setState({formValues:e}),a.getList(e),a.getUserSite(1,function(e){a.setState({userSite:e})})},a.renderProportion=function(){var e=a.props.TrafficApiV2Count.axleData;if(!e.length)return w.a.createElement(m.a,{image:m.a.PRESENTED_IMAGE_SIMPLE});for(var t=0,n=0;n<e.length;n+=1)t+=parseInt(e[n].total,10);return e.map(function(e){return w.a.createElement(s.a.Grid,{style:{width:"20%"},key:e.axle},w.a.createElement(c.a,{style:{textAlign:"center"},title:"".concat(e.axle,"轴占比"),precision:2,valueStyle:{color:"#13c2c2"},value:(e.total/t*100).toFixed(2),suffix:"%"}))})},a.getLineChart=function(){var e=a.props.TrafficApiV2Count.axleData,t=e.map(function(e){return"".concat(e.axle,"轴")}),n=[{name:"检测数",type:"bar",smooth:!0,barMaxWidth:13,data:e.map(function(e){return e.total})},{name:"超限数",type:"bar",smooth:!0,barMaxWidth:13,data:e.map(function(e){return e.overTotal})},{name:"超限率",type:"line",smooth:!0,data:e.map(function(e){return"".concat((e.overTotal/(e.total||1)*100).toFixed(2))}),yAxisIndex:1}],i={color:j,title:{text:"轴型超限率统计",textStyle:{fontSize:"15",fontWeight:300}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{right:"0",data:["检测数","超限数","超限率"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",axisTick:{alignWithLabel:!0},data:t},yAxis:[{type:"value",name:"超限数"},{type:"value",name:"超限率",axisLabel:{formatter:"{value}%"}}],series:n};return e.length?w.a.createElement(P.a,{option:i,style:{height:"calc(100vh - 395px)"}}):w.a.createElement(m.a,{style:{height:"calc(100vh - 459px)",lineHeight:"calc(100vh - 459px)"},image:m.a.PRESENTED_IMAGE_SIMPLE})},a.pieChart=function(){for(var e=a.props.TrafficApiV2Count.axleData,t=0,n=0;n<e.length;n+=1)t+=parseInt(e[n].total,10);var i=e.map(function(e){return{value:(e.overTotal/(t||1)*100).toFixed(2),name:"".concat(e.axle,"轴")}}),r={color:j,title:{text:"轴型统计",textStyle:{fontSize:"15",fontWeight:300}},tooltip:{trigger:"item",formatter:"{b}: {c}%"},legend:{orient:"vertical",right:0,data:e.map(function(e){return"".concat(e.axle,"轴")})},series:[{name:"",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!0,position:"center",fontSize:"18",color:"green",formatter:"总检测数\n\n".concat(t)}},labelLine:{normal:{show:!1}},data:i}]};return e.length?w.a.createElement(P.a,{option:r,style:{height:"calc(100vh - 395px)"}}):w.a.createElement(m.a,{style:{height:"calc(100vh - 459px)",lineHeight:"calc(100vh - 459px)"},image:m.a.PRESENTED_IMAGE_SIMPLE})},a.dateTypeChange=function(e){a.setState({dateType:e})},a.originChange=function(e){a.getUserSite(e,function(e){a.setState({userSite:e})})},a.renderForm=function(){var e=a.props.form.getFieldDecorator,t=a.state,n=t.userSite,i=t.dateType,s=t.isopen;return w.a.createElement(Y.a,{onSubmit:a.handleSearch,layout:"inline"},w.a.createElement(r.a,{gutter:{md:8}},w.a.createElement(o.a,{md:4,sm:24},w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"65px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"来源"),w.a.createElement(I,{style:{flex:1,marginBottom:0}},e("origin",{initialValue:1})(w.a.createElement(T.a,{onChange:a.originChange,className:F.a.inputGroupLeftRadius,placeholder:"请选择"},w.a.createElement(O,{value:1},"动态检测"),w.a.createElement(O,{value:2},"静态检测")))))),w.a.createElement(o.a,{md:5,sm:24},w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"65px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"站点"),w.a.createElement(I,{style:{flex:1,marginBottom:0}},e("siteCode")(w.a.createElement(T.a,{className:F.a.inputGroupLeftRadius,placeholder:"请选择"},n.map(function(e){return w.a.createElement(O,{key:e.code,value:e.code},e.name)})))))),w.a.createElement(o.a,{md:5,sm:24},w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"时间类型"),w.a.createElement(I,{style:{flex:1,marginBottom:0}},e("dateType",{initialValue:1})(w.a.createElement(T.a,{className:F.a.inputGroupLeftRadius,placeholder:"请选择",onChange:a.dateTypeChange},w.a.createElement(O,{value:1},"天"),w.a.createElement(O,{value:2},"月"),w.a.createElement(O,{value:3},"年")))))),w.a.createElement(o.a,{md:5,sm:24},1===i?w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"日期选择"),w.a.createElement(I,{style:{flex:1,marginBottom:0}},e("dateStr")(w.a.createElement(M.a,{className:F.a.inputGroupLeftRadius,style:{width:"100%"}})))):null,2===i?w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"月份选择"),w.a.createElement(I,{style:{flex:1,marginBottom:0}},e("dateStr")(w.a.createElement(W,{format:"YYYY-MM",className:F.a.inputGroupLeftRadius,style:{width:"100%"}})))):null,3===i?w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"年份选择"),w.a.createElement(I,{style:{flex:1,marginBottom:0}},e("dateStr")(w.a.createElement(M.a,{open:s,mode:"year",format:"YYYY",style:{width:"100%"},className:F.a.inputGroupLeftRadius,onOpenChange:a.handleOpenChange,onPanelChange:a.handlePanelChange})))):null),w.a.createElement(o.a,{md:5,sm:24},w.a.createElement("div",{style:{overflow:"hidden"}},w.a.createElement("div",{style:{float:"right"}},w.a.createElement(l.a,{type:"primary",htmlType:"submit"},"查询"),w.a.createElement(l.a,{style:{marginLeft:8},onClick:a.handleFormReset},"重置"))))))},a}return C()(t,e),g()(t,[{key:"componentDidMount",value:function(){var e=this;if(Object(H.c)(B[0])){var t=this.state.formValues;this.getList(t),this.getUserSite(t.origin,function(t){e.setState({userSite:t})})}}},{key:"render",value:function(){var e=this.props.loading;return w.a.createElement(b.Fragment,null,Object(H.c)(B[0])?null:w.a.createElement(A.a,{to:"/exception/403"}),w.a.createElement(s.a,{bordered:!1},w.a.createElement("div",{className:k.a.tableListForm},this.renderForm())),w.a.createElement("div",null,w.a.createElement(s.a,{bordered:!1,style:{marginTop:8}},w.a.createElement(s.a.Grid,{style:{width:"70%"}},w.a.createElement(i.a,{spinning:e},this.getLineChart())),w.a.createElement(s.a.Grid,{style:{width:"30%"}},w.a.createElement(i.a,{spinning:e},this.pieChart())),w.a.createElement(s.a.Grid,{style:{width:"100%",height:155}},w.a.createElement(i.a,{spinning:e},this.renderProportion())))))}}]),t}(b.PureComponent))||n)||n;t.default=z}}]);