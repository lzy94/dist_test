(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{r4aN:function(e,t,a){e.exports={main:"antd-pro-pages-real-time-monitor-style-main",siteMenu:"antd-pro-pages-real-time-monitor-style-siteMenu",carMain:"antd-pro-pages-real-time-monitor-style-carMain",carImg:"antd-pro-pages-real-time-monitor-style-carImg",item:"antd-pro-pages-real-time-monitor-style-item",imgItem:"antd-pro-pages-real-time-monitor-style-imgItem",videoMonitor:"antd-pro-pages-real-time-monitor-style-videoMonitor",table:"antd-pro-pages-real-time-monitor-style-table",Monitor:"antd-pro-pages-real-time-monitor-style-Monitor",mask:"antd-pro-pages-real-time-monitor-style-mask",icon:"antd-pro-pages-real-time-monitor-style-icon"}},wt6j:function(e,t,a){"use strict";a.r(t);a("T2oS");var i,n=a("W9HT"),r=(a("bbsP"),a("/wGt")),l=(a("R9oj"),a("ECub")),c=(a("g9YV"),a("wCAj")),s=(a("Pwec"),a("CtXQ")),o=a("pVnL"),m=a.n(o),d=(a("miYZ"),a("tsqr")),u=a("RIqP"),p=a.n(u),f=(a("5Dmo"),a("3S7+")),v=(a("+L6B"),a("2/Rp")),y=(a("+BJd"),a("mr32")),g=a("lwsE"),h=a.n(g),L=a("W8MJ"),E=a.n(L),w=a("a1gu"),D=a.n(w),N=a("Nsbk"),b=a.n(N),I=a("7W2i"),k=a.n(I),S=(a("ozfa"),a("MJZm")),x=a("q1tI"),M=a.n(x),V=a("MuoO"),T=a("zH15"),C=a.n(T),R=a("dNE1"),B=a.n(R),P=a("90cL"),F=a("zOGa"),J=a("r4aN"),A=a.n(J),K=a("VqBU"),O=a.n(K),z=a("bkni"),W=a.n(z),U=a("+n12"),j=S.a.TreeNode,q=null,H=Object(V.connect)(function(e){var t=e.TrafficApiV2BusData,a=e.Live,i=e.loading;return{Live:a,TrafficApiV2BusData:t,apiV2Loading:i.models.TrafficApiV2BusData,loading:i.models.Live}})(i=function(e){function t(e){var a;return h()(this,t),(a=D()(this,b()(t).call(this,e))).state={treeList:[],selectedKeys:[],liveData:[],imgList:[],dataList:[],drawerLiveVisible:!1,drawerVisible:!1,detailDrawerVisible:!1,DynamicLoading:!1},a.columns=[{title:"站点名称",dataIndex:"siteName",width:200},{title:"车牌号",dataIndex:"carNo",width:150},{title:"轴数",dataIndex:"axleNumber",width:100},{title:"总重",dataIndex:"totalLoad",width:100,render:function(e){return(e/1e3).toFixed(2)+" t"}},{title:"超载",width:100,dataIndex:"overLoad",render:function(e){return e>0?M.a.createElement(y.a,{color:"red"},(e/1e3).toFixed(2)," t"):(e/1e3).toFixed(2)+" t"}},{title:"超重比",width:100,dataIndex:"overLoadRate",render:function(e){return e>.05?M.a.createElement(y.a,{color:"red"},(100*e).toFixed(2)," %"):(100*e).toFixed(2)+" %"}},{title:"操作",key:"operation",width:100,render:function(e,t){return M.a.createElement(f.a,null,M.a.createElement(v.a,{onClick:function(){return a.getDetail(t)},type:"primary",shape:"circle",icon:"eye",size:"small"}))}}],a.closeSocket=function(){q&&(q.disconnect(),q=null)},a.initWebSocket=function(e){a.closeSocket(),a.connection(e)},a.onMessage=function(e){var t=a.state,i=t.dataList,n=t.imgList,r=JSON.parse(e.body).dynamicDataMsg;r.key=(new Date).getTime();var l=[r].concat(p()(i));if(r.totalLoad>=1e4){var c=JSON.parse(JSON.stringify(n));3===c.length&&c.slice(2,1);var s=[r].concat(p()(c));a.setState({imgList:s})}a.setState({dataList:l})},a.connection=function(e){var t=new C.a(U.O);(q=B.a.over(t)).connect({Authorization:""},function(){d.a.success("连接建立成功"),q.subscribe("/topic/".concat(e),a.onMessage)},function(e){d.a.error("连接建立失败")})},a.getDetail=function(e){a.setState({DynamicLoading:!0}),(0,a.props.dispatch)({type:"TrafficApiV2BusData/dyDataDetail",payload:e.id,callback:function(){a.closeDetailDrawerVisible(!0)}}),setTimeout(function(){return a.setState({DynamicLoading:!1})},500)},a.getLiveUrl=function(e,t){(0,a.props.dispatch)({type:"Live/fetch",payload:{channel:e},callback:function(e){"200"!==e.Header.ErrorNum?d.a.error("路径调用失败"):t(U.H+e.Body.URL)}})},a.getTreeList=function(){(0,a.props.dispatch)({type:"Live/userSite",payload:{siteIds:(localStorage.getItem("siteIds")||"").split(",")},callback:function(e){var t=a.formatTree(e);a.setState({treeList:t})}})},a.formatTree=function(e){return e.map(function(e,t){return{title:e.siteName,key:"".concat(e.siteCode,",").concat(t),type:0,children:[],child:e.sysMediaConfs.length?a.sysMediaConfs(e.sysMediaConfs):[]}})},a.sysMediaConfs=function(e){return e.map(function(e){return{title:e.mediaName,key:"".concat(e.id,"-").concat(e.lanNo,"-").concat(e.mediaNo),type:1,children:[]}}).filter(function(e){return e})},a.renderTree=function(e){return e.map(function(e){var t=null;return t=1===e.type?{icon:M.a.createElement("img",{style:{width:15},src:O.a,alt:""})}:{icon:M.a.createElement("img",{style:{width:15},src:W.a,alt:""})},e.children.length?M.a.createElement(j,m()({},t,{title:e.title,key:e.key,dataRef:e}),a.renderTree(e.children)):M.a.createElement(j,m()({},t,e,{key:e.key}))})},a.treeSelect=function(e,t){var i=a.state.treeList;if(a.setState({selectedKeys:e}),e.length){var n=e[0];if(/-/.test(n)){var r=n.split("-")[2];a.getLiveUrl(r,function(e){a.playerLive(e),a.setState({selectedKeys:[]}),a.closeLiveDrawer()})}else{var l=n.split(",")[1];a.setState({liveData:i[l].child}),a.closeDrawer(),q&&(q.disconnect(),q=null),a.initWebSocket(n.split(",")[0])}}},a.renderImgItem=function(e){var t=a.state.imgList;if(t.length){var i=t[e];if(i)return M.a.createElement(x.Fragment,null,M.a.createElement("div",{className:A.a.imgItem},M.a.createElement("p",null,"车牌号：",i.carNo),M.a.createElement("p",null,"轴数：",i.axleNumber),M.a.createElement("p",null,"总重：",(i.totalLoad/1e3).toFixed(2)," t"),M.a.createElement("p",null,"超载：",i.overLoad>0?(i.overLoad/1e3).toFixed(2):0," t"),M.a.createElement("p",null,"超重比：",(100*i.overLoadRate).toFixed(2)," %")),M.a.createElement("div",{className:A.a.imgItem},M.a.createElement("img",{src:i.frontPic,alt:"车辆正面"})),M.a.createElement("div",{className:A.a.imgItem},M.a.createElement("img",{src:i.backtPic,alt:"车辆尾部"})),M.a.createElement("div",{className:A.a.imgItem},M.a.createElement("img",{src:i.leftPic,alt:"车辆侧面"})))}},a.closeDrawer=function(e){a.setState({drawerVisible:!!e,selectedKeys:[]})},a.closeLiveDrawer=function(e){a.setState({drawerLiveVisible:!!e,selectedKeys:[]})},a.closeDetailDrawerVisible=function(e){a.setState({detailDrawerVisible:!!e}),e||a.resetDetail()},a.resetDetail=function(){(0,a.props.dispatch)({type:"TrafficApiV2BusData/resetDetail"})},a.setIndexPlayerLive=function(e){a.liveIndex=e,a.closeLiveDrawer(!0)},a.playerLive=function(e){var t=[a.videoLeft,a.videoRight];t[a.liveIndex].player.pause(),t[a.liveIndex].player.src(e)},a.liveIndex=0,a.videoLeft=M.a.createRef(),a.videoRight=M.a.createRef(),a}return k()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.getTreeList()}},{key:"componentWillUnmount",value:function(){this.closeSocket()}},{key:"render",value:function(){var e=this,t=this.props.TrafficApiV2BusData.dyDataDetail.busDynamicLawDate,a=this.state,i=a.drawerVisible,o=a.DynamicLoading,m=a.detailDrawerVisible,d=a.dataList,u=a.treeList,p=a.liveData,v=a.drawerLiveVisible,y=a.selectedKeys;return M.a.createElement(n.a,{spinning:o},M.a.createElement("div",{className:A.a.main},M.a.createElement("div",{className:A.a.siteMenu,onClick:function(){return e.closeDrawer(!0)}},M.a.createElement(f.a,{title:"站点"},M.a.createElement(s.a,{type:"control",theme:"filled",style:{fontSize:26}}))),M.a.createElement("div",{className:A.a.carMain},M.a.createElement("div",{className:A.a.carImg},M.a.createElement("div",{className:A.a.item},this.renderImgItem(0)),M.a.createElement("div",{className:A.a.item},this.renderImgItem(1)),M.a.createElement("div",{className:A.a.item},this.renderImgItem(2)))),M.a.createElement("div",{className:A.a.videoMonitor},M.a.createElement("div",{className:A.a.table},M.a.createElement(c.a,{size:"small",dataSource:d,columns:this.columns,scroll:{y:300}})),M.a.createElement("div",{className:A.a.Monitor},M.a.createElement("div",{className:A.a.item},M.a.createElement("div",{className:A.a.mask},M.a.createElement(s.a,{type:"plus-circle",onClick:function(){return e.setIndexPlayerLive(0)},className:A.a.icon})),M.a.createElement(F.a,{ref:function(t){return e.videoLeft=t},src:""})),M.a.createElement("div",{className:A.a.item},M.a.createElement("div",{className:A.a.mask},M.a.createElement(s.a,{type:"plus-circle",onClick:function(){return e.setIndexPlayerLive(1)},className:A.a.icon})),M.a.createElement(F.a,{ref:function(t){return e.videoRight=t},src:""})))),M.a.createElement(r.a,{title:"站点列表",width:320,placement:"right",onClose:function(){return e.closeDrawer()},visible:i},u.length?M.a.createElement(S.a,{showLine:!0,showIcon:!0,selectedKeys:y,onSelect:this.treeSelect},this.renderTree(u)):M.a.createElement(l.a,null)),M.a.createElement(r.a,{title:"站点监控",width:320,placement:"right",onClose:function(){return e.closeLiveDrawer()},visible:v},p.length?M.a.createElement(S.a,{showLine:!0,showIcon:!0,selectedKeys:y,onSelect:this.treeSelect},this.renderTree(p)):M.a.createElement(l.a,{description:"当前站点没有监控或者您没有选中站点"})),M.a.createElement(r.a,{title:t.carNo||"",width:900,placement:"right",onClose:function(){return e.closeDetailDrawerVisible()},visible:m},m&&"{}"!==JSON.stringify(t)?M.a.createElement(P.a,{detail:t}):null)))}}]),t}(x.PureComponent))||i;t.default=H}}]);