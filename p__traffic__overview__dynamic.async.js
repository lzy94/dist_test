(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{"v/Qa":function(e,t,a){"use strict";a.r(t);var n,i=a("pVnL"),r=a.n(i),l=(a("IzEo"),a("bx4M")),s=(a("14J3"),a("BMrR")),o=(a("iQDF"),a("+eQT")),d=(a("5NDa"),a("5rEg")),c=(a("jCWc"),a("kPKH")),m=(a("nRaC"),a("5RzL")),u=(a("2qtc"),a("kLXV")),p=(a("miYZ"),a("tsqr")),h=a("lSNA"),f=a.n(h),E=a("MVZn"),g=a.n(E),y=(a("+L6B"),a("2/Rp")),v=(a("+BJd"),a("mr32")),w=(a("5Dmo"),a("3S7+")),b=a("lwsE"),x=a.n(b),S=a("W8MJ"),N=a.n(S),L=a("a1gu"),D=a.n(L),k=a("Nsbk"),I=a.n(k),M=a("7W2i"),V=a.n(M),R=(a("7Kak"),a("9yH6")),C=(a("OaEy"),a("2fM7")),T=(a("y8nQ"),a("Vl3Y")),F=a("q1tI"),B=a.n(F),H=a("MuoO"),O=a("mf+E"),Y=a("wd/R"),A=a.n(Y),G=(a("riYV"),a("CkN6")),j=a("IeN6"),z=a("9zHi"),P=a.n(z),J=a("ns75"),Q=a.n(J),q=a("+n12"),K=["/overview/dynamic","/overview/dynamic/info","/overview/dynamic/export"],U=T.a.Item,W=C.a.Option,_=R.a.Group,Z={pageNo:1,pageSize:10},X=Object(H.connect)(function(e){var t=e.system,a=e.TrafficApiV2BusData,n=e.user,i=e.loading;return{currentUser:n.currentUser,system:t,TrafficApiV2BusData:a,loading:i.models.TrafficApiV2BusData}})(n=T.a.create()(n=function(e){function t(){var e,a;x()(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=D()(this,(e=I()(t)).call.apply(e,[this].concat(i)))).state={detailModalVisible:!1,formValues:{},siteList:[],newSiteList:[],detailId:0,directionkey:0},a.columns=[{title:"检查站",dataIndex:"siteName",width:190,render:function(e){return e.length>12?B.a.createElement(w.a,{title:e},e.substring(0,12),"..."):e}},{title:"车牌号",dataIndex:"carNo"},{title:"车辆方向",dataIndex:"direction"},{title:"检测时间",dataIndex:"previewTime",width:160,render:function(e){return A()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"速度(km/h)",dataIndex:"speed",width:90},{title:"轴数",dataIndex:"axleNumber"},{title:"总重(t)",dataIndex:"totalLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"限重(t)",dataIndex:"weightLimited",render:function(e){return B.a.createElement(v.a,{color:"#87d068"},(e/1e3).toFixed(2)," ")}},{title:"超重(t)",dataIndex:"overLoad",render:function(e){return e>0?B.a.createElement(v.a,{color:"#f5222d"},(e/1e3).toFixed(2)):(e/1e3).toFixed(2)}},{title:"超重比(%)",dataIndex:"overLoadRate",width:100,render:function(e){return(100*e).toFixed(2)}},Object(q.b)(K[1])?{title:"操作",width:"80px",render:function(e,t){return B.a.createElement(F.Fragment,null,B.a.createElement(w.a,{placement:"left",title:"详情"},B.a.createElement(y.a,{onClick:function(){return a.showDetailModal(t.id)},type:"primary",shape:"circle",icon:"eye",size:"small"})))}}:""].filter(function(e){return e}),a.getList=function(e){(0,a.props.dispatch)({type:"TrafficApiV2BusData/busDynamicDataForPage",payload:g()({},e)})},a.getSiteIN=function(){return{siteCodes:a.state.newSiteList.map(function(e){return e.code})}},a.showDetailModal=function(e){a.setState({detailId:e},function(){return a.handleDetailModalVisible(!0)})},a.handleDetailModalVisible=function(e){a.setState({detailModalVisible:!!e}),e||(a.setState({detailId:0}),a.resetDetail())},a.resetDetail=function(){(0,a.props.dispatch)({type:"TrafficApiV2BusData/resetDetail"})},a.handleStandardTableChange=function(e){var t=a.state.formValues,n=g()({pageNo:e.current,pageSize:e.pageSize},t);a.getList(n)},a.handleFormReset=function(){a.props.form.resetFields();var e=Object(q.w)("organId");a.getSite(e,function(){var e=a.getSiteIN();a.setState({formValues:e,directionkey:0}),a.getList(g()({},Z,e))})},a.handleSearch=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var n="YYYY-MM-DDTHH:mm:ss",i=t.previewTime,r=t.otherSearch,l=t.siteCodes,s=i?{startPreviewTime:A()(i[0]).format(n),endPreviewTime:A()(i[1]).format(n)}:{},o={};if(r){var d=r.split("_");o=f()({},d[0],d[1])}if(a.getSiteIN().siteCodes.length){var c=l?[l]:a.getSiteIN().siteCodes,m=g()({},t,s,o,{siteCodes:c});delete m.previewTime,delete m.otherSearch,delete m.name,a.setState({formValues:m}),a.getList(g()({},Z,m))}else p.a.error("当前机构暂无站点")}})},a.siteChange=function(e,t){var n=t.key,i=a.props.form;a.setState({directionkey:parseInt(n,10)},function(){return i.setFieldsValue({direction:void 0})})},a.renderOption=function(){return a.state.newSiteList.map(function(e){return B.a.createElement(W,{key:e.index,value:e.code},e.name)})},a.getSite=function(e,t){(0,a.props.dispatch)({type:"Site/siteByUserSite",payload:{organId:e,siteIds:a.state.siteList.map(function(e){return e.code})},callback:function(e){var n=e.map(function(e,t){return"1"===e.siteType?{index:t+1,code:e.siteCode,name:e.siteName,direction:[e.forwardDirection,e.reverseDirection].filter(function(e){return e})}:""}).filter(function(e){return e});a.setState({newSiteList:n},function(){t&&t(n)})}})},a.treeSelectChange=function(e){a.props.form.setFieldsValue({siteCodes:void 0}),a.getSite(e),a.setState({directionkey:0})},a.renderSearchBotton=function(){return B.a.createElement("div",{style:{overflow:"hidden"}},B.a.createElement("div",{style:{float:"right",marginBottom:24}},B.a.createElement(y.a,{type:"primary",htmlType:"submit"},"查询"),B.a.createElement(y.a,{style:{marginLeft:8},onClick:a.handleFormReset},"重置")))},a}return V()(t,e),N()(t,[{key:"componentDidMount",value:function(){var e=this;Object(q.b)(K[0])&&(0,this.props.dispatch)({type:"system/userSite",payload:{siteType:1},callback:function(t){if(t.length){var a=t.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]].filter(function(e){return e})}}),n=t.map(function(e){return Object.keys(e)[0]});e.setState({siteList:a,newSiteList:a,formValues:{siteCodes:n}}),e.getList(g()({},Z,{siteCodes:n}))}else u.a.error({title:"提示",content:"您没有绑定站点！！！"})}})}},{key:"renderAdvancedForm",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.system.treeList,n=this.state,i=n.directionkey,r=n.newSiteList,l=Object(q.w)("organId").toString();return B.a.createElement(T.a,{onSubmit:this.handleSearch,layout:"inline"},B.a.createElement(s.a,{gutter:16},B.a.createElement(c.a,{md:5,sm:24},B.a.createElement("div",{className:Q.a.inputMain},B.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"所属机构"),B.a.createElement(U,{style:{flex:1}},t("name")(B.a.createElement(m.a,{className:Q.a.inputGroupLeftRadius,treeData:a,treeDefaultExpandedKeys:[l],style:{width:"100%"},placeholder:"请选择",onChange:this.treeSelectChange}))))),B.a.createElement(c.a,{md:5,sm:24},B.a.createElement("div",{className:Q.a.inputMain},B.a.createElement("span",{style:{width:"70px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测点"),B.a.createElement(U,{style:{flex:1}},t("siteCodes")(B.a.createElement(C.a,{onChange:this.siteChange,className:Q.a.inputGroupLeftRadius,placeholder:"请选择"},this.renderOption()))))),B.a.createElement(c.a,{md:4,sm:24},B.a.createElement(U,null,t("carNo")(B.a.createElement(d.a,{addonBefore:"车牌号",placeholder:"请输入"})))),B.a.createElement(c.a,{md:4,sm:24},B.a.createElement("div",{className:Q.a.inputMain},B.a.createElement("span",{style:{width:"60px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"轴数"),B.a.createElement(U,{style:{flex:1}},t("axleNumber")(B.a.createElement(C.a,{className:Q.a.inputGroupLeftRadius,placeholder:"请选择"},B.a.createElement(W,{value:""},"全部轴数"),B.a.createElement(W,{value:2},"2"),B.a.createElement(W,{value:3},"3"),B.a.createElement(W,{value:4},"4"),B.a.createElement(W,{value:5},"5"),B.a.createElement(W,{value:6},"6"),B.a.createElement(W,{value:"other"},"其他")))))),B.a.createElement(c.a,{md:6,sm:24},B.a.createElement("div",{className:Q.a.inputMain},B.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测时间"),B.a.createElement(U,{style:{flex:1}},t("previewTime")(B.a.createElement(o.a.RangePicker,{className:Q.a.inputGroupLeftRadius,style:{width:"100%"},showTime:{defaultValue:[A()("00:00:00","HH:mm:ss"),A()(new Date,"HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss"})))))),B.a.createElement(s.a,{gutter:16},B.a.createElement(c.a,{md:5,sm:24},B.a.createElement(d.a.Group,{compact:!0},B.a.createElement(U,{style:{display:"inline-block",width:"50%"}},t("startTotalLoad")(B.a.createElement(d.a,{className:"".concat(Q.a.inputGroupRightRadius," ").concat(Q.a.inputGroupRightborder),addonBefore:"总重(t)",placeholder:"请输入",style:{width:"100%",borderRight:0}}))),B.a.createElement(U,{style:{display:"inline-block",width:"50%"}},t("endTotalLoad")(B.a.createElement(d.a,{className:Q.a.inputGroupRadiusAddon,addonBefore:"至",placeholder:"请输入",style:{width:"100%"}}))))),B.a.createElement(c.a,{md:5,sm:24},B.a.createElement(d.a.Group,{compact:!0},B.a.createElement(U,{style:{display:"inline-block",width:"60%"}},t("startOverLoadRate")(B.a.createElement(d.a,{className:"".concat(Q.a.inputGroupRightRadius," ").concat(Q.a.inputGroupRightborder),addonBefore:"超限幅度(%)",placeholder:"请输入",style:{width:"100%",borderRight:0}}))),B.a.createElement(U,{style:{display:"inline-block",width:"40%"}},t("endOverLoadRate")(B.a.createElement(d.a,{className:Q.a.inputGroupRadiusAddon,addonBefore:"至",placeholder:"请输入",style:{width:"100%"}}))))),i?B.a.createElement(c.a,{md:4,sm:24},B.a.createElement("div",{className:Q.a.inputMain},B.a.createElement("span",{style:{width:"60px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"方向"),B.a.createElement(U,{style:{flex:1}},t("direction",{})(B.a.createElement(C.a,{style:{width:"100%"},placeholder:"请选择"},r[i-1].direction.map(function(e){return B.a.createElement(W,{value:e,key:"".concat(e)},e)})))))):null,B.a.createElement(c.a,{md:6,sm:24},B.a.createElement(U,null,t("otherSearch",{})(B.a.createElement(_,null,B.a.createElement(R.a,{value:"overLoadFlag_1"},"只看超限"),B.a.createElement(R.a,{value:"readFlag_2"},"只看未读预警信息"))))),B.a.createElement(c.a,{md:4,sm:24,style:{float:"right"}},this.renderSearchBotton())))}},{key:"render",value:function(){var e=this.props,t=e.TrafficApiV2BusData.dyData,a=e.loading,n=this.state,i=n.detailModalVisible,s=n.detailId,o={handleModalVisible:this.handleDetailModalVisible,id:s};return B.a.createElement(F.Fragment,null,Object(q.b)(K[0])?null:B.a.createElement(O.a,{to:"/exception/403"}),B.a.createElement(l.a,{bordered:!1},B.a.createElement("div",{className:P.a.tableList},B.a.createElement("div",{className:P.a.tableListForm},this.renderAdvancedForm()),B.a.createElement(G.a,{tableAlert:!1,selectedRows:0,rowSelection:null,loading:a,data:t,size:"middle",columns:this.columns,onChange:this.handleStandardTableChange}))),i&&s?B.a.createElement(j.a,r()({},o,{modalVisible:i})):null)}}]),t}(F.PureComponent))||n)||n;t.default=X}}]);