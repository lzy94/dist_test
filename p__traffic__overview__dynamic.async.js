(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{"v/Qa":function(e,t,a){"use strict";a.r(t);var n,i=a("pVnL"),r=a.n(i),l=(a("IzEo"),a("bx4M")),o=(a("14J3"),a("BMrR")),s=(a("iQDF"),a("+eQT")),d=(a("5NDa"),a("5rEg")),c=(a("jCWc"),a("kPKH")),m=(a("nRaC"),a("5RzL")),u=(a("2qtc"),a("kLXV")),p=a("lSNA"),h=a.n(p),f=(a("miYZ"),a("tsqr")),E=a("MVZn"),g=a.n(E),y=(a("+L6B"),a("2/Rp")),v=(a("+BJd"),a("mr32")),w=(a("5Dmo"),a("3S7+")),b=a("lwsE"),S=a.n(b),x=a("W8MJ"),L=a.n(x),N=a("a1gu"),D=a.n(N),k=a("Nsbk"),V=a.n(k),C=a("7W2i"),R=a.n(C),I=(a("7Kak"),a("9yH6")),M=(a("OaEy"),a("2fM7")),F=(a("y8nQ"),a("Vl3Y")),T=a("q1tI"),O=a.n(T),B=a("MuoO"),H=a("mf+E"),Y=a("wd/R"),A=a.n(Y),j=(a("riYV"),a("CkN6")),G=a("IeN6"),z=a("9zHi"),P=a.n(z),J=a("ns75"),Q=a.n(J),q=a("+n12"),K=["/overview/dynamic","/overview/dynamic/info","/overview/dynamic/export"],U=F.a.Item,W=M.a.Option,_=I.a.Group,Z={pageNo:1,pageSize:10},X=Object(B.connect)(function(e){var t=e.system,a=e.TrafficApiV2BusData,n=e.user,i=e.loading;return{currentUser:n.currentUser,system:t,TrafficApiV2BusData:a,loading:i.models.TrafficApiV2BusData}})(n=F.a.create()(n=function(e){function t(){var e,a;S()(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=D()(this,(e=V()(t)).call.apply(e,[this].concat(i)))).state={detailModalVisible:!1,formValues:{},siteList:[],newSiteList:[],detailId:0,directionkey:0},a.columns=[{title:"检查站",dataIndex:"siteName",width:190,render:function(e){return e.length>12?O.a.createElement(w.a,{title:e},e.substring(0,12),"..."):e}},{title:"车牌号",dataIndex:"carNo"},{title:"车辆方向",dataIndex:"direction"},{title:"检测时间",dataIndex:"previewTime",width:160,render:function(e){return A()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"速度(km/h)",dataIndex:"speed",width:90},{title:"轴数",dataIndex:"axleNumber"},{title:"总重(t)",dataIndex:"totalLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"限重(t)",dataIndex:"weightLimited",render:function(e){return O.a.createElement(v.a,{color:"#87d068"},(e/1e3).toFixed(2)," ")}},{title:"超重(t)",dataIndex:"overLoad",render:function(e){return e>0?O.a.createElement(v.a,{color:"#f5222d"},(e/1e3).toFixed(2)):(e/1e3).toFixed(2)}},{title:"超重比(%)",dataIndex:"overLoadRate",width:100,render:function(e){return(100*e).toFixed(2)}},Object(q.c)(K[1])?{title:"操作",width:"80px",render:function(e,t){return O.a.createElement(T.Fragment,null,O.a.createElement(w.a,{placement:"left",title:"详情"},O.a.createElement(y.a,{onClick:function(){return a.showDetailModal(t.id)},type:"primary",shape:"circle",icon:"eye",size:"small"})))}}:""].filter(function(e){return e}),a.getList=function(e){(0,a.props.dispatch)({type:"TrafficApiV2BusData/busDynamicDataForPage",payload:g()({},e)})},a.getSiteIN=function(){return{siteCodes:a.state.newSiteList.map(function(e){return e.code})}},a.showDetailModal=function(e){a.setState({detailId:e},function(){return a.handleDetailModalVisible(!0)})},a.handleDetailModalVisible=function(e){a.setState({detailModalVisible:!!e}),e||(a.setState({detailId:0}),a.resetDetail())},a.resetDetail=function(){(0,a.props.dispatch)({type:"TrafficApiV2BusData/resetDetail"})},a.handleStandardTableChange=function(e){var t=a.state.formValues,n=g()({pageNo:e.current,pageSize:e.pageSize},t);a.getList(n)},a.handleFormReset=function(){a.props.form.resetFields();var e=Object(q.z)("organId");a.getSite(e,function(){var e=a.getSiteIN();a.setState({formValues:e,directionkey:0}),a.getList(g()({},Z,e))})},a.handleSearch=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var n="YYYY-MM-DDTHH:mm:ss",i=t.previewTime,r=t.otherSearch,l=t.siteCodes,o=t.startOverLoadRate,s=t.endOverLoadRate,d=t.startTotalLoad,c=t.endTotalLoad;if(!o&&!s||Object(q.F)(o)&&Object(q.F)(s))if(!d&&!c||Object(q.F)(d)&&Object(q.F)(c)){var m=i?{startPreviewTime:A()(i[0]).format(n),endPreviewTime:A()(i[1]).format(n)}:{},u={};if(r){var p=r.split("_");u=h()({},p[0],p[1])}if(a.getSiteIN().siteCodes.length){var E=l?[l]:a.getSiteIN().siteCodes,y=g()({},t,m,u,{siteCodes:E});delete y.previewTime,delete y.otherSearch,delete y.name,a.setState({formValues:y}),a.getList(g()({},Z,y))}else f.a.error("当前机构暂无站点")}else f.a.error("总重请输入数字");else f.a.error("超限幅度请输入数字")}})},a.siteChange=function(e,t){var n=t.key,i=a.props.form;a.setState({directionkey:parseInt(n,10)},function(){return i.setFieldsValue({direction:void 0})})},a.renderOption=function(){return a.state.newSiteList.map(function(e){return O.a.createElement(W,{key:e.index,value:e.code},e.name)})},a.importClick=function(){a.setState({importLoading:!0}),(0,a.props.dispatch)({type:"TrafficApiV2BusData/import",payload:a.state.formValues,callback:function(e){404===e&&f.a.error("暂无数据"),a.setState({importLoading:!1})}})},a.getSite=function(e,t){(0,a.props.dispatch)({type:"Site/siteByUserSite",payload:{organId:e,siteIds:a.state.siteList.map(function(e){return e.code})},callback:function(e){var n=e.map(function(e,t){return"1"===e.siteType?{index:t+1,code:e.siteCode,name:e.siteName,direction:[e.forwardDirection,e.reverseDirection].filter(function(e){return e})}:""}).filter(function(e){return e});a.setState({newSiteList:n},function(){t&&t(n)})}})},a.treeSelectChange=function(e){a.props.form.setFieldsValue({siteCodes:void 0}),a.getSite(e),a.setState({directionkey:0})},a.renderSearchBotton=function(){var e=a.state.importLoading;return O.a.createElement("div",{style:{overflow:"hidden"}},O.a.createElement("div",{style:{float:"right",marginBottom:24}},O.a.createElement(y.a,{type:"primary",htmlType:"submit"},"查询"),O.a.createElement(y.a,{className:Q.a.import,icon:"import",onClick:a.importClick,loading:e,disabled:e,style:{marginLeft:8}},"导出"),O.a.createElement(y.a,{style:{marginLeft:8},onClick:a.handleFormReset},"重置")))},a}return R()(t,e),L()(t,[{key:"componentDidMount",value:function(){var e=this;Object(q.c)(K[0])&&(0,this.props.dispatch)({type:"system/userSite",payload:{siteType:1},callback:function(t){if(t.length){var a=t.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]].filter(function(e){return e})}}),n=t.map(function(e){return Object.keys(e)[0]});e.setState({siteList:a,newSiteList:a,formValues:{siteCodes:n}}),e.getList(g()({},Z,{siteCodes:n}))}else u.a.error({title:"提示",content:"您没有绑定站点！！！"})}})}},{key:"renderAdvancedForm",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.system.treeList,n=this.state,i=n.directionkey,r=n.newSiteList,l=Object(q.z)("organId").toString();return O.a.createElement(F.a,{onSubmit:this.handleSearch,layout:"inline"},O.a.createElement(o.a,{gutter:16},O.a.createElement(c.a,{md:5,sm:24},O.a.createElement("div",{className:Q.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"所属机构"),O.a.createElement(U,{style:{flex:1}},t("name")(O.a.createElement(m.a,{className:Q.a.inputGroupLeftRadius,treeData:a,treeDefaultExpandedKeys:[l],style:{width:"100%"},placeholder:"请选择",onChange:this.treeSelectChange}))))),O.a.createElement(c.a,{md:5,sm:24},O.a.createElement("div",{className:Q.a.inputMain},O.a.createElement("span",{style:{width:"70px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测点"),O.a.createElement(U,{style:{flex:1}},t("siteCodes")(O.a.createElement(M.a,{onChange:this.siteChange,className:Q.a.inputGroupLeftRadius,placeholder:"请选择"},this.renderOption()))))),O.a.createElement(c.a,{md:4,sm:24},O.a.createElement(U,null,t("carNo")(O.a.createElement(d.a,{addonBefore:"车牌号",placeholder:"请输入"})))),O.a.createElement(c.a,{md:4,sm:24},O.a.createElement("div",{className:Q.a.inputMain},O.a.createElement("span",{style:{width:"60px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"轴数"),O.a.createElement(U,{style:{flex:1}},t("axleNumber")(O.a.createElement(M.a,{className:Q.a.inputGroupLeftRadius,placeholder:"请选择"},O.a.createElement(W,{value:""},"全部轴数"),O.a.createElement(W,{value:2},"2"),O.a.createElement(W,{value:3},"3"),O.a.createElement(W,{value:4},"4"),O.a.createElement(W,{value:5},"5"),O.a.createElement(W,{value:6},"6"),O.a.createElement(W,{value:"other"},"其他")))))),O.a.createElement(c.a,{md:6,sm:24},O.a.createElement("div",{className:Q.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测时间"),O.a.createElement(U,{style:{flex:1}},t("previewTime")(O.a.createElement(s.a.RangePicker,{className:Q.a.inputGroupLeftRadius,style:{width:"100%"},showTime:{defaultValue:[A()("00:00:00","HH:mm:ss"),A()(new Date,"HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss"})))))),O.a.createElement(o.a,{gutter:16},O.a.createElement(c.a,{md:5,sm:24},O.a.createElement(d.a.Group,{compact:!0},O.a.createElement(U,{style:{display:"inline-block",width:"50%"}},t("startTotalLoad")(O.a.createElement(d.a,{className:"".concat(Q.a.inputGroupRightRadius," ").concat(Q.a.inputGroupRightborder),addonBefore:"总重(t)",placeholder:"请输入",style:{width:"100%",borderRight:0}}))),O.a.createElement(U,{style:{display:"inline-block",width:"50%"}},t("endTotalLoad")(O.a.createElement(d.a,{className:Q.a.inputGroupRadiusAddon,addonBefore:"至",placeholder:"请输入",style:{width:"100%"}}))))),O.a.createElement(c.a,{md:5,sm:24},O.a.createElement(d.a.Group,{compact:!0},O.a.createElement(U,{style:{display:"inline-block",width:"60%"}},t("startOverLoadRate")(O.a.createElement(d.a,{className:"".concat(Q.a.inputGroupRightRadius," ").concat(Q.a.inputGroupRightborder),addonBefore:"超限幅度(%)",placeholder:"请输入",style:{width:"100%",borderRight:0}}))),O.a.createElement(U,{style:{display:"inline-block",width:"40%"}},t("endOverLoadRate")(O.a.createElement(d.a,{className:Q.a.inputGroupRadiusAddon,addonBefore:"至",placeholder:"请输入",style:{width:"100%"}}))))),i?O.a.createElement(c.a,{md:4,sm:24},O.a.createElement("div",{className:Q.a.inputMain},O.a.createElement("span",{style:{width:"60px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"方向"),O.a.createElement(U,{style:{flex:1}},t("direction",{})(O.a.createElement(M.a,{style:{width:"100%"},placeholder:"请选择"},r[i-1].direction.map(function(e){return O.a.createElement(W,{value:e,key:"".concat(e)},e)})))))):null,O.a.createElement(c.a,{md:6,sm:24},O.a.createElement(U,null,t("otherSearch",{})(O.a.createElement(_,null,O.a.createElement(I.a,{value:"overLoadFlag_1"},"只看超限"),O.a.createElement(I.a,{value:"readFlag_2"},"只看未读预警信息"))))),i?null:O.a.createElement(c.a,{md:6,sm:24,style:{float:"right"}},this.renderSearchBotton())),i?this.renderSearchBotton():null)}},{key:"render",value:function(){var e=this.props,t=e.TrafficApiV2BusData.dyData,a=e.loading,n=this.state,i=n.detailModalVisible,o=n.detailId,s={handleModalVisible:this.handleDetailModalVisible,id:o};return O.a.createElement(T.Fragment,null,Object(q.c)(K[0])?null:O.a.createElement(H.a,{to:"/exception/403"}),O.a.createElement(l.a,{bordered:!1},O.a.createElement("div",{className:P.a.tableList},O.a.createElement("div",{className:P.a.tableListForm},this.renderAdvancedForm()),O.a.createElement(j.a,{tableAlert:!1,selectedRows:0,rowSelection:null,loading:a,data:t,size:"middle",columns:this.columns,onChange:this.handleStandardTableChange}))),i&&o?O.a.createElement(G.a,r()({},s,{modalVisible:i})):null)}}]),t}(T.PureComponent))||n)||n;t.default=X}}]);