(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{rH1S:function(e,t,a){"use strict";a.r(t);a("sRBo");var n,r=a("kaz8"),i=(a("DjyN"),a("NUBc")),o=(a("nRaC"),a("5RzL")),s=(a("Pwec"),a("CtXQ")),l=(a("T2oS"),a("W9HT")),c=a("MVZn"),m=a.n(c),d=(a("R9oj"),a("ECub")),u=(a("miYZ"),a("tsqr")),p=a("lwsE"),g=a.n(p),h=a("W8MJ"),f=a.n(h),E=a("a1gu"),v=a.n(E),k=a("Nsbk"),y=a.n(k),C=a("7W2i"),L=a.n(C),M=a("q1tI"),w=a.n(M),I=a("5PMe"),S=a("MuoO"),P=a("zT9C"),N=a.n(P),b=a("cVA7"),D=a.n(b),x=a("7DBZ"),A=a("+n12"),O=a("zOGa"),R=a("lS5u"),B=a.n(R),W=a("XyfJ"),H=a.n(W),T=a("sdRf"),G=a.n(T),V=Object(S.connect)(function(e){return{Live:e.Live,system:e.system,MaritimePoint:e.MaritimePoint,loading:e.loading.models.MaritimePoint}})(n=function(e){function t(e){var a;return g()(this,t),(a=v()(this,y()(t).call(this,e))).getInitialState=function(){return{msg:{},markersInfoVisible:!1,markersInfoLngLat:null,normalChecked:!0,warningChecked:!0,chartData:[],normalMarkers:[],warnMarkers:[],center:null,oldAddress:"",pointCode:"",isLeftClose:!0,pageBean:{page:1,pageSize:15,showTotal:!0},chartOption:a.getChartOption()}},a.getChartOption=function(){return{color:["#516b91","#59c4e6","#edafda","#93b7e3","#a5e7f0","#cbb0e3"],grid:{left:"0",right:"3%",bottom:"0",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},legend:{data:["水位"]},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:[{type:"value",name:"水位",axisLabel:{formatter:"{value} m"}}],series:[]}},a.getList=function(e){(0,a.props.dispatch)({type:"MaritimePoint/fetch",payload:e,callback:function(){a.getMarkers()}})},a.getGBSPath=function(e){(0,a.props.dispatch)({type:"Live/GBSPath",payload:{serial:e},callback:function(e){a.videoRef.player.src(e),a.videoRef.player.play()}})},a.getDetail=function(e){(0,a.props.dispatch)({type:"MaritimePoint/detail",payload:{ponitCode:e},callback:function(e){var t=e.roadMonitor;t&&Object.keys(t).length?a.getGBSPath(e.roadMonitor.serial):u.a.error("暂无监控")}})},a.setChartOption=function(e,t){var n=a.state.chartOption,r=N()(n),i=e.map(function(e){return e.HOUR});r.xAxis.data=i;var o=[{name:"水位",smooth:!0,data:e.map(function(e){return e.WATERLEVEL}),type:"line",areaStyle:{},markLine:{silent:!0,data:[{yAxis:t.normalHigh,label:{show:!0,position:"middle",formatter:"保障水位线 "+t.normalHigh},lineStyle:{color:"#5176FD"}},{yAxis:t.warningHigh,label:{show:!0,position:"middle",formatter:"水位预警线 "+t.warningHigh},lineStyle:{color:"#F9787C"}}]}}];r.series=o,a.setState({chartOption:r})},a.getPointInfoForDay=function(e,t){(0,a.props.dispatch)({type:"MaritimePoint/pointInfoForDay",payload:{ponitCode:e},callback:function(e){a.setState({chartData:e},function(){return a.setChartOption(e.reverse(),t)})}})},a.paginationChange=function(e){var t=a.state.formValue;a.getList({pageBean:{page:e,pageSize:15,showTotal:!0},querys:t})},a.treeChange=function(e){var t=a.state.pageBean,n=[{property:"organCode",value:e,group:"main",operation:"RIGHT_LIKE",relation:"AND"}].filter(function(e){return e.value});a.setState({formValue:n}),a.getList({pageBean:t,querys:n})},a.renderPointList=function(){var e=a.props.MaritimePoint.data,t=a.state.pointCode;return e.list.length?e.list.map(function(e,n){var r=!1,i=e.waterOnitoringPointData;return i?i.waterLevel-e.warningHigh>0&&(r=!0):r=!0,w.a.createElement("li",{className:"".concat(t===e.ponitCode?B.a.active:null," ").concat(r?B.a.error:null),key:n,onClick:function(){return a.pointClick(e)}},w.a.createElement("h3",null,e.ponitName),w.a.createElement("p",null,e.addr))}):w.a.createElement(d.a,{image:d.a.PRESENTED_IMAGE_SIMPLE})},a.pointClick=function(e){a.setMarkersMsg(e)},a.setMarkersMsg=function(e){var t=null;if(e.longitudeandlatitude){var n=e.longitudeandlatitude.split(",");t={longitude:n[0],latitude:n[1]}}a.getDetail(e.ponitCode),a.getPointInfoForDay(e.ponitCode,e),a.markersState(e,e.ponitCode,t,!0)},a.markersState=function(e,t,n,r){a.setState({msg:e,pointCode:t,markersInfoLngLat:n,markersInfoVisible:!!r})},a.renderChart=function(){var e=a.state,t=e.chartData,n=e.chartOption;return t.length?w.a.createElement(D.a,{option:n,style:{height:"100%"}}):w.a.createElement(d.a,{style:{lineHeight:"250px",marginTop:0},image:d.a.PRESENTED_IMAGE_SIMPLE})},a.getMarkers=function(){var e=a.props.MaritimePoint.data;if(e.list.length){for(var t=e.list.map(function(e){if(e.longitudeandlatitude){var t=e.longitudeandlatitude.split(",");return m()({position:{longitude:t[0],latitude:t[1]}},e)}return m()({position:null},e)}),n=[],r=[],i=0;i<t.length;i+=1){var o=t[i].waterOnitoringPointData;o?o.waterLevel-t[i].warningHigh>0?r.push(t[i]):n.push(t[i]):r.push(t[i])}a.setState({normalMarkers:n,warnMarkers:r}),setTimeout(function(){return a.setMarkersMsg(e.list[0])},500)}},a.normalChange=function(e){a.setState({normalChecked:e.target.checked})},a.warnChange=function(e){a.setState({warningChecked:e.target.checked})},a.renderNormalImg=function(e){return w.a.createElement("img",{style:{width:35},src:H.a,alt:""})},a.renderWarnImg=function(e){return w.a.createElement("img",{style:{width:35},src:G.a,alt:""})},a.markersEvent=function(){return{click:function(e,t){var n=t.getExtData();a.getPointInfoForDay(n.ponitCode,n),a.markersState(n,n.ponitCode,n.position,!0)},mouseout:function(){a.setState({msg:{},markersInfoLngLat:null,markersInfoVisible:!1})}}},a.renderMarkerInfoWindow=function(){var e=a.state,t=e.markersInfoLngLat,n=e.markersInfoVisible,r=e.msg,i=a.props.loading,o=r.waterOnitoringPointData||{};return w.a.createElement(x.InfoWindow,{key:"markerInfoWindow",position:t,visible:n,isCustom:!0,offset:[8,-30]},w.a.createElement(l.a,{spinning:i},w.a.createElement("div",{className:B.a.infoWin},w.a.createElement("h3",null,w.a.createElement("span",null," "),r.ponitName),w.a.createElement("p",null,"地址：",r.addr),w.a.createElement("p",null,"当前水位：",w.a.createElement("span",{className:B.a.normal},o.waterLevel||0," m")),w.a.createElement("p",null,"超出水位：",w.a.createElement("span",{className:B.a.warn},Object(A.a)(o.waterLevel||0,r.warningHigh||0)," m")))))},a.getLngLatByAddress=function(e,t){a.mapInstance.plugin("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(e,function(e,a){if("complete"===e&&a.geocodes.length){var n=a.geocodes[0].location;t(n)}})})},a.amapEvents=function(){return{created:function(e){a.mapInstance=e}}},a.mapInstance=null,a.state=a.getInitialState(),a.videoRef=w.a.createRef(),a}return L()(t,e),f()(t,[{key:"componentDidMount",value:function(){var e=this.state.pageBean;this.getList({pageBean:e})}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=e.system.address;this.state.oldAddress!==a&&setTimeout(function(){try{t.getLngLatByAddress(a,function(e){t.setState({center:e,oldAddress:a})})}catch(e){}},3e3)}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){},this.mapInstance&&this.mapInstance.destroy()}},{key:"render",value:function(){var e=this,t=this.props,a=t.loading,n=t.MaritimePoint.data,c=t.system.treeList,m=this.state,d=m.center,u=m.normalChecked,p=m.warningChecked,g=m.normalMarkers,h=m.warnMarkers,f=m.isLeftClose,E=w.a.createElement(x.Markers,{key:"normalMarkers",markers:u?g:[],render:this.renderNormalImg,events:this.markersEvent()}),v=w.a.createElement(x.Markers,{key:"warnMarkers",markers:p?h:[],render:this.renderWarnImg,events:this.markersEvent()});return w.a.createElement("div",{style:{height:"calc(100vh - 140px)",margin:"-20px -20px -20px -20px",background:"#fff",position:"relative"}},w.a.createElement("div",{className:B.a.leftMainList+" "+(f?"":B.a.onClose)},w.a.createElement("div",{className:B.a.leftClose,onClick:function(){return e.setState({isLeftClose:!f})}},f?w.a.createElement(s.a,{className:B.a.closeBtn,type:"double-left"}):w.a.createElement(s.a,{className:B.a.closeBtn,type:"double-right"})),w.a.createElement("div",{className:B.a.title},w.a.createElement("h3",null,"点位"),w.a.createElement(o.a,{treeData:c,placeholder:"请选择区域",style:{width:"100%"},onChange:this.treeChange})),w.a.createElement("div",{className:B.a.listPanel},w.a.createElement(l.a,{spinning:a},w.a.createElement("ul",{className:B.a.list},this.renderPointList()))),w.a.createElement("div",{className:B.a.pagination},w.a.createElement(i.a,{size:"small",simple:!0,total:n.pagination.total,pageSize:15,onChange:this.paginationChange}))),w.a.createElement("div",{className:B.a.mapLegend+" "+(f?"":B.a.onClose)},w.a.createElement("h3",null,"图例"),w.a.createElement("div",{className:B.a.legengContent},w.a.createElement("div",{className:B.a.legendCell},w.a.createElement("img",{src:H.a,alt:""}),"正常水位",w.a.createElement(r.a,{onChange:this.normalChange,style:{marginLeft:10},checked:u})),w.a.createElement("div",{className:B.a.legendCell},w.a.createElement("img",{src:G.a,alt:""}),"预警水位",w.a.createElement(r.a,{onChange:this.warnChange,style:{marginLeft:10},checked:p})))),w.a.createElement(I.a,{amapEvents:this.amapEvents(),center:d,children:[E,v,this.renderMarkerInfoWindow()]}),w.a.createElement("div",{className:B.a.mapRight},w.a.createElement("div",{className:B.a.video},w.a.createElement(O.a,{ref:function(t){return e.videoRef=t},src:""})),w.a.createElement("div",{className:B.a.chartsPanel},w.a.createElement(l.a,{spinning:a},w.a.createElement("div",{className:B.a.charts},this.renderChart())))))}}]),t}(M.PureComponent))||n;t.default=V}}]);