(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{OLGU:function(e,a,t){"use strict";t.r(a);t("IzEo");var n,l=t("bx4M"),i=(t("14J3"),t("BMrR")),r=(t("jCWc"),t("kPKH")),o=t("MVZn"),s=t.n(o),c=(t("miYZ"),t("tsqr")),d=(t("5Dmo"),t("3S7+")),u=t("lwsE"),p=t.n(u),m=t("W8MJ"),f=t.n(m),h=t("a1gu"),g=t.n(h),b=t("Nsbk"),E=t.n(b),w=t("PJYZ"),v=t.n(w),y=t("7W2i"),L=t.n(y),k=(t("2qtc"),t("kLXV")),C=(t("DZo9"),t("8z0m")),F=t("pVnL"),B=t.n(F),S=(t("+L6B"),t("2/Rp")),R=(t("Pwec"),t("CtXQ")),V=(t("5NDa"),t("5rEg")),N=(t("y8nQ"),t("Vl3Y")),A=t("q1tI"),M=t.n(A),x=t("MuoO"),I=t("mf+E"),q=t("CkN6"),z=t("+n12"),D=t("ZP6J"),O=t.n(D),T=t("9zHi"),P=t.n(T),j=["/datemain/legal"],J=N.a.Item,U=N.a.create()(function(e){var a=e.modalVisible,t=e.form,n=e.handleAdd,l=e.handleModalVisible,i=e.fileList,r=e.uploadChange,o={name:"files",action:"/result/api/file/v1/fileUpload",accept:".doc,.docx,.pdf",data:{type:4,params:null},headers:{Authorization:"Bearer ".concat(Object(z.z)("token")[0]),"x-requested-with":"XMLHttpRequest"},onChange:r,beforeUpload:z.q};return M.a.createElement(k.a,{destroyOnClose:!0,title:"添加",className:O.a.formModal,visible:a,onOk:function(){t.validateFields(function(e,a){e||(t.resetFields(),n(a,function(){return t.resetFields()}))})},onCancel:function(){return l()}},M.a.createElement("div",{className:O.a.formModalBody},M.a.createElement(J,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"发布机构"},t.getFieldDecorator("sourceName",{rules:[{required:!0,message:"请输入发布机构！"}]})(M.a.createElement(V.a,{placeholder:"请输入"}))),M.a.createElement(J,{labelCol:{span:5},wrapperCol:{span:15},label:"文件上传"},t.getFieldDecorator("file",{rules:[{required:!0,message:"请选择文件!"}]})(M.a.createElement(C.a,B()({},o,{defaultFileList:i}),i.length>0?null:M.a.createElement(S.a,null,M.a.createElement(R.a,{type:"upload"})," 法律法规（请上传 ‘pdf’ 及 ‘doc’ 文件）")))),M.a.createElement(J,{labelCol:{span:5},hasFeedback:!0,wrapperCol:{span:15},label:"版本"},t.getFieldDecorator("version",{rules:[{required:!0,message:"请输入版本！"}]})(M.a.createElement(V.a,{placeholder:"请输入"})))))}),Z=Object(x.connect)(function(e){var a=e.loading,t=e.File,n=e.LawsAndRegulations;return{File:t,fileLoading:a.models.File,LawsAndRegulations:n,loading:a.models.LawsAndRegulations}})(n=N.a.create()(n=function(e){function a(){var e,t;p()(this,a);for(var n=arguments.length,l=new Array(n),i=0;i<n;i++)l[i]=arguments[i];return(t=g()(this,(e=E()(a)).call.apply(e,[this].concat(l)))).state={formValues:[],fileList:[],selectedRows:[],uploadLoading:!1,modalVisible:!1,pageBean:{page:1,pageSize:10,showTotal:!0}},t.columns=[{title:"上传者",dataIndex:"createBy"},{title:"发布机构",dataIndex:"sourceName"},{title:"文件名",dataIndex:"fileName",render:function(e){return e.length>15?M.a.createElement(d.a,{title:e},M.a.createElement("span",{style:{cursor:"pointer"}},e.substr(0,15)+"......")):e}},{title:"版本",dataIndex:"version"},{title:"上传时间",dataIndex:"createTime"},{title:"操作",width:70,render:function(e,a){return M.a.createElement(A.Fragment,null,M.a.createElement(d.a,{placement:"left",title:"预览"},M.a.createElement(S.a,{onClick:function(){return t.previcew(a)},type:"primary",shape:"circle",icon:"eye",size:"small"})))}}],t.previcew=function(e){var a=t.props.dispatch;"pdf"===e.ext?window.open(z.t+e.filePath,"_blank"):a({type:"File/preview",payload:{fileId:e.fileId},callback:function(e){if(e){var t=e.pdfUrl.split("/"),n=t[t.length-1];a({type:"File/preview_",payload:n,callback:function(e){if(200!==e.code)return c.a.error("文件读取失败！");window.open(e.data,"_blank")}})}}})},t.delBatch=function(){var e=t.state.selectedRows;if(e){var a=v()(t);k.a.confirm({title:"批量删除",content:"您确定要批量删除吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){a.delUtil(e.map(function(e){return e.id}).join())},onCancel:function(){}})}},t.delUtil=function(e){var a=t.state.pageBean;(0,t.props.dispatch)({type:"LawsAndRegulations/remove",payload:{ids:e},callback:function(){c.a.success("删除成功"),setTimeout(function(){return t.getList({pageBean:a})},100),t.setState({selectedRows:[]})}})},t.getList=function(e){(0,t.props.dispatch)({type:"LawsAndRegulations/fetch",payload:e})},t.handleModalVisible=function(e){t.setState({modalVisible:!!e}),e||t.setState({fileList:[]})},t.handleAdd=function(e,a){var n=t.props.dispatch,l=t.props,i=l.fileList,r=l.pageBean;if(!i.length)return c.a.error("请选择文件");var o=e.file.file.response;e.fileId=o.fileId,e.fileName=o.fileName,e.filePath=o.filePath,e.ext=o.extensionName,n({type:"LawsAndRegulations/add",payload:e,callback:function(){c.a.success("添加成功"),t.handleModalVisible(),t.getList({pageBean:r}),a&&a()}})},t.uploadChange=function(e){"done"===e.file.status?200===e.file.response.code?(c.a.success("上传成功"),t.setState({fileList:e.fileList})):c.a.error(e.file.response.code.msg):"error"===e.file.status?c.a.error("上传失败"):"removed"===e.file.status&&t.setState({fileList:e.fileList})},t.handleStandardTableChange=function(e){var a=t.state.formValues,n={pageBean:{page:e.current,pageSize:e.pageSize,showTotal:!0},querys:a};t.getList(n)},t.handleFormReset=function(){var e=t.props.form,a=t.state.pageBean;e.resetFields(),t.setState({formValues:[]}),t.getList({pageBean:a})},t.handleSearch=function(e){e.preventDefault(),t.props.form.validateFields(function(e,a){if(!e){var n=t.state.pageBean,l=s()({},a),i=Object.keys(l).map(function(e){return l[e]?{property:e,value:l[e],group:"main",operation:"LIKE",relation:"AND"}:""}).filter(function(e){return e});t.setState({formValues:i}),t.getList({pageBean:n,querys:i})}})},t.handleSelectRows=function(e){t.setState({selectedRows:e})},t}return L()(a,e),f()(a,[{key:"componentDidMount",value:function(){var e=this.state.pageBean;this.getList({pageBean:e})}},{key:"renderSimpleForm",value:function(){var e=this.props.form.getFieldDecorator;return M.a.createElement(N.a,{onSubmit:this.handleSearch,layout:"inline"},M.a.createElement(i.a,{gutter:16},M.a.createElement(r.a,{md:5,sm:24},M.a.createElement(J,null,e("createBy")(M.a.createElement(V.a,{addonBefore:"上传者",placeholder:"请输入"})))),M.a.createElement(r.a,{md:5,sm:24},M.a.createElement(J,null,e("fileName")(M.a.createElement(V.a,{addonBefore:"文件名称",placeholder:"请输入"})))),M.a.createElement(r.a,{md:5,sm:24},M.a.createElement("span",{className:P.a.submitButtons},M.a.createElement(S.a,{type:"primary",htmlType:"submit"},"查询"),M.a.createElement(S.a,{style:{marginLeft:8},onClick:this.handleFormReset},"重置")))))}},{key:"render",value:function(){var e=this,a=this.props,t=a.LawsAndRegulations.data,n=a.loading,i=this.state,r=i.selectedRows,o=i.modalVisible,s={fileList:i.fileList,handleAdd:this.handleAdd,uploadChange:this.uploadChange,handleModalVisible:this.handleModalVisible};return M.a.createElement(A.Fragment,null,Object(z.c)(j[0])?null:M.a.createElement(I.a,{to:"/exception/403"}),M.a.createElement(l.a,{bordered:!1},M.a.createElement("div",{className:P.a.tableList},M.a.createElement("div",{className:P.a.tableListForm},this.renderSimpleForm()),M.a.createElement("div",{className:P.a.tableListOperator},M.a.createElement(S.a,{type:"primary",icon:"plus",onClick:function(){return e.handleModalVisible(!0)}},"新增"),r.length>0&&M.a.createElement(S.a,{type:"danger",onClick:function(){return e.delBatch()}},"批量删除")),M.a.createElement(q.a,{size:"middle",tableAlert:!0,selectedRows:r,loading:n,data:t,columns:this.columns,onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange}))),M.a.createElement(U,B()({},s,{modalVisible:o})))}}]),a}(A.PureComponent))||n)||n;a.default=Z}}]);