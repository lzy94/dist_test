(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{E2HW:function(e,t,a){"use strict";a.r(t);a("IzEo");var n,r=a("bx4M"),i=(a("/zsF"),a("PArb")),c=(a("+L6B"),a("2/Rp")),l=(a("14J3"),a("BMrR")),s=(a("nRaC"),a("5RzL")),o=(a("jCWc"),a("kPKH")),u=(a("iQDF"),a("+eQT")),d=(a("miYZ"),a("tsqr")),m=a("MVZn"),p=a.n(m),h=a("o0o1"),v=a.n(h),f=a("yXPU"),x=a.n(f),g=(a("2qtc"),a("kLXV")),E=a("lwsE"),y=a.n(E),b=a("W8MJ"),T=a.n(b),Y=a("a1gu"),w=a.n(Y),M=a("Nsbk"),D=a.n(M),N=a("7W2i"),S=a.n(N),k=(a("OaEy"),a("2fM7")),j=(a("y8nQ"),a("Vl3Y")),O=a("q1tI"),I=a.n(O),H=a("MuoO"),C=a("wd/R"),L=a.n(C),F=a("ruv0"),A=(a("T2oS"),a("W9HT")),R=a("J4zp"),z=a.n(R),G=a("zT9C"),B=a.n(G),P=a("m0dn"),W=a("+n12"),K={color:["#7CB5EC","#42414A","#94EF84","#F7A25A","#8486EF","#F75D84","#E7D352"],title:{text:"",subtext:"",left:"center"},tooltip:{trigger:"axis"},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{}}},legend:{top:"bottom",data:[]},grid:{left:"3%",right:"4%",bottom:30,containLabel:!0},xAxis:{type:"category",axisLabel:{rotate:45},data:[]},yAxis:{type:"value",name:"数量(辆)"},series:[]},V=["YYYY-MM-DD HH","YYYY-MM-DD","YYYY-MM"],J=function(e){var t=e.params,a=e.siteName,n=Object(O.useState)({}),i=z()(n,2),c=i[0],l=i[1],s=Object(O.useState)({}),o=z()(s,2),u=o[0],d=o[1],m=Object(O.useState)({}),p=z()(m,2),h=p[0],f=p[1],g=Object(O.useState)(!1),E=z()(g,2),y=E[0],b=E[1],T=Object(O.useRef)(null),Y=function(e){var n=B()(K),r=e.map(function(e){return a=e.day,4===(n=t.resultType)?a:L()(new Date(a)).format(V[n-1]);var a,n});n.title.text="超限超载分布情况",n.title.subtext=a||"所有站点",n.xAxis.data=r;var i=["超限超载总数","超载<10(t)","10<=超载<20(t)","20<=超载<30(t)","30<=超载<40(t)","40<=超载<50(t)","超载>=50(t)"];n.legend.data=i;var c=["overTotal","range01","range12","range23","range34","range45","range510"].map(function(a,n){return{name:i[n],type:"pie"===t.chartType?"line":t.chartType,barMaxWidth:20,data:e.map(function(e){return e[a]})}});n.series=c,l(n)},w=function(e){var n=B()(K),r=["01range","12range","23range","34range","45range","510range"],i=["超载<10(t)","10<=超载<20(t)","20<=超载<30(t)","30<=超载<40(t)","40<=超载<50(t)","超载>=50(t)"];if(n.title.text="超限超载分类分析",n.title.subtext=a||"所有站点","pie"===t.chartType){T.current.getEchartsInstance().dispose(),n.legend.data=i,delete n.toolbox,delete n.xAxis,delete n.yAxis,n.tooltip={trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"};var c=[{name:"",type:"pie",data:r.map(function(t,a){return{value:e[t].doc_count,name:i[a]}})}];n.series=c,d(n)}else{n.xAxis.data=i,n.legend.data=["数量"];var l=[{name:"数量",type:t.chartType,barMaxWidth:20,data:r.map(function(t){return e[t].doc_count})}];n.series=l,d(n)}},M=function(e){var t=B()(K);t.legend.data=["超限超载占比","其它违章占比"],t.title.text="车辆轴数统计",t.title.subtext=a||"所有站点",delete t.xAxis,delete t.yAxis,delete t.toolbox,t.tooltip={trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"};var n=[{name:"",type:"pie",data:[{value:e.total_range.doc_count,name:"超限超载占比"},{value:e.overSpeed.doc_count,name:"其它违章占比"}]}];t.series=n,f(t)},D=(N=x()(v.a.mark(function e(t){var a,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,e.next=4,Object(F.g)(t,1);case 4:a=e.sent,200===Object(W.u)(a)&&(n=a.data,Y(n.overGroupByTime),w(n.over),M(n.over)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:b(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return N.apply(this,arguments)});var N;return Object(O.useEffect)(function(){D(t)},[t]),I.a.createElement(r.a,{bordered:!1},I.a.createElement(r.a.Grid,{style:{width:"50%"}},I.a.createElement(A.a,{spinning:y},I.a.createElement("div",{style:{height:500}},I.a.createElement(P.a,{option:h})))),I.a.createElement(r.a.Grid,{style:{width:"50%"}},I.a.createElement(A.a,{spinning:y},I.a.createElement("div",{style:{height:500}},I.a.createElement(P.a,{ref:T,option:u})))),I.a.createElement(r.a.Grid,{style:{width:"100%"}},I.a.createElement(A.a,{spinning:y},I.a.createElement("div",{style:{height:500}},I.a.createElement(P.a,{option:c})))))},_=a("RIqP"),q=a.n(_),Q=a("CkN6"),Z=a("9zHi"),X=a.n(Z),U=["YYYY-MM-DD HH","YYYY-MM-DD","YYYY-MM"],$=function(e){var t=e.params,a=Object(O.useState)(!1),n=z()(a,2),r=n[0],i=n[1],c=Object(O.useState)({list:[],pagination:{}}),l=z()(c,2),s=l[0],o=l[1],u=Object(O.useMemo)(function(){return[{title:"时间",dataIndex:"day"},{title:"车流量合计",dataIndex:"total"},{title:"未违章",render:function(e,t){return t.total-t.overTotal-t.overSpeedTotal}},{title:"违章种类",children:[{title:"违章合计",render:function(e,t){return t.overTotal+t.overSpeedTotal}},{title:"超限超载",children:[{title:"合计",dataIndex:"overTotal"},{title:"超载<10(t)",dataIndex:"range01"},{title:"10<=超载<20(t)",dataIndex:"range12"},{title:"20<=超载<30(t)",dataIndex:"range23"},{title:"30<=超载<40(t)",dataIndex:"range34"},{title:"40<=超载<50(t)",dataIndex:"range45"},{title:"超载>=50(t)",dataIndex:"range510"}]},{title:"其它违章",dataIndex:"overSpeedTotal"}]}]},[]),d=function(e){return e.map(function(e){return p()({},e,{id:(new Date).getTime()+Math.random(),day:(a=e.day,n=t.resultType,4===n?a:L()(new Date(a)).format(U[n-1]))});var a,n})},m=function(e){var t={id:-1,day:"合计"};return["total","overLoadTotal","overSpeedTotal","overTotal","range01","range12","range23","range34","range45","range510","overSpeedTotal"].forEach(function(a){var n=0;e.forEach(function(e){n+=parseInt(e[a],10)}),t[a]=n}),t},h=(f=x()(v.a.mark(function e(t){var a,n,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i(!0),e.prev=1,e.next=4,Object(F.g)(t,1);case 4:a=e.sent,200===Object(W.u)(a)&&(n=d(a.data.overGroupByTime),r=m(n),o({list:[r].concat(q()(d(a.data.overGroupByTime))),pagination:{}})),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:i(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return f.apply(this,arguments)});var f;return Object(O.useEffect)(function(){h(t)},[t]),I.a.createElement("div",{className:X.a.tableList},I.a.createElement(Q.a,{tableAlert:!1,selectedRows:0,loading:r,rowSelection:null,data:s,size:"middle",columns:u}))},ee={pageNo:1,pageSize:10},te=function(e){var t=e.params,a=Object(O.useState)({list:[],pagination:{}}),n=z()(a,2),r=n[0],i=n[1],c=Object(O.useState)(!1),l=z()(c,2),s=l[0],o=l[1],u=Object(O.useMemo)(function(){return[{title:"站点名称",dataIndex:"siteName"},{title:"车道号",dataIndex:"laneNo"},{title:"车牌号",dataIndex:"carNo"},{title:"轴数",dataIndex:"axleNumber"},{title:"车属地",render:function(e,t){return t.province+t.city}},{title:"车重(t)",dataIndex:"totalLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"超重(t)",dataIndex:"overLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"超限比(%)",dataIndex:"overLoadRate",render:function(e){return(100*e).toFixed(2)}},{title:"速度(km/h)",dataIndex:"speed",render:function(e){return e||0}},{title:"超速(km/h)",dataIndex:"overSpeed",render:function(e){return e||0}},{title:"超速比(%)",dataIndex:"overSpeedRate",render:function(e){return(100*e).toFixed(2)}},{title:"车长(m)",dataIndex:"length",render:function(e){return e?e/1e3:0}},{title:"车辆种类",dataIndex:"truckCode"},{title:"检测时间",dataIndex:"previewTime",width:160,render:function(e){return L()(e).format("YYYY/MM/DD HH:mm:ss")}}]},[]),d=(m=x()(v.a.mark(function e(t){var a,n,r,c,l,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o(!0),e.prev=1,e.next=4,Object(F.c)(t);case 4:a=e.sent,200===Object(W.u)(a)&&(n=a.data,r=n.total,c=n.pageSize,l=n.currentPageNo,s=n.dynamicDatas,i({list:s,pagination:{total:r,pageSize:c,current:l}})),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:o(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return m.apply(this,arguments)});var m;return Object(O.useEffect)(function(){d(p()({},t,ee))},[t]),I.a.createElement("div",{className:X.a.tableList},I.a.createElement(Q.a,{tableAlert:!1,selectedRows:0,rowSelection:null,data:r,loading:s,size:"middle",columns:u,onChange:function(e){var a=p()({pageNo:e.current,pageSize:e.pageSize},t);d(a)}}))},ae=a("ns75"),ne=a.n(ae),re=[{key:"chart",tab:"统计图表"},{key:"reportForm",tab:"统计报表"},{key:"DataDetails",tab:"数据明细"}],ie=j.a.Item,ce=k.a.Option,le=function e(t){return t.map(function(t){return{title:t.id?t.city:t.province,value:t.code,key:t.code,children:t.childes?e(t.childes):[]}})},se=Object(H.connect)(function(e){return{system:e.system}})(n=j.a.create()(n=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=w()(this,(e=D()(t)).call.apply(e,[this].concat(r)))).state={activeTabKey:"chart",carTree:[],siteList:[],siteName:"",params:{startTime:"".concat(L()().format("YYYY-MM-DD"),"T00:00:00"),endTime:L()().format("YYYY-MM-DDTHH:mm:ss"),chartType:"line",resultType:1}},a.getSite=function(){(0,a.props.dispatch)({type:"system/userSite",payload:{siteType:1},callback:function(e){if(e.length){var t=e.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]].filter(function(e){return e})}});a.setState({siteList:t})}else g.a.error({title:"提示",content:"您没有绑定站点！！！"})}})},a.getCarCities=x()(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(F.e)();case 3:t=e.sent,200===Object(W.u)(t)&&a.setState({carTree:le(t.data)}),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}},e,null,[[0,8]])})),a.contentList=function(){var e=a.state,t=e.params,n=e.siteName;return{chart:I.a.createElement(J,{params:t,siteName:n}),reportForm:I.a.createElement($,{params:t}),DataDetails:I.a.createElement(te,{params:t})}},a.siteChange=function(e,t){var n=t.props;a.setState({siteName:n.children})},a.handleSearch=function(){a.props.form.validateFields(function(e,t){if(!e){var n=t.time?{startTime:L()(t.time[0]).format("YYYY-MM-DDTHH:mm:ss"),endTime:L()(t.time[1]).format("YYYY-MM-DDTHH:mm:ss")}:{},r=p()({},t,n);delete r.time,a.setState({params:r})}})},a.reportFormExport=x()(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.params,e.prev=1,e.next=4,Object(F.h)(t,1);case 4:n=e.sent,"application/json"!==Object(W.u)(n).type?Object(W.o)(n,"超限分析-时间-统计报表.xlsx"):d.a.error("下载失败"),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}},e,null,[[1,9]])})),a.dataDetailsExport=x()(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.params,e.prev=1,e.next=4,Object(F.d)(t);case 4:n=e.sent,"application/json"!==Object(W.u)(n).type?Object(W.o)(n,"超限分析-时间-数据明细.xlsx"):d.a.error("下载失败"),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}},e,null,[[1,9]])})),a.importClick=function(){var e=a.state.activeTabKey;"reportForm"===e&&a.reportFormExport(),"DataDetails"===e&&a.dataDetailsExport()},a}return S()(t,e),T()(t,[{key:"componentDidMount",value:function(){this.getCarCities(),this.getSite()}},{key:"render",value:function(){var e=this,t=this.state,a=t.activeTabKey,n=t.carTree,d=t.siteList,m=this.props.form.getFieldDecorator;return I.a.createElement(r.a,{bordered:!1},I.a.createElement("div",{className:X.a.tableListForm},I.a.createElement(j.a,{onSubmit:this.handleSearch,layout:"inline"},I.a.createElement(l.a,{gutter:16},I.a.createElement(o.a,{md:6,sm:24},I.a.createElement("div",{className:ne.a.inputMain},I.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测时间"),I.a.createElement(ie,{style:{flex:1}},m("time")(I.a.createElement(u.a.RangePicker,{className:ne.a.inputGroupLeftRadius,style:{width:"100%"},showTime:{defaultValue:[L()("00:00:00","HH:mm:ss"),L()(new Date,"HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss"}))))),I.a.createElement(o.a,{md:6,sm:24},I.a.createElement("div",{className:ne.a.inputMain},I.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"车辆种类"),I.a.createElement(ie,{style:{flex:1}},m("truckType")(I.a.createElement(k.a,{style:{width:"100%"},placeholder:"请选择"},I.a.createElement(ce,{value:1},"客货车"),I.a.createElement(ce,{value:2},"小汽车"),I.a.createElement(ce,{value:3},"其他")))))),I.a.createElement(o.a,{md:6,sm:24},I.a.createElement("div",{className:ne.a.inputMain},I.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"车属地"),I.a.createElement(ie,{style:{flex:1}},m("carTerritory")(I.a.createElement(s.a,{className:ne.a.inputGroupLeftRadius,treeData:n,style:{width:"100%"},placeholder:"请选择",onChange:this.treeSelectChange}))))),I.a.createElement(o.a,{md:6,sm:24},I.a.createElement("div",{className:ne.a.inputMain},I.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"结果展示"),I.a.createElement(ie,{style:{flex:1}},m("resultType",{initialValue:1})(I.a.createElement(k.a,{style:{width:"100%"},placeholder:"请选择"},I.a.createElement(ce,{value:1},"小时"),I.a.createElement(ce,{value:2},"天"),I.a.createElement(ce,{value:3},"月"),I.a.createElement(ce,{value:4},"年"))))))),I.a.createElement(l.a,{gutter:16},I.a.createElement(o.a,{md:6,sm:24},I.a.createElement("div",{className:ne.a.inputMain},I.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"轴数"),I.a.createElement(ie,{style:{flex:1}},m("axleNumber")(I.a.createElement(k.a,{style:{width:"100%"},placeholder:"请选择"},I.a.createElement(ce,{value:2},"2"),I.a.createElement(ce,{value:3},"3"),I.a.createElement(ce,{value:4},"4"),I.a.createElement(ce,{value:5},"5"),I.a.createElement(ce,{value:6},"6")))))),I.a.createElement(o.a,{md:6,sm:24},I.a.createElement("div",{className:ne.a.inputMain},I.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"监测点"),I.a.createElement(ie,{style:{flex:1}},m("siteCode")(I.a.createElement(k.a,{onChange:this.siteChange,className:ne.a.inputGroupLeftRadius,placeholder:"请选择"},d.map(function(e){return I.a.createElement(ce,{key:e.code,value:e.code},e.name)})))))),"chart"===a&&I.a.createElement(o.a,{md:6,sm:24},I.a.createElement("div",{className:ne.a.inputMain},I.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"显示方式"),I.a.createElement(ie,{style:{flex:1}},m("chartType",{initialValue:"line"})(I.a.createElement(k.a,{className:ne.a.inputGroupLeftRadius,placeholder:"请选择"},I.a.createElement(ce,{value:"line"},"曲线图"),I.a.createElement(ce,{value:"bar"},"柱状图"),I.a.createElement(ce,{value:"pie"},"饼图")))))),I.a.createElement("div",{style:{float:"right",marginBottom:24}},I.a.createElement(c.a,{type:"primary",htmlType:"submit"},"查询"),"chart"!==a&&I.a.createElement(c.a,{className:ne.a.import,icon:"import",onClick:this.importClick,style:{marginLeft:8}},"导出"))))),I.a.createElement(i.a,{style:{margin:0}}),I.a.createElement(r.a,{bordered:!1,tabList:re,activeTabKey:a,onTabChange:function(t){return e.setState({activeTabKey:t})},bodyStyle:{padding:"24px 0 0"}},this.contentList()[a]))}}]),t}(O.PureComponent))||n)||n;t.default=se}}]);