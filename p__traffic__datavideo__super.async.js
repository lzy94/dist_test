(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{qlCc:function(e,t,a){"use strict";a.r(t);a("T2oS");var n,r=a("W9HT"),i=(a("IzEo"),a("bx4M")),l=(a("14J3"),a("BMrR")),o=(a("+L6B"),a("2/Rp")),s=(a("jCWc"),a("kPKH")),c=(a("R9oj"),a("ECub")),m=a("lSNA"),u=a.n(m),p=a("MVZn"),d=a.n(p),h=a("lwsE"),f=a.n(h),g=a("W8MJ"),y=a.n(g),E=a("a1gu"),v=a.n(E),x=a("Nsbk"),T=a.n(x),S=a("7W2i"),O=a.n(S),b=(a("iQDF"),a("+eQT")),C=(a("OaEy"),a("2fM7")),M=(a("y8nQ"),a("Vl3Y")),Y=a("q1tI"),D=a.n(Y),L=a("MuoO"),w=a("wd/R"),N=a.n(w),A=a("mf+E"),R=a("+n12"),k=a("CkN6"),H=a("cVA7"),F=a.n(H),G=a("ns75"),W=a.n(G),V=a("9zHi"),I=a.n(V),P=M.a.Item,j=C.a.Option,B=b.a.MonthPicker,z=["/datavideo/super"],J=["#1890ff","#2fc25b","#13c2c2","#facc14"],U=Object(L.connect)(function(e){return{system:e.system,ChartStatistics:e.ChartStatistics,loading:e.loading.models.ChartStatistics}})(n=M.a.create()(n=function(e){function t(){var e,a;f()(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=v()(this,(e=T()(t)).call.apply(e,[this].concat(r)))).state={userSite:[],dateType:1,formValues:{type:"super",siteCode:"",dateType:1,dateOfCount:N()(new Date).format("YYYY-MM-DD")}},a.resetOverData=function(){(0,a.props.dispatch)({type:"ChartStatistics/resetOverrun"})},a.getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.props.dispatch)({type:"ChartStatistics/overSpeedCount",payload:e})},a.getUserSite=function(e,t){(0,a.props.dispatch)({type:"system/userSite",payload:{siteType:e},callback:function(e){var a=e.map(function(e){var t=Object.keys(e).join();return{code:t,name:e[t]}});t(a)}})},a.handleSearch=function(e){e.preventDefault();var t=a.props.form;a.resetOverData(),t.validateFields(function(e,t){if(!e){var n=d()({},t);n.dateType=n.dateType||1,n.siteCode=n.siteCode||"";var r="YYYY-MM-DD";2===n.dateType?r="YYYY-MM":3===n.dateType&&(r="YYYY"),n.dateOfCount=N()(n.dateOfCount).format(r),a.setState({formValues:n}),a.getList(n)}})},a.handleFormReset=function(){a.props.form.resetFields();var e={siteCode:"",dateType:1,dateOfCount:N()(new Date).format("YYYY-MM-DD")};a.setState({formValues:e}),a.resetOverData(),a.getList(e)},a.getData=function(){var e=a.props.ChartStatistics.overRunData;return[e.overLimit,e.total]},a.formatData=function(){var e=a.getData(),t=["HOUR","DAY","MONTH"],n=a.state.formValues.dateType-1,r=JSON.parse(JSON.stringify(e[0])),i=e[1].map(function(e){return e[t[n]]}),l=e[0].map(function(e){return e[t[n]]});for(var o in i)l.indexOf(i[o])<0&&r.push(u()({TOTAL:0},t[n],i[o]));return r.sort(function(e,a){return e[t[n]]-a[t[n]]})},a.getLineChart=function(){var e=a.getData(),t=a.state.formValues,n=e[0],r=e[1];if(0===n.length)return D.a.createElement(c.a,{style:{height:336,lineHeight:"330px"},image:c.a.PRESENTED_IMAGE_SIMPLE});var i=r.map(function(e){return"".concat(e.HOUR,":时")});2===t.dateType?i=r.map(function(e){return"".concat(e.DAY,"日")}):3===t.dateType&&(i=r.map(function(e){return"".concat(e.MONTH,"月")}));var l=[{name:"检测数",type:"bar",smooth:!0,barMaxWidth:13,data:r.map(function(e){return e.TOTAL})},{name:"超速数",type:"bar",smooth:!0,barMaxWidth:13,data:a.formatData().map(function(e){return e.TOTAL})},{name:"超速率",type:"line",smooth:!0,data:r.map(function(e,t){return(a.formatData()[t].TOTAL/e.TOTAL*100).toFixed(2)}),yAxisIndex:1}],o={color:J,title:{text:"超速率统计",textStyle:{fontSize:"15",fontWeight:300}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{right:"0",data:["检测数","超速数","超速率"]},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",axisTick:{alignWithLabel:!0},data:i},dataZoom:[{show:!0,realtime:!0,start:0,end:70},{type:"inside",realtime:!0,start:0,end:70}],yAxis:[{type:"value",name:"超速数"},{type:"value",name:"超速率",axisLabel:{formatter:"{value}%"}}],series:l};return D.a.createElement(F.a,{option:o,style:{height:400}})},a.pieChart=function(){var e=a.getData(),t=e[0],n=e[1];if(0===t.length)return D.a.createElement(c.a,{style:{height:336,lineHeight:"330px"},image:c.a.PRESENTED_IMAGE_SIMPLE});for(var r=0,i=0,l=0;l<n.length;l++)r+=n[l].TOTAL;for(var o=0;o<t.length;o++)i+=t[o].TOTAL;var s=[{value:i,name:"超速数"},{value:r-i,name:"未超速数"}],m={color:J,title:{text:"超速数统计",textStyle:{fontSize:"15",fontWeight:300}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:0,data:["超速数","未超速数"]},series:[{name:"",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!0,position:"center",fontSize:"18",color:"green",formatter:"总检测数\n\n".concat(r)}},labelLine:{normal:{show:!1}},data:s}]};return D.a.createElement(F.a,{option:m,style:{height:400}})},a.dateTypeChange=function(e){a.setState({dateType:e})},a.renderForm=function(){var e=a.props.form.getFieldDecorator,t=a.state,n=t.userSite,r=t.dateType;return D.a.createElement(M.a,{onSubmit:a.handleSearch,layout:"inline"},D.a.createElement(l.a,{gutter:{md:8,lg:16,xl:32}},D.a.createElement(s.a,{md:5,sm:24},D.a.createElement("div",{className:W.a.inputMain},D.a.createElement("span",{style:{width:"65px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"站点"),D.a.createElement(P,{style:{flex:1,marginBottom:0}},e("siteCode")(D.a.createElement(C.a,{className:W.a.inputGroupLeftRadius,placeholder:"请选择"},n.map(function(e,t){return D.a.createElement(j,{key:t,value:e.code},e.name)})))))),D.a.createElement(s.a,{md:5,sm:24},D.a.createElement("div",{className:W.a.inputMain},D.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"时间类型"),D.a.createElement(P,{style:{flex:1,marginBottom:0}},e("dateType")(D.a.createElement(C.a,{className:W.a.inputGroupLeftRadius,placeholder:"请选择",onChange:a.dateTypeChange},D.a.createElement(j,{value:1},"天"),D.a.createElement(j,{value:2},"月"),D.a.createElement(j,{value:3},"年")))))),D.a.createElement(s.a,{md:5,sm:24},1===r?D.a.createElement("div",{className:W.a.inputMain},D.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"日期选择"),D.a.createElement(P,{style:{flex:1,marginBottom:0}},e("dateOfCount")(D.a.createElement(b.a,{className:W.a.inputGroupLeftRadius,style:{width:"100%"}})))):null,2===r?D.a.createElement("div",{className:W.a.inputMain},D.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"月份选择"),D.a.createElement(P,{style:{flex:1,marginBottom:0}},e("dateOfCount")(D.a.createElement(B,{format:"YYYY-MM",className:W.a.inputGroupLeftRadius,style:{width:"100%"}})))):null,3===r?D.a.createElement("div",{className:W.a.inputMain},D.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"年份选择"),D.a.createElement(P,{style:{flex:1,marginBottom:0}},e("dateOfCount")(D.a.createElement(B,{format:"YYYY",className:W.a.inputGroupLeftRadius,style:{width:"100%"}})))):null),D.a.createElement(s.a,{md:4,sm:24},D.a.createElement("div",{style:{overflow:"hidden"}},D.a.createElement("div",null,D.a.createElement(o.a,{type:"primary",htmlType:"submit"},"查询"),D.a.createElement(o.a,{style:{marginLeft:8},onClick:a.handleFormReset},"重置"))))))},a}return O()(t,e),y()(t,[{key:"componentDidMount",value:function(){var e=this;if(Object(R.b)(z[0])){var t=this.state.formValues;this.getList(t),this.getUserSite(1,function(t){e.getUserSite(2,function(a){e.setState({userSite:t.concat(a)})})})}}},{key:"componentWillUnmount",value:function(){this.resetOverData()}},{key:"render",value:function(){var e=this.props,t=e.ChartStatistics,a=(t.overRunData,t.columns),n=t.tableData,l=e.loading;return D.a.createElement(Y.Fragment,null,Object(R.b)(z[0])?null:D.a.createElement(A.a,{to:"/exception/403"}),D.a.createElement(i.a,{bordered:!1},D.a.createElement("div",{className:I.a.tableListForm},this.renderForm())),D.a.createElement("div",null,D.a.createElement(i.a,{bordered:!1,style:{marginTop:8}},D.a.createElement(i.a.Grid,{style:{width:"70%"}},D.a.createElement(r.a,{spinning:l},this.getLineChart())),D.a.createElement(i.a.Grid,{style:{width:"30%"}},D.a.createElement(r.a,{spinning:l},this.pieChart())),D.a.createElement(i.a.Grid,{style:{width:"100%"}},D.a.createElement(k.a,{tableAlert:!1,selectedRows:0,rowSelection:null,loading:l,data:n,size:"middle",columns:a,pagination:!1,scroll:{x:"160%"}})))))}}]),t}(Y.PureComponent))||n)||n;t.default=U}}]);