(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{Gxru:function(e,t,a){"use strict";a.r(t);a("T2oS");var n,r=a("W9HT"),i=(a("14J3"),a("BMrR")),o=(a("+L6B"),a("2/Rp")),l=(a("jCWc"),a("kPKH")),s=a("MVZn"),c=a.n(s),p=(a("IzEo"),a("bx4M")),m=(a("aHsQ"),a("sGsY")),u=(a("R9oj"),a("ECub")),d=a("lwsE"),g=a.n(d),h=a("W8MJ"),f=a.n(h),y=a("a1gu"),E=a.n(y),v=a("Nsbk"),x=a.n(v),C=a("7W2i"),b=a.n(C),S=(a("iQDF"),a("+eQT")),M=(a("OaEy"),a("2fM7")),T=(a("y8nQ"),a("Vl3Y")),Y=a("q1tI"),D=a.n(Y),w=a("MuoO"),R=a("wd/R"),L=a.n(R),N=a("mf+E"),A=a("cVA7"),F=a.n(A),V=a("ns75"),k=a.n(V),G=a("9zHi"),P=a.n(G),O=a("+n12"),H=["/datavideo/overrange"],W=T.a.Item,I=M.a.Option,j=S.a.MonthPicker,B=["#1890ff","#2fc25b","#13c2c2","#facc14","#edafda","#93b7e3","#a5e7f0","#cbb0e3"],_=Object(w.connect)(function(e){return{system:e.system,TrafficApiV2Count:e.TrafficApiV2Count,loading:e.loading.models.TrafficApiV2Count}})(n=T.a.create()(n=function(e){function t(){var e,a;g()(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=E()(this,(e=x()(t)).call.apply(e,[this].concat(r)))).state={userSite:[],dateType:1,isopen:!1,formValues:{siteCode:"",dateType:1,dateStr:L()(new Date).format("YYYY-MM-DD")}},a.handlePanelChange=function(e){a.props.form.setFieldsValue({dateStr:e}),a.setState({isopen:!1})},a.handleOpenChange=function(e){e?a.setState({isopen:!0}):a.setState({isopen:!1})},a.getList=function(e){(0,a.props.dispatch)({type:"TrafficApiV2Count/overRangCount",payload:e})},a.getUserSite=function(e,t){(0,a.props.dispatch)({type:"system/userSite",payload:{siteType:e},callback:function(e){var a=e.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]]}});t(a)}})},a.dateTypeChange=function(e){a.setState({dateType:e})},a.getDataX=function(e){var t=a.state.formValues,n="时";2===t.dateType?n="日":3===t.dateType&&(n="月");for(var r=[],i=0;i<e.length;i+=1)1===t.dateType?r.push(e[i].day.slice(0,2)+n):r.push(e[i].day+n);return r},a.getFormData=function(e){for(var t=[[],[],[],[],[]],a=0;a<e.length;a+=1){var n=e[a],r=n.range01,i=n.range15,o=n.range510,l=n.range100,s=n.total;t[0].push(r),t[1].push(i),t[2].push(o),t[3].push(l),t[4].push(s)}return t},a.getLineChart=function(){var e=a.props.TrafficApiV2Count.overRangData.overRangGroupByDay,t=a.getDataX(e),n=[{name:"10%以下",type:"bar",smooth:!0,barMaxWidth:13,data:a.getFormData(e)[0]},{name:"10%~50%",type:"bar",smooth:!0,barMaxWidth:13,data:a.getFormData(e)[1]},{name:"50%~100%",type:"bar",smooth:!0,barMaxWidth:13,data:a.getFormData(e)[2]},{name:"100%以上",type:"bar",smooth:!0,barMaxWidth:13,data:a.getFormData(e)[3]},{name:"总数",type:"line",smooth:!0,data:a.getFormData(e)[4]}],r={color:B,title:{text:"超限幅度统计",textStyle:{fontSize:"15",fontWeight:300}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{right:"0",data:["10%以下","10%~50%","50%~100%","100%以上","总数"]},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",axisTick:{alignWithLabel:!0},data:t},dataZoom:[{show:!0,realtime:!0,start:0,end:70},{type:"inside",realtime:!0,start:0,end:70}],yAxis:[{type:"value"}],series:n};return e.length?D.a.createElement(F.a,{option:r,style:{height:"calc(100vh - 395px)"}}):D.a.createElement(u.a,{style:{height:"calc(100vh - 459px)",lineHeight:"calc(100vh - 459px)"},image:u.a.PRESENTED_IMAGE_SIMPLE})},a.getCount=function(e){var t=a.props.TrafficApiV2Count.overRangData.overRang;return Object.keys(t).length?t[e].doc_count:0},a.getAllCount=function(){var e=a.props.TrafficApiV2Count.overRangData.overRang,t=Object.keys(e);if(t.length){for(var n=0,r=0;r<t.length;r+=1)n+=e[t[r]].doc_count;return n}return 0},a.pieChart=function(){var e=a.props.TrafficApiV2Count.overRangData.overRang,t=[{value:a.getCount("01range"),name:"10%以下"},{value:a.getCount("12range"),name:"10%~20%"},{value:a.getCount("23range"),name:"20%~30%"},{value:a.getCount("34range"),name:"30%~40%"},{value:a.getCount("45range"),name:"40%~50%"},{value:a.getCount("510range"),name:"50%~100%"},{value:a.getCount("100range"),name:"100%以上"}],n={color:B,title:{text:"超限幅度统计",textStyle:{fontSize:"15",fontWeight:300}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{bottom:0,data:["10%以下","10%~20%","20%~30%","30%~40%","40%~50%","50%~100%","100%以上"]},series:[{name:"",type:"pie",radius:["55%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!0,position:"center",fontSize:"18",color:"green",formatter:"总超限数\n\n".concat(a.getAllCount())}},labelLine:{normal:{show:!1}},data:t}]};return Object.keys(e).length?D.a.createElement(F.a,{option:n,style:{height:"calc(100vh - 395px)"}}):D.a.createElement(u.a,{style:{height:"calc(100vh - 459px)",lineHeight:"calc(100vh - 459px)"},image:u.a.PRESENTED_IMAGE_SIMPLE})},a.renderProportion=function(){var e=a.getAllCount(),t=["10%以下","10%~20%","20%~30%","30%~40%","40%~50%","50%~100%","100%以上"],n=["01range","12range","23range","34range","45range","510range","100range"];return e?t.map(function(r,i){return D.a.createElement(p.a.Grid,{style:{width:"14.28%"},key:r},D.a.createElement(m.a,{style:{textAlign:"center"},title:t[i],precision:2,valueStyle:{color:"#13c2c2"},value:e?(a.getCount(n[i])/e*100).toFixed(2):"0.00",suffix:"%"}))}):D.a.createElement(u.a,{image:u.a.PRESENTED_IMAGE_SIMPLE})},a.handleSearch=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var n=c()({},t,{dateType:t.dateType||1,siteCode:t.siteCode||""}),r="YYYY-MM-DD";2===n.dateType?r="YYYY-MM":3===n.dateType&&(r="YYYY"),n.dateStr=L()(n.dateStr).format(r),a.setState({formValues:n}),a.getList(n)}})},a.handleFormReset=function(){a.props.form.resetFields();var e={siteCode:"",dateType:1,dateStr:L()(new Date).format("YYYY-MM-DD")};a.setState({formValues:e}),a.getList(e)},a.renderForm=function(){var e=a.props.form.getFieldDecorator,t=a.state,n=t.userSite,r=t.dateType,s=t.isopen;return D.a.createElement(T.a,{onSubmit:a.handleSearch,layout:"inline"},D.a.createElement(i.a,{gutter:{md:8,lg:16,xl:16}},D.a.createElement(l.a,{md:5,sm:24},D.a.createElement("div",{className:k.a.inputMain},D.a.createElement("span",{style:{width:"65px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"站点"),D.a.createElement(W,{style:{flex:1,marginBottom:0}},e("siteCode")(D.a.createElement(M.a,{className:k.a.inputGroupLeftRadius,placeholder:"请选择"},n.map(function(e){return D.a.createElement(I,{key:e.code,value:e.code},e.name)})))))),D.a.createElement(l.a,{md:5,sm:24},D.a.createElement("div",{className:k.a.inputMain},D.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"时间类型"),D.a.createElement(W,{style:{flex:1,marginBottom:0}},e("dateType")(D.a.createElement(M.a,{className:k.a.inputGroupLeftRadius,placeholder:"请选择",onChange:a.dateTypeChange},D.a.createElement(I,{value:1},"天"),D.a.createElement(I,{value:2},"月"),D.a.createElement(I,{value:3},"年")))))),D.a.createElement(l.a,{md:5,sm:24},1===r?D.a.createElement("div",{className:k.a.inputMain},D.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"日期选择"),D.a.createElement(W,{style:{flex:1,marginBottom:0}},e("dateStr")(D.a.createElement(S.a,{className:k.a.inputGroupLeftRadius,style:{width:"100%"}})))):null,2===r?D.a.createElement("div",{className:k.a.inputMain},D.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"月份选择"),D.a.createElement(W,{style:{flex:1,marginBottom:0}},e("dateStr")(D.a.createElement(j,{format:"YYYY-MM",className:k.a.inputGroupLeftRadius,style:{width:"100%"}})))):null,3===r?D.a.createElement("div",{className:k.a.inputMain},D.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"年份选择"),D.a.createElement(W,{style:{flex:1,marginBottom:0}},e("dateStr")(D.a.createElement(S.a,{open:s,mode:"year",format:"YYYY",style:{width:"100%"},className:k.a.inputGroupLeftRadius,onOpenChange:a.handleOpenChange,onPanelChange:a.handlePanelChange})))):null),D.a.createElement(l.a,{md:9,sm:24},D.a.createElement("div",{style:{overflow:"hidden"}},D.a.createElement("div",{style:{float:"right"}},D.a.createElement(o.a,{type:"primary",htmlType:"submit"},"查询"),D.a.createElement(o.a,{style:{marginLeft:8},onClick:a.handleFormReset},"重置"))))))},a}return b()(t,e),f()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.formValues;this.getList(t),this.getUserSite(1,function(t){e.setState({userSite:t})})}},{key:"render",value:function(){var e=this.props.loading;return D.a.createElement(Y.Fragment,null,Object(O.c)(H[0])?null:D.a.createElement(N.a,{to:"/exception/403"}),D.a.createElement(p.a,{bordered:!1},D.a.createElement("div",{className:P.a.tableListForm},this.renderForm())),D.a.createElement("div",null,D.a.createElement(p.a,{style:{marginTop:8},bordered:!1},D.a.createElement(p.a.Grid,{style:{width:"70%"}},D.a.createElement(r.a,{spinning:e},this.getLineChart())),D.a.createElement(p.a.Grid,{style:{width:"30%"}},D.a.createElement(r.a,{spinning:e},this.pieChart())),D.a.createElement(p.a.Grid,{style:{width:"100%",height:155}},D.a.createElement(r.a,{spinning:e},this.renderProportion())))))}}]),t}(Y.PureComponent))||n)||n;t.default=_}}]);