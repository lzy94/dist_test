(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{"4Ab9":function(e,t,a){"use strict";a.r(t);a("IzEo");var n,r=a("bx4M"),i=(a("14J3"),a("BMrR")),l=(a("iQDF"),a("+eQT")),o=(a("5NDa"),a("5rEg")),s=(a("jCWc"),a("kPKH")),d=(a("nRaC"),a("5RzL")),c=(a("2qtc"),a("kLXV")),m=(a("+L6B"),a("2/Rp")),u=a("lSNA"),p=a.n(u),h=(a("miYZ"),a("tsqr")),f=a("MVZn"),g=a.n(f),E=(a("+BJd"),a("mr32")),y=(a("5Dmo"),a("3S7+")),v=a("lwsE"),w=a.n(v),S=a("W8MJ"),x=a.n(S),L=a("a1gu"),b=a.n(L),N=a("Nsbk"),k=a.n(N),D=a("7W2i"),R=a.n(D),C=(a("7Kak"),a("9yH6")),I=(a("OaEy"),a("2fM7")),T=(a("y8nQ"),a("Vl3Y")),F=a("q1tI"),V=a.n(F),M=a("MuoO"),B=a("wd/R"),H=a.n(B),O=(a("riYV"),a("CkN6")),A=a("9zHi"),Y=a.n(A),G=a("ns75"),j=a.n(G),z=a("+n12"),P=T.a.Item,J=I.a.Option,q=C.a.Group,K={pageNo:1,pageSize:10},Q=Object(M.connect)(function(e){var t=e.system,a=e.TrafficApiV2BusData,n=e.user,r=e.loading;return{currentUser:n.currentUser,system:t,TrafficApiV2BusData:a,loading:r.models.TrafficApiV2BusData}})(n=T.a.create()(n=function(e){function t(){var e,a;w()(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=b()(this,(e=k()(t)).call.apply(e,[this].concat(r)))).state={formValues:{},siteList:[],newSiteList:[],directionkey:0},a.columns=[{title:"检查站",dataIndex:"siteName",width:190,render:function(e){return e.length>12?V.a.createElement(y.a,{title:e},e.substring(0,12),"..."):e}},{title:"车牌号",dataIndex:"carNo"},{title:"车辆方向",dataIndex:"direction"},{title:"检测时间",dataIndex:"previewTime",width:160,render:function(e){return H()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"轴数",dataIndex:"axleNumber"},{title:"车属地",dataIndex:"province"},{title:"速度(km/h)",dataIndex:"speed",width:90},{title:"总重(t)",dataIndex:"totalLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"限重(t)",dataIndex:"weightLimited",render:function(e){return V.a.createElement(E.a,{color:"#87d068"},(e/1e3).toFixed(2)," ")}},{title:"超重(t)",dataIndex:"overLoad",render:function(e){return e>0?V.a.createElement(E.a,{color:"#f5222d"},(e/1e3).toFixed(2)):(e/1e3).toFixed(2)}},{title:"超重比(%)",dataIndex:"overLoadRate",width:100,render:function(e){return(100*e).toFixed(2)}}].filter(function(e){return e}),a.getList=function(e){(0,a.props.dispatch)({type:"TrafficApiV2BusData/busDynamicDataForPage",payload:g()({},e)})},a.getSiteIN=function(){return{siteCodes:a.state.newSiteList.map(function(e){return e.code})}},a.showDetailModal=function(e){a.setState({detailId:e},function(){return a.handleDetailModalVisible(!0)})},a.handleDetailModalVisible=function(e){a.setState({detailModalVisible:!!e}),e||(a.setState({detailId:0}),a.resetDetail())},a.resetDetail=function(){(0,a.props.dispatch)({type:"TrafficApiV2BusData/resetDetail"})},a.handleStandardTableChange=function(e){var t=a.state.formValues,n=g()({pageNo:e.current,pageSize:e.pageSize},t);a.getList(n)},a.handleFormReset=function(){a.props.form.resetFields();var e=Object(z.z)("organId");a.getSite(e,function(){var e=a.getSiteIN();a.setState({formValues:e,directionkey:0}),a.getList(g()({},K,e))})},a.handleSearch=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var n="YYYY-MM-DDTHH:mm:ss",r=t.previewTime,i=t.otherSearch,l=t.siteCodes,o=t.startOverLoadRate,s=t.endOverLoadRate,d=t.startTotalLoad,c=t.endTotalLoad;if(!o&&!s||Object(z.F)(o)&&Object(z.F)(s))if(!d&&!c||Object(z.F)(d)&&Object(z.F)(c)){var m=r?{startPreviewTime:H()(r[0]).format(n),endPreviewTime:H()(r[1]).format(n)}:{},u={};if(i){var f=i.split("_");u=p()({},f[0],f[1])}if(a.getSiteIN().siteCodes.length){var E=l?[l]:a.getSiteIN().siteCodes,y=g()({},t,m,u,{siteCodes:E});delete y.previewTime,delete y.otherSearch,delete y.name,a.setState({formValues:y}),a.getList(g()({},K,y))}else h.a.error("当前机构暂无站点")}else h.a.error("总重请输入数字");else h.a.error("超限幅度请输入数字")}})},a.siteChange=function(e,t){var n=t.key,r=a.props.form;a.setState({directionkey:parseInt(n,10)},function(){return r.setFieldsValue({direction:void 0})})},a.renderOption=function(){return a.state.newSiteList.map(function(e){return V.a.createElement(J,{key:e.index,value:e.code},e.name)})},a.importClick=function(){a.setState({importLoading:!0}),(0,a.props.dispatch)({type:"TrafficApiV2BusData/import",payload:a.state.formValues,callback:function(e){404===e&&h.a.error("暂无数据"),a.setState({importLoading:!1})}})},a.getSite=function(e,t){(0,a.props.dispatch)({type:"Site/siteByUserSite",payload:{organId:e,siteIds:a.state.siteList.map(function(e){return e.code})},callback:function(e){var n=e.map(function(e,t){return"1"===e.siteType?{index:t+1,code:e.siteCode,name:e.siteName,direction:[e.forwardDirection,e.reverseDirection].filter(function(e){return e})}:""}).filter(function(e){return e});a.setState({newSiteList:n},function(){t&&t(n)})}})},a.treeSelectChange=function(e){a.props.form.setFieldsValue({siteCodes:void 0}),a.getSite(e),a.setState({directionkey:0})},a.renderSearchBotton=function(){var e=a.state.importLoading;return V.a.createElement("div",{style:{overflow:"hidden"}},V.a.createElement("div",{style:{float:"right",marginBottom:24}},V.a.createElement(m.a,{type:"primary",htmlType:"submit"},"查询"),V.a.createElement(m.a,{className:j.a.import,icon:"import",onClick:a.importClick,loading:e,disabled:e,style:{marginLeft:8}},"导出"),V.a.createElement(m.a,{style:{marginLeft:8},onClick:a.handleFormReset},"重置")))},a}return R()(t,e),x()(t,[{key:"componentDidMount",value:function(){var e=this;(0,this.props.dispatch)({type:"system/userSite",payload:{siteType:1},callback:function(t){if(t.length){var a=t.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]].filter(function(e){return e})}}),n=t.map(function(e){return Object.keys(e)[0]});e.setState({siteList:a,newSiteList:a,formValues:{siteCodes:n}}),e.getList(g()({},K,{siteCodes:n}))}else c.a.error({title:"提示",content:"您没有绑定站点！！！"})}})}},{key:"renderAdvancedForm",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.system.treeList,n=this.state,r=n.directionkey,c=n.newSiteList,m=Object(z.z)("organId").toString();return V.a.createElement(T.a,{onSubmit:this.handleSearch,layout:"inline"},V.a.createElement(i.a,{gutter:16},V.a.createElement(s.a,{md:5,sm:24},V.a.createElement("div",{className:j.a.inputMain},V.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"所属机构"),V.a.createElement(P,{style:{flex:1}},t("name")(V.a.createElement(d.a,{className:j.a.inputGroupLeftRadius,treeData:a,treeDefaultExpandedKeys:[m],style:{width:"100%"},placeholder:"请选择",onChange:this.treeSelectChange}))))),V.a.createElement(s.a,{md:5,sm:24},V.a.createElement("div",{className:j.a.inputMain},V.a.createElement("span",{style:{width:"70px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测点"),V.a.createElement(P,{style:{flex:1}},t("siteCodes")(V.a.createElement(I.a,{onChange:this.siteChange,className:j.a.inputGroupLeftRadius,placeholder:"请选择"},this.renderOption()))))),V.a.createElement(s.a,{md:4,sm:24},V.a.createElement(P,null,t("carNo")(V.a.createElement(o.a,{addonBefore:"车牌号",placeholder:"请输入"})))),V.a.createElement(s.a,{md:4,sm:24},V.a.createElement("div",{className:j.a.inputMain},V.a.createElement("span",{style:{width:"60px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"轴数"),V.a.createElement(P,{style:{flex:1}},t("axleNumber")(V.a.createElement(I.a,{className:j.a.inputGroupLeftRadius,placeholder:"请选择"},V.a.createElement(J,{value:""},"全部轴数"),V.a.createElement(J,{value:2},"2"),V.a.createElement(J,{value:3},"3"),V.a.createElement(J,{value:4},"4"),V.a.createElement(J,{value:5},"5"),V.a.createElement(J,{value:6},"6"),V.a.createElement(J,{value:"other"},"其他")))))),V.a.createElement(s.a,{md:6,sm:24},V.a.createElement("div",{className:j.a.inputMain},V.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测时间"),V.a.createElement(P,{style:{flex:1}},t("previewTime")(V.a.createElement(l.a.RangePicker,{className:j.a.inputGroupLeftRadius,style:{width:"100%"},showTime:{defaultValue:[H()("00:00:00","HH:mm:ss"),H()(new Date,"HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss"})))))),V.a.createElement(i.a,{gutter:16},V.a.createElement(s.a,{md:5,sm:24},V.a.createElement(o.a.Group,{compact:!0},V.a.createElement(P,{style:{display:"inline-block",width:"50%"}},t("startTotalLoad")(V.a.createElement(o.a,{className:"".concat(j.a.inputGroupRightRadius," ").concat(j.a.inputGroupRightborder),addonBefore:"总重(t)",placeholder:"请输入",style:{width:"100%",borderRight:0}}))),V.a.createElement(P,{style:{display:"inline-block",width:"50%"}},t("endTotalLoad")(V.a.createElement(o.a,{className:j.a.inputGroupRadiusAddon,addonBefore:"至",placeholder:"请输入",style:{width:"100%"}}))))),V.a.createElement(s.a,{md:5,sm:24},V.a.createElement(o.a.Group,{compact:!0},V.a.createElement(P,{style:{display:"inline-block",width:"60%"}},t("startOverLoadRate")(V.a.createElement(o.a,{className:"".concat(j.a.inputGroupRightRadius," ").concat(j.a.inputGroupRightborder),addonBefore:"超限幅度(%)",placeholder:"请输入",style:{width:"100%",borderRight:0}}))),V.a.createElement(P,{style:{display:"inline-block",width:"40%"}},t("endOverLoadRate")(V.a.createElement(o.a,{className:j.a.inputGroupRadiusAddon,addonBefore:"至",placeholder:"请输入",style:{width:"100%"}}))))),r?V.a.createElement(s.a,{md:4,sm:24},V.a.createElement("div",{className:j.a.inputMain},V.a.createElement("span",{style:{width:"60px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"方向"),V.a.createElement(P,{style:{flex:1}},t("direction",{})(V.a.createElement(I.a,{style:{width:"100%"},placeholder:"请选择"},c[r-1].direction.map(function(e){return V.a.createElement(J,{value:e,key:"".concat(e)},e)})))))):null,V.a.createElement(s.a,{md:6,sm:24},V.a.createElement(P,null,t("otherSearch",{})(V.a.createElement(q,null,V.a.createElement(C.a,{value:"overLoadFlag_1"},"只看超限"),V.a.createElement(C.a,{value:"readFlag_2"},"只看未读预警信息"))))),r?null:V.a.createElement(s.a,{md:6,sm:24,style:{float:"right"}},this.renderSearchBotton())),r?this.renderSearchBotton():null)}},{key:"render",value:function(){var e=this.props,t=e.TrafficApiV2BusData.dyData,a=e.loading;return V.a.createElement(r.a,{bordered:!1},V.a.createElement("div",{className:Y.a.tableList},V.a.createElement("div",{className:Y.a.tableListForm},this.renderAdvancedForm()),V.a.createElement(O.a,{tableAlert:!1,selectedRows:0,rowSelection:null,loading:a,data:t,size:"middle",columns:this.columns,onChange:this.handleStandardTableChange})))}}]),t}(F.PureComponent))||n)||n;t.default=Q}}]);