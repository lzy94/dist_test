(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{GoEr:function(e,t,i){"use strict";i.r(t);i("14J3");var a,n=i("BMrR"),r=(i("/zsF"),i("PArb")),o=(i("jCWc"),i("kPKH")),l=i("RIqP"),c=i.n(l),s=i("pVnL"),v=i.n(s),d=(i("miYZ"),i("tsqr")),u=i("lwsE"),f=i.n(u),h=i("W8MJ"),m=i.n(h),p=i("a1gu"),g=i.n(p),L=i("Nsbk"),y=i.n(L),T=i("7W2i"),w=i.n(T),k=(i("ozfa"),i("MJZm")),N=i("q1tI"),E=i.n(N),b=i("MuoO"),S=i("zOGa"),V=i("+n12"),C=i("h5Q+"),I=i.n(C),P=i("PCvj"),M=i.n(P),B=i("rtK1"),x=i.n(B),U=i("d5bk"),j=i.n(U),O=i("VqBU"),A=i.n(O),J=i("bkni"),q=i.n(J),F=k.a.TreeNode,H=Object(b.connect)(function(e){var t=e.Live,i=e.loading,a=e.user;return{Live:t,loading:i.models.Live,currentUser:a.currentUser}})(a=function(e){function t(){var e,i;f()(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(i=g()(this,(e=y()(t)).call.apply(e,[this].concat(n)))).liveNumber=[4,9,16],i.colSpan=[12,8,6],i.colHeight=["50%","33.33333%","25%"],i.serialList=[],i.autoTouch=null,i.state={treeList:[],livePathList:[],liveNumberIndex:0,liveVideoList:[],selectLiveVideo:-1},i.clearAutoTouch=function(){i.autoTouch&&clearInterval(i.autoTouch)},i.getLiveUrl=function(e,t){(0,i.props.dispatch)({type:"Live/fetch",payload:{channel:e},callback:function(e){"200"!==e.Header.ErrorNum?d.a.error("路径调用失败"):t(V.D+e.Body.URL)}})},i.getTreeList=function(){var e=i.props.dispatch,t=localStorage.getItem("siteIds");e({type:"Live/userSite",payload:{siteIds:t?t.split(","):[]},callback:function(e){var t=i.formatTree(e);i.setState({treeList:t})}})},i.renderTree=function(e){return e.map(function(e,t){var a=null;return a=1===e.type?{icon:E.a.createElement("img",{style:{width:15},src:A.a,alt:""})}:{icon:E.a.createElement("img",{style:{width:15},src:q.a,alt:""})},e.children.length?E.a.createElement(F,v()({},a,{title:e.title,key:e.key,dataRef:e}),i.renderTree(e.children)):E.a.createElement(F,v()({},a,e,{key:e.key}))})},i.formatTree=function(e){return e.map(function(e,t){return{title:e.siteName,key:e.id,type:0,children:e.sysMediaConfs.length?i.sysMediaConfs(e.sysMediaConfs):[]}})},i.sysMediaConfs=function(e){return e.map(function(e){return{title:e.mediaName,key:"".concat(e.id,"-").concat(e.lanNo,"-").concat(e.mediaNo),type:1,children:[]}}).filter(function(e){return e})},i.getTouch=function(e){(0,i.props.dispatch)({type:"Live/channelstream",payload:{channel:e}})},i.autoTouchFun=function(){i.autoTouch=setInterval(function(){for(var e=0;e<i.serialList.length;e+=1)i.getTouch(i.serialList[e])},3e4)},i.treeSelect=function(e,t){var a=i.state,n=a.selectLiveVideo,r=a.liveVideoList,o=a.liveNumberIndex,l=a.livePathList;if(i.clearAutoTouch(),/-/.test(e[0])){var s=e[0].split("-"),v=t.selectedNodes[0].props.title;i.getLiveUrl(s[2],function(e){if(-1===n){if(r.length===i.liveNumber[o])return d.a.error("播放位置已满");i.serialList.push(s[2]),i.setState({livePathList:[].concat(c()(l),[e]),liveVideoList:[].concat(c()(r),[{title:v,node:E.a.createElement(S.a,{src:e})}])},function(){return i.autoTouchFun()})}else{var t=Object.assign([],r);t[n]&&delete t[n],i.serialList[n]&&delete i.serialList[n],i.setState({livePathList:[].concat(c()(l),[e]),liveVideoList:t},function(){var t=Object.assign([],i.state.liveVideoList);i.serialList[n]=s[2],t[n]={title:v,node:E.a.createElement(S.a,{src:e})},i.setState({liveVideoList:t},function(){return i.autoTouchFun()})})}})}},i.getScreen=function(e){var t=i.state.liveVideoList,a=Object.assign([],t);t.length>i.liveNumber[e]&&i.setState({liveVideoList:a.slice(0,i.liveNumber[e])}),i.setState({liveNumberIndex:e,selectLiveVideo:-1})},i.getVideoCellIndex=function(e){i.setState({selectLiveVideo:e})},i.renderLive=function(){for(var e=i.state,t=e.liveNumberIndex,a=e.liveVideoList,n=e.selectLiveVideo,r=[],l=function(e){r.push(E.a.createElement(o.a,{key:e,span:i.colSpan[t],style:{height:"calc(".concat(i.colHeight[t]," - 2px)"),marginBottom:2,overflow:"hidden"}},E.a.createElement("div",{className:I.a.videoPanel+" "+(n===e?I.a.showBorder:""),style:{height:"100%",background:"#000",position:"relative"}},E.a.createElement("div",{className:I.a.mask,onClick:function(){return i.getVideoCellIndex(e)}},E.a.createElement("h3",{className:I.a.liveTitle},a[e]?a[e].title:null)),a[e]?a[e].node:null)))},c=0;c<i.liveNumber[t];c++)l(c);return r},i}return w()(t,e),m()(t,[{key:"componentDidMount",value:function(){this.getTreeList()}},{key:"componentWillUnmount",value:function(){this.clearAutoTouch()}},{key:"render",value:function(){var e=this,t=(this.props.loading,this.state.treeList);return E.a.createElement("div",{className:I.a.card},E.a.createElement("div",{className:I.a.liveMain},E.a.createElement("div",{className:I.a.leftTree},t.length?E.a.createElement(k.a,{showLine:!0,showIcon:!0,onSelect:this.treeSelect},this.renderTree(t)):null),E.a.createElement(r.a,{style:{height:"auto"},type:"vertical"}),E.a.createElement("div",{className:I.a.liveList},E.a.createElement("div",{className:I.a.liveListCell},E.a.createElement(n.a,{gutter:2,style:{height:"100%"}},this.renderLive())),E.a.createElement("div",{className:I.a.liveToolBar},E.a.createElement("img",{src:j.a,alt:"十六屏",onClick:function(){return e.getScreen(2)}}),E.a.createElement("img",{src:M.a,alt:"九屏",onClick:function(){return e.getScreen(1)}}),E.a.createElement("img",{src:x.a,alt:"四屏",onClick:function(){return e.getScreen(0)}})))))}}]),t}(N.PureComponent))||a;t.default=H},"h5Q+":function(e,t,i){e.exports={card:"antd-pro-pages-traffic-overview-video-video-live-card",liveMain:"antd-pro-pages-traffic-overview-video-video-live-liveMain",controlPanel:"antd-pro-pages-traffic-overview-video-video-live-controlPanel",leftTree:"antd-pro-pages-traffic-overview-video-video-live-leftTree",liveList:"antd-pro-pages-traffic-overview-video-video-live-liveList",liveListCell:"antd-pro-pages-traffic-overview-video-video-live-liveListCell",videoPanel:"antd-pro-pages-traffic-overview-video-video-live-videoPanel",showBorder:"antd-pro-pages-traffic-overview-video-video-live-showBorder",mask:"antd-pro-pages-traffic-overview-video-video-live-mask",liveTitle:"antd-pro-pages-traffic-overview-video-video-live-liveTitle",liveToolBar:"antd-pro-pages-traffic-overview-video-video-live-liveToolBar"}}}]);