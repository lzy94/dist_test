(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{Jioe:function(e,t,a){"use strict";a.r(t);a("IzEo");var n,r=a("bx4M"),i=(a("/zsF"),a("PArb")),l=(a("+L6B"),a("2/Rp")),c=(a("14J3"),a("BMrR")),s=(a("nRaC"),a("5RzL")),o=(a("jCWc"),a("kPKH")),u=(a("iQDF"),a("+eQT")),d=(a("miYZ"),a("tsqr")),m=a("MVZn"),p=a.n(m),x=a("o0o1"),h=a.n(x),f=a("yXPU"),v=a.n(f),E=(a("2qtc"),a("kLXV")),y=a("lwsE"),b=a.n(y),g=a("W8MJ"),Y=a.n(g),w=a("a1gu"),k=a.n(w),M=a("Nsbk"),T=a.n(M),D=a("7W2i"),N=a.n(D),S=(a("OaEy"),a("2fM7")),I=(a("y8nQ"),a("Vl3Y")),j=a("q1tI"),O=a.n(j),H=a("MuoO"),_=a("wd/R"),L=a.n(_),C=a("ruv0"),F=(a("T2oS"),a("W9HT")),R=a("J4zp"),z=a.n(R),A=a("zT9C"),G=a.n(A),P=a("m0dn"),W=a("+n12"),J={color:["#7CB5EC","#42414A","#94EF84","#F7A25A","#8486EF"],title:{text:"",subtext:"",left:"center"},tooltip:{trigger:"axis"},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{}}},legend:{top:"bottom",data:[]},grid:{left:"3%",right:"4%",bottom:30,containLabel:!0},xAxis:{type:"category",data:[]},yAxis:{type:"value",name:"数量(辆)"},series:[]},K=["YYYY-MM-DD HH","YYYY-MM-DD","YYYY-MM"],V=function(e){var t=e.params,a=e.siteName,n=Object(j.useState)({}),i=z()(n,2),l=i[0],c=i[1],s=Object(j.useState)({}),o=z()(s,2),u=o[0],d=o[1],m=Object(j.useState)({}),p=z()(m,2),x=p[0],f=p[1],E=Object(j.useState)(!1),y=z()(E,2),b=y[0],g=y[1],Y=function(e){var a=t.resultType;return 4===a?e:L()(new Date(e)).format(K[a-1])},w=function(e){var n=G()(J),r=e.map(function(e){return Y(e.day)});n.title.text="车流量分析统计",n.title.subtext=a||"所有站点",n.xAxis.data=r,n.legend.data=["车流量"];var i=[{name:"车流量",type:t.chartType,barMaxWidth:20,data:e.map(function(e){return e.total})}];n.series=i,c(n)},k=function(e){var n=G()(J),r=["超限超载","超速"];n.legend.data=r,n.title.text="违章车辆统计",n.title.subtext=a||"所有站点";var i=e.map(function(e){return Y(e.day)});n.xAxis.data=i;var l=["overLoadTotal","overSpeedTotal"].map(function(a,n){return{name:r[n],type:t.chartType,barMaxWidth:20,data:e.map(function(e){return e[a]})}});n.series=l,d(n)},M=function(e){var n=G()(J),r=["二轴","三轴","四轴","五轴","六轴","其他"];n.legend.data=r,n.title.text="车辆轴数统计",n.title.subtext=a||"所有站点";var i=e.map(function(e){return Y(e.day)});n.xAxis.data=i;var l=["2轴","3轴","4轴","5轴","6轴","其他"].map(function(a,n){return{name:r[n],type:t.chartType,barMaxWidth:20,data:e.map(function(e){return e.axle[a]})}});n.series=l,f(n)},T=(D=v()(h.a.mark(function e(t){var a,n;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),e.prev=1,e.next=4,Object(C.b)(t);case 4:a=e.sent,200===Object(W.u)(a)&&(n=a.data,w(n),k(n),M(n)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:g(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return D.apply(this,arguments)});var D;return Object(j.useEffect)(function(){T(t)},[t]),O.a.createElement(r.a,{bordered:!1},O.a.createElement(r.a.Grid,{style:{width:"100%"}},O.a.createElement(F.a,{spinning:b},O.a.createElement("div",{style:{height:500}},O.a.createElement(P.a,{option:l})))),O.a.createElement(r.a.Grid,{style:{width:"50%"}},O.a.createElement(F.a,{spinning:b},O.a.createElement("div",{style:{height:500}},O.a.createElement(P.a,{option:u})))),O.a.createElement(r.a.Grid,{style:{width:"50%"}},O.a.createElement(F.a,{spinning:b},O.a.createElement("div",{style:{height:500}},O.a.createElement(P.a,{option:x})))))},q=a("RIqP"),B=a.n(q),Q=a("CkN6"),Z=a("9zHi"),X=a.n(Z),U=["YYYY-MM-DD HH","YYYY-MM-DD","YYYY-MM"],$=function(e){var t=e.params,a=Object(j.useState)(!1),n=z()(a,2),r=n[0],i=n[1],l=Object(j.useState)({list:[],pagination:{}}),c=z()(l,2),s=c[0],o=c[1],u=Object(j.useMemo)(function(){return[{title:"时间",dataIndex:"day"},{title:"车流量合计",dataIndex:"total"},{title:"违章情况",children:[{title:"超限超载",dataIndex:"overLoadTotal"},{title:"超速",dataIndex:"overSpeedTotal"}]},{title:"车辆类型",children:[{title:"私家车",dataIndex:"trucks_1"},{title:"客货车",dataIndex:"trucks_2"},{title:"其他",dataIndex:"trucks_3"}]},{title:"车轴",children:[{title:"二轴",dataIndex:"axle_2"},{title:"三轴",dataIndex:"axle_3"},{title:"四轴",dataIndex:"axle_4"},{title:"五轴",dataIndex:"axle_5"},{title:"六轴",dataIndex:"axle_6"},{title:"其他",dataIndex:"axle_1"}]}]},[]),d=function(e){return e.map(function(e){return p()({},e,{day:(a=e.day,n=t.resultType,4===n?a:L()(new Date(a)).format(U[n-1])),trucks_1:e.trucks["私家车"],trucks_2:e.trucks["客货车"],trucks_3:e.trucks["其他"],axle_1:e.axle["其他"],axle_2:e.axle["2轴"],axle_3:e.axle["3轴"],axle_4:e.axle["4轴"],axle_5:e.axle["5轴"],axle_6:e.axle["6轴"]});var a,n})},m=function(e){var t={id:-1,day:"合计"};return["total","overLoadTotal","overSpeedTotal","trucks_1","trucks_2","trucks_3","axle_2","axle_3","axle_4","axle_5","axle_6","axle_1"].forEach(function(a){var n=0;e.forEach(function(e){n+=parseInt(e[a],10)}),t[a]=n}),t},x=(f=v()(h.a.mark(function e(t){var a,n,r;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i(!0),e.prev=1,e.next=4,Object(C.b)(t);case 4:a=e.sent,200===Object(W.u)(a)&&(n=d(a.data),r=m(n),o({list:[r].concat(B()(n)),pagination:{}})),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:i(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return f.apply(this,arguments)});var f;return Object(j.useEffect)(function(){x(t)},[t]),O.a.createElement("div",{className:X.a.tableList},O.a.createElement(Q.a,{tableAlert:!1,selectedRows:0,loading:r,rowSelection:null,data:s,size:"middle",columns:u}))},ee={pageNo:1,pageSize:10},te=function(e){var t=e.params,a=Object(j.useState)({list:[],pagination:{}}),n=z()(a,2),r=n[0],i=n[1],l=Object(j.useState)(!1),c=z()(l,2),s=c[0],o=c[1],u=Object(j.useMemo)(function(){return[{title:"站点名称",dataIndex:"siteName"},{title:"监测时间",dataIndex:"previewTime",width:160,render:function(e){return L()(e).format("YYYY/MM/DD HH:mm:ss")}},{title:"车道号",dataIndex:"laneNo"},{title:"车牌号",dataIndex:"carNo"},{title:"轴数",dataIndex:"axleNumber"},{title:"车属地",render:function(e,t){return t.province+t.city}},{title:"车重(t)",dataIndex:"totalLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"超重(t)",dataIndex:"overLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"超限比(%)",dataIndex:"overLoadRate",render:function(e){return(100*e).toFixed(2)}},{title:"速度(km/h)",dataIndex:"speed",render:function(e){return e||0}},{title:"超速(km/h)",dataIndex:"overSpeed",render:function(e){return e||0}},{title:"超速比(%)",dataIndex:"overSpeedRate",render:function(e){return(100*e).toFixed(2)}},{title:"车长(m)",dataIndex:"length",render:function(e){return e?e/1e3:0}},{title:"车辆种类",dataIndex:"truckCode"},{title:"检测时间",dataIndex:"previewTime",width:160,render:function(e){return L()(e).format("YYYY/MM/DD HH:mm:ss")}}]},[]),d=(m=v()(h.a.mark(function e(t){var a,n,r,l,c,s;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o(!0),e.prev=1,e.next=4,Object(C.c)(t);case 4:a=e.sent,200===Object(W.u)(a)&&(n=a.data,r=n.total,l=n.pageSize,c=n.currentPageNo,s=n.dynamicDatas,i({list:s,pagination:{total:r,pageSize:l,current:c}})),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:o(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return m.apply(this,arguments)});var m;return Object(j.useEffect)(function(){d(p()({},t,ee))},[t]),O.a.createElement("div",{className:X.a.tableList},O.a.createElement(Q.a,{tableAlert:!1,selectedRows:0,rowSelection:null,data:r,loading:s,size:"middle",columns:u,onChange:function(e){var a=p()({pageNo:e.current,pageSize:e.pageSize},t);d(a)}}))},ae=a("ns75"),ne=a.n(ae),re=[{key:"chart",tab:"统计图表"},{key:"reportForm",tab:"统计报表"},{key:"DataDetails",tab:"数据明细"}],ie=I.a.Item,le=S.a.Option,ce=function e(t){return t.map(function(t){return{title:t.id?t.city:t.province,value:t.code,key:t.code,children:t.childes?e(t.childes):[]}})},se=Object(H.connect)(function(e){return{system:e.system}})(n=I.a.create()(n=function(e){function t(){var e,a;b()(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=k()(this,(e=T()(t)).call.apply(e,[this].concat(r)))).state={activeTabKey:"chart",carTree:[],siteList:[],siteName:"",params:{startTime:"".concat(L()().format("YYYY-MM-DD"),"T00:00:00"),endTime:L()().format("YYYY-MM-DDTHH:mm:ss"),chartType:"line",resultType:2}},a.getSite=function(){(0,a.props.dispatch)({type:"system/userSite",payload:{siteType:1},callback:function(e){if(e.length){var t=e.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]].filter(function(e){return e})}});a.setState({siteList:t})}else E.a.error({title:"提示",content:"您没有绑定站点！！！"})}})},a.getCarCities=v()(h.a.mark(function e(){var t;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(C.e)();case 3:t=e.sent,200===Object(W.u)(t)&&a.setState({carTree:ce(t.data)}),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}},e,null,[[0,8]])})),a.contentList=function(){var e=a.state,t=e.params,n=e.siteName;return{chart:O.a.createElement(V,{params:t,siteName:n}),reportForm:O.a.createElement($,{params:t}),DataDetails:O.a.createElement(te,{params:t})}},a.siteChange=function(e,t){var n=t.props;a.setState({siteName:n.children})},a.handleSearch=function(){a.props.form.validateFields(function(e,t){if(!e){var n=t.time?{startTime:L()(t.time[0]).format("YYYY-MM-DDTHH:mm:ss"),endTime:L()(t.time[1]).format("YYYY-MM-DDTHH:mm:ss")}:{},r=p()({},t,n);delete r.time,a.setState({params:r})}})},a.reportFormExport=v()(h.a.mark(function e(){var t,n;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.params,e.prev=1,e.next=4,Object(C.f)(t,1);case 4:n=e.sent,"application/json"!==Object(W.u)(n).type?Object(W.o)(n,"统计总体情况分析-时间-统计报表.xlsx"):d.a.error("下载失败"),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}},e,null,[[1,9]])})),a.dataDetailsExport=v()(h.a.mark(function e(){var t,n;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.params,e.prev=1,e.next=4,Object(C.d)(t);case 4:n=e.sent,"application/json"!==Object(W.u)(n).type?Object(W.o)(n,"统计总体情况分析-时间-数据明细.xlsx"):d.a.error("下载失败"),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}},e,null,[[1,9]])})),a.importClick=function(){var e=a.state.activeTabKey;"reportForm"===e&&a.reportFormExport(),"DataDetails"===e&&a.dataDetailsExport()},a}return N()(t,e),Y()(t,[{key:"componentDidMount",value:function(){this.getCarCities(),this.getSite()}},{key:"render",value:function(){var e=this,t=this.state,a=t.activeTabKey,n=t.carTree,d=t.siteList,m=this.props.form.getFieldDecorator;return O.a.createElement(r.a,{bordered:!1},O.a.createElement("div",{className:X.a.tableListForm},O.a.createElement(I.a,{onSubmit:this.handleSearch,layout:"inline"},O.a.createElement(c.a,{gutter:16},O.a.createElement(o.a,{md:6,sm:24},O.a.createElement("div",{className:ne.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测时间"),O.a.createElement(ie,{style:{flex:1}},m("time")(O.a.createElement(u.a.RangePicker,{className:ne.a.inputGroupLeftRadius,style:{width:"100%"},showTime:{defaultValue:[L()("00:00:00","HH:mm:ss"),L()(new Date,"HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss"}))))),O.a.createElement(o.a,{md:6,sm:24},O.a.createElement("div",{className:ne.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"车辆种类"),O.a.createElement(ie,{style:{flex:1}},m("truckType")(O.a.createElement(S.a,{style:{width:"100%"},placeholder:"请选择"},O.a.createElement(le,{value:1},"客货车"),O.a.createElement(le,{value:2},"小汽车"),O.a.createElement(le,{value:3},"其他")))))),O.a.createElement(o.a,{md:6,sm:24},O.a.createElement("div",{className:ne.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"车属地"),O.a.createElement(ie,{style:{flex:1}},m("carTerritory")(O.a.createElement(s.a,{className:ne.a.inputGroupLeftRadius,treeData:n,style:{width:"100%"},placeholder:"请选择",onChange:this.treeSelectChange}))))),O.a.createElement(o.a,{md:6,sm:24},O.a.createElement("div",{className:ne.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"结果展示"),O.a.createElement(ie,{style:{flex:1}},m("resultType",{initialValue:2})(O.a.createElement(S.a,{style:{width:"100%"},placeholder:"请选择"},O.a.createElement(le,{value:1},"小时"),O.a.createElement(le,{value:2},"天"),O.a.createElement(le,{value:3},"月"),O.a.createElement(le,{value:4},"年"))))))),O.a.createElement(c.a,{gutter:16},O.a.createElement(o.a,{md:6,sm:24},O.a.createElement("div",{className:ne.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"轴数"),O.a.createElement(ie,{style:{flex:1}},m("axleNumber")(O.a.createElement(S.a,{style:{width:"100%"},placeholder:"请选择"},O.a.createElement(le,{value:2},"2"),O.a.createElement(le,{value:3},"3"),O.a.createElement(le,{value:4},"4"),O.a.createElement(le,{value:5},"5"),O.a.createElement(le,{value:6},"6")))))),O.a.createElement(o.a,{md:6,sm:24},O.a.createElement("div",{className:ne.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测点"),O.a.createElement(ie,{style:{flex:1}},m("siteCode")(O.a.createElement(S.a,{onChange:this.siteChange,className:ne.a.inputGroupLeftRadius,placeholder:"请选择"},d.map(function(e){return O.a.createElement(le,{key:e.code,value:e.code},e.name)})))))),"chart"===a&&O.a.createElement(o.a,{md:6,sm:24},O.a.createElement("div",{className:ne.a.inputMain},O.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"显示方式"),O.a.createElement(ie,{style:{flex:1}},m("chartType",{initialValue:"line"})(O.a.createElement(S.a,{className:ne.a.inputGroupLeftRadius,placeholder:"请选择"},O.a.createElement(le,{value:"line"},"曲线图"),O.a.createElement(le,{value:"bar"},"柱状图")))))),O.a.createElement("div",{style:{float:"right",marginBottom:24}},O.a.createElement(l.a,{type:"primary",htmlType:"submit"},"查询"),"chart"!==a&&O.a.createElement(l.a,{className:ne.a.import,icon:"import",onClick:this.importClick,style:{marginLeft:8}},"导出"))))),O.a.createElement(i.a,{style:{margin:0}}),O.a.createElement(r.a,{bordered:!1,tabList:re,activeTabKey:a,onTabChange:function(t){return e.setState({activeTabKey:t})},bodyStyle:{padding:"24px 0 0"}},this.contentList()[a]))}}]),t}(j.PureComponent))||n)||n;t.default=se}}]);