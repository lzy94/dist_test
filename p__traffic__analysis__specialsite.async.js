(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{sSFM:function(e,t,a){"use strict";a.r(t);a("IzEo");var n,r=a("bx4M"),i=(a("/zsF"),a("PArb")),c=(a("+L6B"),a("2/Rp")),l=(a("14J3"),a("BMrR")),s=(a("nRaC"),a("5RzL")),o=(a("jCWc"),a("kPKH")),u=(a("iQDF"),a("+eQT")),d=(a("miYZ"),a("tsqr")),m=a("MVZn"),p=a.n(m),h=a("o0o1"),f=a.n(h),v=a("yXPU"),x=a.n(v),g=(a("2qtc"),a("kLXV")),E=a("lwsE"),y=a.n(E),b=a("W8MJ"),T=a.n(b),w=a("a1gu"),N=a.n(w),S=a("Nsbk"),k=a.n(S),j=a("7W2i"),O=a.n(j),M=(a("OaEy"),a("2fM7")),I=(a("y8nQ"),a("Vl3Y")),D=a("q1tI"),Y=a.n(D),C=a("MuoO"),H=a("wd/R"),L=a.n(H),F=a("ruv0"),A=(a("T2oS"),a("W9HT")),R=a("J4zp"),z=a.n(R),G=a("zT9C"),B=a.n(G),P=a("m0dn"),K=a("+n12"),W={color:["#7CB5EC","#42414A","#94EF84","#F7A25A","#8486EF","#F75D84","#E7D352"],title:{text:"",subtext:"",left:"center"},tooltip:{trigger:"axis"},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{}}},legend:{top:"bottom",data:[]},grid:{left:"3%",right:"4%",bottom:30,containLabel:!0},xAxis:{type:"category",axisLabel:{rotate:45},data:[]},yAxis:{type:"value",name:"数量(辆)"},series:[]},J=function(e){var t=e.params,a=e.siteName,n=Object(D.useState)({}),i=z()(n,2),c=i[0],l=i[1],s=Object(D.useState)({}),o=z()(s,2),u=o[0],d=o[1],m=Object(D.useState)({}),p=z()(m,2),h=p[0],v=p[1],g=Object(D.useState)(!1),E=z()(g,2),y=E[0],b=E[1],T=Object(D.useRef)(null),w=function(e){var n=B()(W),r=e.map(function(e){return e.siteName});n.title.text="超限超载分布情况",n.title.subtext=a||"所有站点",n.xAxis.data=r;var i=["超限超载总数","超载<10(t)","10<=超载<20(t)","20<=超载<30(t)","30<=超载<40(t)","40<=超载<50(t)","超载>=50(t)"];n.legend.data=i;var c=["overTotal","range01","range12","range23","range34","range45","range510"].map(function(a,n){return{name:i[n],type:"pie"===t.chartType?"line":t.chartType,barMaxWidth:20,data:e.map(function(e){return e[a]})}});n.series=c,l(n)},N=function(e){var n=B()(W),r=["01range","12range","23range","34range","45range","510range"],i=["超载<10(t)","10<=超载<20(t)","20<=超载<30(t)","30<=超载<40(t)","40<=超载<50(t)","超载>=50(t)"];if(n.title.text="超限超载分类分析",n.title.subtext=a||"所有站点","pie"===t.chartType){T.current.getEchartsInstance().dispose(),n.legend.data=i,delete n.toolbox,delete n.xAxis,delete n.yAxis,n.tooltip={trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"};var c=[{name:"",type:"pie",data:r.map(function(t,a){return{value:e[t].doc_count,name:i[a]}})}];n.series=c,d(n)}else{n.xAxis.data=i,n.legend.data=["数量"];var l=[{name:"数量",type:t.chartType,barMaxWidth:20,data:r.map(function(t){return e[t].doc_count})}];n.series=l,d(n)}},S=function(e){var t=B()(W);t.legend.data=["超限超载占比","其它违章占比"],t.title.text="车辆轴数统计",t.title.subtext=a||"所有站点",delete t.xAxis,delete t.yAxis,delete t.toolbox,t.tooltip={trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"};var n=[{name:"",type:"pie",data:[{value:e.total_range.doc_count,name:"超限超载占比"},{value:e.overSpeed.doc_count,name:"其它违章占比"}]}];t.series=n,v(t)},k=(j=x()(f.a.mark(function e(t){var a,n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,e.next=4,Object(F.g)(t,2);case 4:a=e.sent,200===Object(K.u)(a)&&(n=a.data,w(n.overGroupByTime),N(n.over),S(n.over)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:b(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return j.apply(this,arguments)});var j;return Object(D.useEffect)(function(){k(t)},[t]),Y.a.createElement(r.a,{bordered:!1},Y.a.createElement(r.a.Grid,{style:{width:"50%"}},Y.a.createElement(A.a,{spinning:y},Y.a.createElement("div",{style:{height:500}},Y.a.createElement(P.a,{option:h})))),Y.a.createElement(r.a.Grid,{style:{width:"50%"}},Y.a.createElement(A.a,{spinning:y},Y.a.createElement("div",{style:{height:500}},Y.a.createElement(P.a,{ref:T,option:u})))),Y.a.createElement(r.a.Grid,{style:{width:"100%"}},Y.a.createElement(A.a,{spinning:y},Y.a.createElement("div",{style:{height:500}},Y.a.createElement(P.a,{option:c})))))},V=a("RIqP"),_=a.n(V),q=a("CkN6"),Q=a("9zHi"),Z=a.n(Q),X=function(e){var t=e.params,a=Object(D.useState)(!1),n=z()(a,2),r=n[0],i=n[1],c=Object(D.useState)({list:[],pagination:{}}),l=z()(c,2),s=l[0],o=l[1],u=Object(D.useMemo)(function(){return[{title:"监测站点",dataIndex:"siteName"},{title:"车流量合计",dataIndex:"total"},{title:"未违章",render:function(e,t){return t.total-t.overTotal-t.overSpeedTotal}},{title:"违章种类",children:[{title:"违章合计",render:function(e,t){return t.overTotal+t.overSpeedTotal}},{title:"超限超载",children:[{title:"合计",dataIndex:"overTotal"},{title:"超载<10(t)",dataIndex:"range01"},{title:"10<=超载<20(t)",dataIndex:"range12"},{title:"20<=超载<30(t)",dataIndex:"range23"},{title:"30<=超载<40(t)",dataIndex:"range34"},{title:"40<=超载<50(t)",dataIndex:"range45"},{title:"超载>=50(t)",dataIndex:"range510"}]},{title:"其它违章",dataIndex:"overSpeedTotal"}]}]},[]),d=function(e){return e.map(function(e){return p()({},e,{id:(new Date).getTime()+Math.random()})})},m=function(e){var t={id:-1,siteName:"合计"};return["total","overLoadTotal","overSpeedTotal","overTotal","range01","range12","range23","range34","range45","range510","overSpeedTotal"].forEach(function(a){var n=0;e.forEach(function(e){n+=parseInt(e[a],10)}),t[a]=n}),t},h=(v=x()(f.a.mark(function e(t){var a,n,r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i(!0),e.prev=1,e.next=4,Object(F.g)(t,2);case 4:a=e.sent,200===Object(K.u)(a)&&(n=d(a.data.overGroupByTime),r=m(n),o({list:[r].concat(_()(d(a.data.overGroupByTime))),pagination:{}})),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:i(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return v.apply(this,arguments)});var v;return Object(D.useEffect)(function(){h(t)},[t]),Y.a.createElement("div",{className:Z.a.tableList},Y.a.createElement(q.a,{tableAlert:!1,selectedRows:0,loading:r,rowSelection:null,data:s,size:"middle",columns:u}))},U={pageNo:1,pageSize:10},$=function(e){var t=e.params,a=Object(D.useState)({list:[],pagination:{}}),n=z()(a,2),r=n[0],i=n[1],c=Object(D.useState)(!1),l=z()(c,2),s=l[0],o=l[1],u=Object(D.useMemo)(function(){return[{title:"站点名称",dataIndex:"siteName"},{title:"车道号",dataIndex:"laneNo"},{title:"车牌号",dataIndex:"carNo"},{title:"轴数",dataIndex:"axleNumber"},{title:"车属地",render:function(e,t){return t.province+t.city}},{title:"车重(t)",dataIndex:"totalLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"超重(t)",dataIndex:"overLoad",render:function(e){return(e/1e3).toFixed(2)}},{title:"超限比(%)",dataIndex:"overLoadRate",render:function(e){return(100*e).toFixed(1)}},{title:"速度(km/h)",dataIndex:"speed",render:function(e){return e||0}},{title:"超速(km/h)",dataIndex:"overSpeed",render:function(e){return e||0}},{title:"超速比(%)",dataIndex:"overSpeedRate",render:function(e){return(100*e).toFixed(2)}},{title:"车长(m)",dataIndex:"length",render:function(e){return e?e/1e3:0}},{title:"车辆种类",dataIndex:"truckCode"},{title:"检测时间",dataIndex:"previewTime",width:160,render:function(e){return L()(e).format("YYYY/MM/DD HH:mm:ss")}}]},[]),d=(m=x()(f.a.mark(function e(t){var a,n,r,c,l,s;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o(!0),e.prev=1,e.next=4,Object(F.c)(t);case 4:a=e.sent,200===Object(K.u)(a)&&(n=a.data,r=n.total,c=n.pageSize,l=n.currentPageNo,s=n.dynamicDatas,i({list:s,pagination:{total:r,pageSize:c,current:l}})),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:o(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e){return m.apply(this,arguments)});var m;return Object(D.useEffect)(function(){d(p()({},t,U))},[t]),Y.a.createElement("div",{className:Z.a.tableList},Y.a.createElement(q.a,{tableAlert:!1,selectedRows:0,rowSelection:null,data:r,loading:s,size:"middle",columns:u,onChange:function(e){var a=p()({pageNo:e.current,pageSize:e.pageSize},t);d(a)}}))},ee=a("ns75"),te=a.n(ee),ae=[{key:"chart",tab:"统计图表"},{key:"reportForm",tab:"统计报表"},{key:"DataDetails",tab:"数据明细"}],ne=I.a.Item,re=M.a.Option,ie=function e(t){return t.map(function(t){return{title:t.id?t.city:t.province,value:t.code,key:t.code,children:t.childes?e(t.childes):[]}})},ce=Object(C.connect)(function(e){return{system:e.system}})(n=I.a.create()(n=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=N()(this,(e=k()(t)).call.apply(e,[this].concat(r)))).state={activeTabKey:"chart",carTree:[],siteList:[],siteName:"",params:{startTime:"".concat(L()().format("YYYY-MM-DD"),"T00:00:00"),endTime:L()().format("YYYY-MM-DDTHH:mm:ss"),chartType:"line"}},a.getSite=function(){(0,a.props.dispatch)({type:"system/userSite",payload:{siteType:1},callback:function(e){if(e.length){var t=e.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]].filter(function(e){return e})}});a.setState({siteList:t})}else g.a.error({title:"提示",content:"您没有绑定站点！！！"})}})},a.getCarCities=x()(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(F.e)();case 3:t=e.sent,200===Object(K.u)(t)&&a.setState({carTree:ie(t.data)}),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}},e,null,[[0,8]])})),a.contentList=function(){var e=a.state,t=e.params,n=e.siteName;return{chart:Y.a.createElement(J,{params:t,siteName:n}),reportForm:Y.a.createElement(X,{params:t}),DataDetails:Y.a.createElement($,{params:t})}},a.siteChange=function(e,t){var n=t.props;a.setState({siteName:n.children})},a.handleSearch=function(){a.props.form.validateFields(function(e,t){if(!e){var n=t.time?{startTime:L()(t.time[0]).format("YYYY-MM-DDTHH:mm:ss"),endTime:L()(t.time[1]).format("YYYY-MM-DDTHH:mm:ss")}:{},r=p()({},t,n);delete r.time,a.setState({params:r})}})},a.reportFormExport=x()(f.a.mark(function e(){var t,n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.params,e.prev=1,e.next=4,Object(F.h)(t,2);case 4:n=e.sent,"application/json"!==Object(K.u)(n).type?Object(K.o)(n,"超限分析-站点-统计报表.xlsx"):d.a.error("下载失败"),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}},e,null,[[1,9]])})),a.dataDetailsExport=x()(f.a.mark(function e(){var t,n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.params,e.prev=1,e.next=4,Object(F.d)(t);case 4:n=e.sent,"application/json"!==Object(K.u)(n).type?Object(K.o)(n,"超限分析-站点-数据明细.xlsx"):d.a.error("下载失败"),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}},e,null,[[1,9]])})),a.importClick=function(){var e=a.state.activeTabKey;"reportForm"===e&&a.reportFormExport(),"DataDetails"===e&&a.dataDetailsExport()},a}return O()(t,e),T()(t,[{key:"componentDidMount",value:function(){this.getCarCities(),this.getSite()}},{key:"render",value:function(){var e=this,t=this.state,a=t.activeTabKey,n=t.carTree,d=t.siteList,m=this.props.form.getFieldDecorator;return Y.a.createElement(r.a,{bordered:!1},Y.a.createElement("div",{className:Z.a.tableListForm},Y.a.createElement(I.a,{onSubmit:this.handleSearch,layout:"inline"},Y.a.createElement(l.a,{gutter:16},Y.a.createElement(o.a,{md:6,sm:24},Y.a.createElement("div",{className:te.a.inputMain},Y.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"检测时间"),Y.a.createElement(ne,{style:{flex:1}},m("time")(Y.a.createElement(u.a.RangePicker,{className:te.a.inputGroupLeftRadius,style:{width:"100%"},showTime:{defaultValue:[L()("00:00:00","HH:mm:ss"),L()(new Date,"HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss"}))))),Y.a.createElement(o.a,{md:6,sm:24},Y.a.createElement("div",{className:te.a.inputMain},Y.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"车辆种类"),Y.a.createElement(ne,{style:{flex:1}},m("truckType")(Y.a.createElement(M.a,{style:{width:"100%"},placeholder:"请选择"},Y.a.createElement(re,{value:1},"客货车"),Y.a.createElement(re,{value:2},"小汽车"),Y.a.createElement(re,{value:3},"其他")))))),Y.a.createElement(o.a,{md:6,sm:24},Y.a.createElement("div",{className:te.a.inputMain},Y.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"车属地"),Y.a.createElement(ne,{style:{flex:1}},m("carTerritory")(Y.a.createElement(s.a,{className:te.a.inputGroupLeftRadius,treeData:n,style:{width:"100%"},placeholder:"请选择",onChange:this.treeSelectChange}))))),Y.a.createElement(o.a,{md:6,sm:24},Y.a.createElement("div",{className:te.a.inputMain},Y.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"轴数"),Y.a.createElement(ne,{style:{flex:1}},m("axleNumber")(Y.a.createElement(M.a,{style:{width:"100%"},placeholder:"请选择"},Y.a.createElement(re,{value:2},"2"),Y.a.createElement(re,{value:3},"3"),Y.a.createElement(re,{value:4},"4"),Y.a.createElement(re,{value:5},"5"),Y.a.createElement(re,{value:6},"6"))))))),Y.a.createElement(l.a,{gutter:16},Y.a.createElement(o.a,{md:6,sm:24},Y.a.createElement("div",{className:te.a.inputMain},Y.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"监测点"),Y.a.createElement(ne,{style:{flex:1}},m("siteCode")(Y.a.createElement(M.a,{onChange:this.siteChange,className:te.a.inputGroupLeftRadius,placeholder:"请选择"},d.map(function(e){return Y.a.createElement(re,{key:e.code,value:e.code},e.name)})))))),"chart"===a&&Y.a.createElement(o.a,{md:6,sm:24},Y.a.createElement("div",{className:te.a.inputMain},Y.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"显示方式"),Y.a.createElement(ne,{style:{flex:1}},m("chartType",{initialValue:"line"})(Y.a.createElement(M.a,{className:te.a.inputGroupLeftRadius,placeholder:"请选择"},Y.a.createElement(re,{value:"line"},"曲线图"),Y.a.createElement(re,{value:"bar"},"柱状图"),Y.a.createElement(re,{value:"pie"},"饼图")))))),Y.a.createElement("div",{style:{float:"right",marginBottom:24}},Y.a.createElement(c.a,{type:"primary",htmlType:"submit"},"查询"),"chart"!==a&&Y.a.createElement(c.a,{className:te.a.import,icon:"import",onClick:this.importClick,style:{marginLeft:8}},"导出"))))),Y.a.createElement(i.a,{style:{margin:0}}),Y.a.createElement(r.a,{bordered:!1,tabList:ae,activeTabKey:a,onTabChange:function(t){return e.setState({activeTabKey:t})},bodyStyle:{padding:"24px 0 0"}},this.contentList()[a]))}}]),t}(D.PureComponent))||n)||n;t.default=ce}}]);