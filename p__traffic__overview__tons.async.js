(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{Dc3g:function(e,t,a){e.exports={main:"antd-pro-pages-traffic-overview-tons-index-main",photoList:"antd-pro-pages-traffic-overview-tons-index-photoList",photoItem:"antd-pro-pages-traffic-overview-tons-index-photoItem",imgItem:"antd-pro-pages-traffic-overview-tons-index-imgItem",tableList:"antd-pro-pages-traffic-overview-tons-index-tableList"}},gQ7y:function(e,t,a){"use strict";a.r(t);a("bbsP");var n,i=a("/wGt"),r=(a("T2oS"),a("W9HT")),l=(a("g9YV"),a("wCAj")),o=(a("miYZ"),a("tsqr")),c=a("RIqP"),s=a.n(c),m=(a("5Dmo"),a("3S7+")),d=(a("+L6B"),a("2/Rp")),u=(a("+BJd"),a("mr32")),p=a("lwsE"),g=a.n(p),v=a("W8MJ"),f=a.n(v),h=a("a1gu"),I=a.n(h),w=a("Nsbk"),E=a.n(w),L=a("7W2i"),b=a.n(L),N=a("q1tI"),y=a.n(N),x=a("MuoO"),D=a("zH15"),k=a.n(D),S=a("dNE1"),F=a.n(S),J=a("90cL"),V=a("+n12"),O=a("Dc3g"),P=a.n(O),M=null,z=Object(x.connect)(function(e){var t=e.Dynamic;return{Live:e.Live,Dynamic:t,loading:e.loading.models.Dynamic}})(n=function(e){function t(){var e,a;g()(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=I()(this,(e=E()(t)).call.apply(e,[this].concat(i)))).state={dataList:[],imgList:[],detailDrawerVisible:!1},a.columns=[{title:"站点名称",dataIndex:"siteName",width:200},{title:"车牌号",dataIndex:"carNo",width:150},{title:"轴数",dataIndex:"axleNumber",width:100},{title:"总重",dataIndex:"totalLoad",width:100,render:function(e){return"".concat((e/1e3).toFixed(2)," t")}},{title:"超载",width:100,dataIndex:"overLoad",render:function(e){return e>0?y.a.createElement(u.a,{color:"red"},(e/1e3).toFixed(2)," t"):"".concat((e/1e3).toFixed(2)," t")}},{title:"超重比",width:100,dataIndex:"overLoadRate",render:function(e){return e>.05?y.a.createElement(u.a,{color:"red"},(100*e).toFixed(2)," %"):"".concat((e/1e3).toFixed(2)," %")}},{title:"操作",key:"operation",width:10,render:function(e,t){return y.a.createElement(m.a,null,y.a.createElement(d.a,{onClick:function(){return a.getDetail(t)},type:"primary",shape:"circle",icon:"eye",size:"small"}))}}],a.getDetail=function(e){(0,a.props.dispatch)({type:"Dynamic/detail",payload:{id:e.id},callback:function(){a.closeDetailDrawerVisible(!0)}})},a.onMessage=function(e){var t=a.state,n=t.dataList,i=t.imgList,r=JSON.parse(e.body).data;r.key=(new Date).getTime();var l=[r].concat(s()(n));if(r.totalLoad>=1e5){var o=JSON.parse(JSON.stringify(i));4===o.length&&o.slice(3,1);var c=[r].concat(s()(o));a.setState({imgList:c})}a.setState({dataList:l})},a.connection=function(){var e=localStorage.getItem("siteIds"),t=new k.a(V.K);(M=F.a.over(t)).debug=null,M.connect({Authorization:""},function(){e&&e.split(",").map(function(e){return M.subscribe("/topic/".concat(e),a.onMessage),null})},function(){o.a.error("连接失败")})},a.renderImgItem=function(e){var t=a.state.imgList;if(!t.length)return null;var n=t[e];return n?y.a.createElement(N.Fragment,null,y.a.createElement("div",{className:P.a.imgItem},y.a.createElement("p",null,"站点名称：",n.siteName),y.a.createElement("p",null,"车牌号：",n.carNo),y.a.createElement("p",null,"轴数：",n.axleNumber),y.a.createElement("p",null,"总重：",(n.totalLoad/1e3).toFixed(2)," t"),y.a.createElement("p",null,"超载：",(n.overLoad/1e3).toFixed(2)," t"),y.a.createElement("p",null,"超重比：",(100*n.overLoadRate).toFixed(2)," %")),y.a.createElement("div",{className:P.a.imgItem},y.a.createElement("img",{src:P.a+n.frontPic,alt:"车辆正面"})),y.a.createElement("div",{className:P.a.imgItem},y.a.createElement("img",{src:V.B+n.backtPic,alt:"车辆尾部"})),y.a.createElement("div",{className:P.a.imgItem},y.a.createElement("img",{src:V.B+n.leftPic,alt:"车辆侧面"}))):null},a.closeDetailDrawerVisible=function(e){a.setState({detailDrawerVisible:!!e})},a}return b()(t,e),f()(t,[{key:"componentDidMount",value:function(){this.connection()}},{key:"componentWillUnmount",value:function(){if(M){try{M.disconnect()}catch(e){}M=null}}},{key:"render",value:function(){var e=this,t=this.props,a=t.Dynamic.detail,n=t.loading,o=this.state,c=o.dataList,s=o.detailDrawerVisible;return y.a.createElement("div",{className:P.a.main},y.a.createElement("div",{className:P.a.photoList},y.a.createElement("div",{className:P.a.photoItem},this.renderImgItem(0)),y.a.createElement("div",{className:P.a.photoItem},this.renderImgItem(1)),y.a.createElement("div",{className:P.a.photoItem},this.renderImgItem(2)),y.a.createElement("div",{className:P.a.photoItem},this.renderImgItem(3))),y.a.createElement("div",{className:P.a.tableList},y.a.createElement(l.a,{size:"small",dataSource:c,columns:this.columns,scroll:{y:390}})),y.a.createElement(i.a,{title:a.carNo||"",width:900,placement:"right",onClose:function(){return e.closeDetailDrawerVisible()},visible:s},y.a.createElement(r.a,{spinning:n},s&&"{}"!==JSON.stringify(a)?y.a.createElement(J.a,{detail:a}):null)))}}]),t}(N.PureComponent))||n;t.default=z}}]);