(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{Dc3g:function(e,t,a){e.exports={main:"antd-pro-pages-traffic-overview-tons-index-main",photoList:"antd-pro-pages-traffic-overview-tons-index-photoList",photoItem:"antd-pro-pages-traffic-overview-tons-index-photoItem",imgItem:"antd-pro-pages-traffic-overview-tons-index-imgItem",tableList:"antd-pro-pages-traffic-overview-tons-index-tableList"}},gQ7y:function(e,t,a){"use strict";a.r(t);a("bbsP");var n,i=a("/wGt"),r=(a("T2oS"),a("W9HT")),o=(a("cWXX"),a("/ezw")),l=(a("g9YV"),a("wCAj")),c=(a("miYZ"),a("tsqr")),s=a("RIqP"),d=a.n(s),m=(a("5Dmo"),a("3S7+")),u=(a("+L6B"),a("2/Rp")),p=(a("+BJd"),a("mr32")),f=a("lwsE"),h=a.n(f),g=a("W8MJ"),v=a.n(g),w=a("a1gu"),E=a.n(w),I=a("Nsbk"),y=a.n(I),L=a("7W2i"),D=a.n(L),x=a("q1tI"),b=a.n(x),N=a("MuoO"),T=a("zH15"),S=a.n(T),k=a("dNE1"),V=a.n(k),A=a("90cL"),B=a("+n12"),F=a("Dc3g"),J=a.n(F),O=null,z=Object(N.connect)(function(e){var t=e.TrafficApiV2BusData;return{TrafficSystemThreshold:e.TrafficSystemThreshold,TrafficApiV2BusData:t,loading:e.loading.models.TrafficApiV2BusData}})(n=function(e){function t(){var e,a;h()(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=E()(this,(e=y()(t)).call.apply(e,[this].concat(i)))).state={dataList:[],imgList:[],detailDrawerVisible:!1,thresholdAxial:[],realLoad:[]},a.columns=[{title:"站点名称",dataIndex:"siteName",width:200},{title:"车牌号",dataIndex:"carNo",width:150},{title:"轴数",dataIndex:"axleNumber",width:100},{title:"总重",dataIndex:"totalLoad",width:100,render:function(e){return"".concat((e/1e3).toFixed(2)," t")}},{title:"超载",width:100,dataIndex:"overLoad",render:function(e){return e>0?b.a.createElement(p.a,{color:"red"},(e/1e3).toFixed(2)," t"):0}},{title:"超重比",width:100,dataIndex:"overLoadRate",render:function(e){return e>.05?b.a.createElement(p.a,{color:"red"},(100*e).toFixed(2)," %"):"".concat((e/1e3).toFixed(2)," %")}},{title:"操作",key:"operation",width:10,render:function(e,t){return b.a.createElement(m.a,null,b.a.createElement(u.a,{onClick:function(){return a.getDetail(t)},type:"primary",shape:"circle",icon:"eye",size:"small"}))}}],a.getThreshold=function(e){(0,a.props.dispatch)({type:"TrafficSystemThreshold/fetch",payload:{pageBean:{page:1,pageSize:20,showTotal:!0}},callback:function(){var t=[],n=[];a.props.TrafficSystemThreshold.data.list.forEach(function(e){t.push(e.axleType),n.push(e.realLoad)}),a.setState({thresholdAxial:t,realLoad:n},function(){return e()})}})},a.getDetail=function(e){(0,a.props.dispatch)({type:"TrafficApiV2BusData/dyDataDetail",payload:e.id,callback:function(){a.closeDetailDrawerVisible(!0)}})},a.onMessage=function(e){var t=a.state,n=t.dataList,i=t.imgList,r=t.thresholdAxial,o=t.realLoad,l=JSON.parse(e.body).dynamicDataMsg;if(l.key=(new Date).getTime(),l.totalLoad>=1e5){var c=JSON.parse(JSON.stringify(i));4===c.length&&c.slice(3,1);var s=[l].concat(d()(c));a.setState({imgList:s})}var m=o[r.indexOf(l.axleNumber.toString())];if(l.totalLoad>=m){var u=[l].concat(d()(n));a.setState({dataList:u})}},a.connection=function(){var e=localStorage.getItem("siteIds"),t=new S.a(B.O);(O=V.a.over(t)).connect({Authorization:""},function(){e&&e.split(",").map(function(e){return O.subscribe("/topic/".concat(e),a.onMessage),null})},function(){c.a.error("连接失败")})},a.renderImgItem=function(e){var t=a.state.imgList;if(!t.length)return null;var n=t[e];return n?b.a.createElement(x.Fragment,null,b.a.createElement("div",{className:J.a.imgItem},b.a.createElement("p",null,"站点名称：",n.siteName),b.a.createElement("p",null,"车牌号：",n.carNo),b.a.createElement("p",null,"轴数：",n.axleNumber),b.a.createElement("p",null,"总重：",(n.totalLoad/1e3).toFixed(2)," t"),b.a.createElement("p",null,"超载：",(n.overLoad/1e3).toFixed(2)," t"),b.a.createElement("p",null,"超重比：",(100*n.overLoadRate).toFixed(2)," %")),b.a.createElement("div",{className:J.a.imgItem},b.a.createElement("img",{src:n.frontPic,alt:"车辆正面"})),b.a.createElement("div",{className:J.a.imgItem},b.a.createElement("img",{src:n.backtPic,alt:"车辆尾部"})),b.a.createElement("div",{className:J.a.imgItem},b.a.createElement("img",{src:n.leftPic,alt:"车辆侧面"}))):null},a.closeDetailDrawerVisible=function(e){a.setState({detailDrawerVisible:!!e})},a}return D()(t,e),v()(t,[{key:"componentDidMount",value:function(){var e=this;this.getThreshold(function(){return e.connection()})}},{key:"componentWillUnmount",value:function(){if(O){try{O.disconnect()}catch(e){}O=null}}},{key:"render",value:function(){var e=this,t=this.props,a=t.TrafficApiV2BusData.dyDataDetail.busDynamicLawDate,n=t.loading,c=this.state,s=c.dataList,d=c.detailDrawerVisible;return b.a.createElement("div",{className:J.a.main},b.a.createElement("div",{className:J.a.photoList},b.a.createElement("div",{className:J.a.photoItem},this.renderImgItem(0)),b.a.createElement("div",{className:J.a.photoItem},this.renderImgItem(1)),b.a.createElement("div",{className:J.a.photoItem},this.renderImgItem(2)),b.a.createElement("div",{className:J.a.photoItem},this.renderImgItem(3))),b.a.createElement("div",{className:J.a.tableList},b.a.createElement(l.a,{size:"small",dataSource:s,columns:this.columns,scroll:{y:390}})),b.a.createElement(i.a,{title:a.carNo||"",width:900,placement:"right",onClose:function(){return e.closeDetailDrawerVisible()},visible:d},b.a.createElement(r.a,{spinning:n},d&&"{}"!==JSON.stringify(a)?b.a.createElement(A.a,{detail:a}):b.a.createElement(o.a,{active:!0}))))}}]),t}(x.PureComponent))||n;t.default=z}}]);