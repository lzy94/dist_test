(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{Dc3g:function(e,t,a){e.exports={main:"antd-pro-pages-traffic-overview-tons-index-main",photoList:"antd-pro-pages-traffic-overview-tons-index-photoList",photoItem:"antd-pro-pages-traffic-overview-tons-index-photoItem",imgItem:"antd-pro-pages-traffic-overview-tons-index-imgItem",tableList:"antd-pro-pages-traffic-overview-tons-index-tableList"}},gQ7y:function(e,t,a){"use strict";a.r(t);a("bbsP");var n,i=a("/wGt"),r=(a("T2oS"),a("W9HT")),l=(a("cWXX"),a("/ezw")),o=(a("g9YV"),a("wCAj")),c=(a("miYZ"),a("tsqr")),s=a("RIqP"),m=a.n(s),d=(a("5Dmo"),a("3S7+")),u=(a("+L6B"),a("2/Rp")),p=(a("+BJd"),a("mr32")),f=a("lwsE"),g=a.n(f),v=a("W8MJ"),h=a.n(v),w=a("a1gu"),E=a.n(w),I=a("Nsbk"),D=a.n(I),L=a("7W2i"),b=a.n(L),N=a("q1tI"),y=a.n(N),x=a("MuoO"),V=a("zH15"),k=a.n(V),S=a("dNE1"),A=a.n(S),F=a("90cL"),J=a("+n12"),T=a("Dc3g"),B=a.n(T),O=null,M=Object(x.connect)(function(e){var t=e.TrafficApiV2BusData;return{Live:e.Live,TrafficApiV2BusData:t,loading:e.loading.models.TrafficApiV2BusData}})(n=function(e){function t(){var e,a;g()(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=E()(this,(e=D()(t)).call.apply(e,[this].concat(i)))).state={dataList:[],imgList:[],detailDrawerVisible:!1},a.columns=[{title:"站点名称",dataIndex:"siteName",width:200},{title:"车牌号",dataIndex:"carNo",width:150},{title:"轴数",dataIndex:"axleNumber",width:100},{title:"总重",dataIndex:"totalLoad",width:100,render:function(e){return"".concat((e/1e3).toFixed(2)," t")}},{title:"超载",width:100,dataIndex:"overLoad",render:function(e){return e>0?y.a.createElement(p.a,{color:"red"},(e/1e3).toFixed(2)," t"):0}},{title:"超重比",width:100,dataIndex:"overLoadRate",render:function(e){return e>.05?y.a.createElement(p.a,{color:"red"},(100*e).toFixed(2)," %"):"".concat((e/1e3).toFixed(2)," %")}},{title:"操作",key:"operation",width:10,render:function(e,t){return y.a.createElement(d.a,null,y.a.createElement(u.a,{onClick:function(){return a.getDetail(t)},type:"primary",shape:"circle",icon:"eye",size:"small"}))}}],a.getDetail=function(e){(0,a.props.dispatch)({type:"TrafficApiV2BusData/dyDataDetail",payload:e.id,callback:function(){a.closeDetailDrawerVisible(!0)}})},a.onMessage=function(e){var t=a.state,n=t.dataList,i=t.imgList,r=JSON.parse(e.body).dynamicDataMsg;r.key=(new Date).getTime();var l=[r].concat(m()(n));if(r.totalLoad>=1e5){var o=JSON.parse(JSON.stringify(i));4===o.length&&o.slice(3,1);var c=[r].concat(m()(o));a.setState({imgList:c})}a.setState({dataList:l})},a.connection=function(){var e=localStorage.getItem("siteIds"),t=new k.a(J.O);(O=A.a.over(t)).connect({Authorization:""},function(){e&&e.split(",").map(function(e){return O.subscribe("/topic/".concat(e),a.onMessage),null})},function(){c.a.error("连接失败")})},a.renderImgItem=function(e){var t=a.state.imgList;if(!t.length)return null;var n=t[e];return n?y.a.createElement(N.Fragment,null,y.a.createElement("div",{className:B.a.imgItem},y.a.createElement("p",null,"站点名称：",n.siteName),y.a.createElement("p",null,"车牌号：",n.carNo),y.a.createElement("p",null,"轴数：",n.axleNumber),y.a.createElement("p",null,"总重：",(n.totalLoad/1e3).toFixed(2)," t"),y.a.createElement("p",null,"超载：",(n.overLoad/1e3).toFixed(2)," t"),y.a.createElement("p",null,"超重比：",(100*n.overLoadRate).toFixed(2)," %")),y.a.createElement("div",{className:B.a.imgItem},y.a.createElement("img",{src:n.frontPic,alt:"车辆正面"})),y.a.createElement("div",{className:B.a.imgItem},y.a.createElement("img",{src:n.backtPic,alt:"车辆尾部"})),y.a.createElement("div",{className:B.a.imgItem},y.a.createElement("img",{src:n.leftPic,alt:"车辆侧面"}))):null},a.closeDetailDrawerVisible=function(e){a.setState({detailDrawerVisible:!!e})},a}return b()(t,e),h()(t,[{key:"componentDidMount",value:function(){this.connection()}},{key:"componentWillUnmount",value:function(){if(O){try{O.disconnect()}catch(e){}O=null}}},{key:"render",value:function(){var e=this,t=this.props,a=t.TrafficApiV2BusData.dyDataDetail.busDynamicLawDate,n=t.loading,c=this.state,s=c.dataList,m=c.detailDrawerVisible;return y.a.createElement("div",{className:B.a.main},y.a.createElement("div",{className:B.a.photoList},y.a.createElement("div",{className:B.a.photoItem},this.renderImgItem(0)),y.a.createElement("div",{className:B.a.photoItem},this.renderImgItem(1)),y.a.createElement("div",{className:B.a.photoItem},this.renderImgItem(2)),y.a.createElement("div",{className:B.a.photoItem},this.renderImgItem(3))),y.a.createElement("div",{className:B.a.tableList},y.a.createElement(o.a,{size:"small",dataSource:s,columns:this.columns,scroll:{y:390}})),y.a.createElement(i.a,{title:a.carNo||"",width:900,placement:"right",onClose:function(){return e.closeDetailDrawerVisible()},visible:m},y.a.createElement(r.a,{spinning:n},m&&"{}"!==JSON.stringify(a)?y.a.createElement(F.a,{detail:a}):y.a.createElement(l.a,{active:!0}))))}}]),t}(N.PureComponent))||n;t.default=M}}]);