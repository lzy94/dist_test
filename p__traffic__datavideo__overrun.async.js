(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{pHWz:function(e,t,a){"use strict";a.r(t);a("T2oS");var n,i=a("W9HT"),r=(a("IzEo"),a("bx4M")),l=(a("14J3"),a("BMrR")),o=(a("+L6B"),a("2/Rp")),s=(a("jCWc"),a("kPKH")),c=(a("R9oj"),a("ECub")),m=a("MVZn"),p=a.n(m),d=a("lwsE"),u=a.n(d),h=a("W8MJ"),g=a.n(h),f=a("a1gu"),y=a.n(f),E=a("Nsbk"),v=a.n(E),x=a("7W2i"),S=a.n(x),T=(a("iQDF"),a("+eQT")),C=(a("OaEy"),a("2fM7")),b=(a("y8nQ"),a("Vl3Y")),M=a("q1tI"),w=a.n(M),Y=a("MuoO"),L=a("wd/R"),N=a.n(L),D=a("mf+E"),V=a("CkN6"),k=a("cVA7"),A=a.n(k),R=a("ns75"),F=a.n(R),H=a("9zHi"),G=a.n(H),I=a("+n12"),O=b.a.Item,P=C.a.Option,W=T.a.MonthPicker,B=["/datavideo/overrun"],z=["#1890ff","#2fc25b","#13c2c2","#facc14"],j=Object(Y.connect)(function(e){return{system:e.system,TrafficApiV2Count:e.TrafficApiV2Count,loading:e.loading.models.TrafficApiV2Count}})(n=b.a.create()(n=function(e){function t(){var e,a;u()(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=y()(this,(e=v()(t)).call.apply(e,[this].concat(i)))).state={userSite:[],dateType:1,isopen:!1,formValues:{type:"overrun",origin:1,siteCode:"",dateType:1,dateStr:N()(new Date).format("YYYY-MM-DD")}},a.handlePanelChange=function(e){a.props.form.setFieldsValue({dateStr:e}),a.setState({isopen:!1})},a.handleOpenChange=function(e){e?a.setState({isopen:!0}):a.setState({isopen:!1})},a.getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.props.dispatch)({type:"TrafficApiV2Count/overLimitCount",payload:e})},a.getUserSite=function(e,t){(0,a.props.dispatch)({type:"system/userSite",payload:{siteType:e},callback:function(e){var a=e.map(function(e,t){var a=Object.keys(e);return{index:t+1,code:a[0],name:e[a[0]],direction:[e[a[1]],e[a[2]]]}});t(a)}})},a.handleSearch=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var n=p()({},t);n.dateType=n.dateType||1,n.siteCode=n.siteCode||"";var i="YYYY-MM-DD";2===n.dateType?i="YYYY-MM":3===n.dateType&&(i="YYYY"),n.dateStr=N()(n.dateStr).format(i),a.setState({formValues:n}),a.getList(n)}})},a.handleFormReset=function(){a.props.form.resetFields();var e={origin:1,siteCode:"",dateType:1,dateStr:N()(new Date).format("YYYY-MM-DD")};a.setState({formValues:e}),a.getList(e),a.getUserSite(1,function(e){a.setState({userSite:e})})},a.getLineChart=function(){var e=a.props.TrafficApiV2Count.overLimitData.data,t=a.state.formValues.dateType-1,n=["","日","月"],i=e.map(function(e){return"".concat(e.day).concat(n[t])}),r=[{name:"检测数",type:"bar",smooth:!0,barMaxWidth:13,data:e.map(function(e){return e.total})},{name:"货车总数",type:"bar",smooth:!0,barMaxWidth:13,data:e.map(function(e){return e.totalTrucks})},{name:"货车超限数",type:"bar",smooth:!0,barMaxWidth:13,data:e.map(function(e){return e.overTotal})},{name:"货车超限率",type:"line",smooth:!0,data:e.map(function(e){return e.totalTrucks?(e.overTotal/e.totalTrucks*100).toFixed(2):"0.00"}),yAxisIndex:1}],l={color:z,title:{text:"超限率统计",textStyle:{fontSize:"15",fontWeight:300}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{right:"0",data:["检测数","货车总数","货车超限数","货车超限率"]},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},dataZoom:[{show:!0,realtime:!0,start:0,end:70},{type:"inside",realtime:!0,start:0,end:70}],xAxis:{type:"category",axisTick:{alignWithLabel:!0},data:i},yAxis:[{type:"value",name:"超限数"},{type:"value",name:"超限率",axisLabel:{formatter:"{value}%"}}],series:r};return e.length?w.a.createElement(A.a,{option:l,style:{height:"calc(100vh - 542px)"}}):w.a.createElement(c.a,{style:{height:"calc(100vh - 606px)",lineHeight:"calc(100vh - 606px)"},image:c.a.PRESENTED_IMAGE_SIMPLE})},a.pieChart=function(){for(var e=a.props.TrafficApiV2Count.overLimitData.data,t=0,n=0,i=0,r=0;r<e.length;r+=1)t+=parseInt(e[r].total,10),n+=parseInt(e[r].overTotal,10),i+=parseInt(e[r].totalTrucks,10);var l=[{value:i,name:"货车总数"},{value:n,name:"货车超限数"}],o={color:z,title:{text:"超限数统计",textStyle:{fontSize:"15",fontWeight:300}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:0,data:["货车总数","货车超限数"]},series:[{name:"",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!0,position:"center",fontSize:"18",color:"green",formatter:"总检测数\n\n".concat(t)}},labelLine:{normal:{show:!1}},data:l}]};return e.length?w.a.createElement(A.a,{option:o,style:{height:"calc(100vh - 542px)"}}):w.a.createElement(c.a,{style:{height:"calc(100vh - 606px)",lineHeight:"calc(100vh - 606px)"},image:c.a.PRESENTED_IMAGE_SIMPLE})},a.dateTypeChange=function(e){a.setState({dateType:e})},a.originChange=function(e){a.getUserSite(e,function(e){a.setState({userSite:e})})},a.renderForm=function(){var e=a.props.form.getFieldDecorator,t=a.state,n=t.dateType,i=t.isopen,r=t.userSite;return w.a.createElement(b.a,{onSubmit:a.handleSearch,layout:"inline"},w.a.createElement(l.a,{gutter:{md:8}},w.a.createElement(s.a,{md:4,sm:24},w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"65px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"来源"),w.a.createElement(O,{style:{flex:1,marginBottom:0}},e("origin",{initialValue:1})(w.a.createElement(C.a,{onChange:a.originChange,className:F.a.inputGroupLeftRadius,placeholder:"请选择"},w.a.createElement(P,{value:1},"动态检测"),w.a.createElement(P,{value:2},"静态检测")))))),w.a.createElement(s.a,{md:5,sm:24},w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"65px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"站点"),w.a.createElement(O,{style:{flex:1,marginBottom:0}},e("siteCode")(w.a.createElement(C.a,{style:{width:"100%"},className:F.a.inputGroupLeftRadius,placeholder:"请选择"},r.map(function(e){return w.a.createElement(P,{key:e.code,value:e.code},e.name)})))))),w.a.createElement(s.a,{md:5,sm:24},w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"时间类型"),w.a.createElement(O,{style:{flex:1,marginBottom:0}},e("dateType",{initialValue:1})(w.a.createElement(C.a,{className:F.a.inputGroupLeftRadius,placeholder:"请选择",onChange:a.dateTypeChange},w.a.createElement(P,{value:1},"天"),w.a.createElement(P,{value:2},"月"),w.a.createElement(P,{value:3},"年")))))),w.a.createElement(s.a,{md:5,sm:24},1===n?w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"日期选择"),w.a.createElement(O,{style:{flex:1,marginBottom:0}},e("dateStr")(w.a.createElement(T.a,{className:F.a.inputGroupLeftRadius,style:{width:"100%"}})))):null,2===n?w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"月份选择"),w.a.createElement(O,{style:{flex:1,marginBottom:0}},e("dateStr")(w.a.createElement(W,{format:"YYYY-MM",className:F.a.inputGroupLeftRadius,style:{width:"100%"}})))):null,3===n?w.a.createElement("div",{className:F.a.inputMain},w.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"年份选择"),w.a.createElement(O,{style:{flex:1,marginBottom:0}},e("dateStr")(w.a.createElement(T.a,{open:i,mode:"year",format:"YYYY",style:{width:"100%"},className:F.a.inputGroupLeftRadius,onOpenChange:a.handleOpenChange,onPanelChange:a.handlePanelChange})))):null),w.a.createElement(s.a,{md:5,sm:24},w.a.createElement("div",{style:{overflow:"hidden"}},w.a.createElement("div",{style:{float:"right"}},w.a.createElement(o.a,{type:"primary",htmlType:"submit"},"查询"),w.a.createElement(o.a,{style:{marginLeft:8},onClick:a.handleFormReset},"重置"))))))},a}return S()(t,e),g()(t,[{key:"componentDidMount",value:function(){var e=this;if(Object(I.c)(B[0])){var t=this.state.formValues;this.getList(t),this.getUserSite(t.origin,function(t){e.setState({userSite:t})})}}},{key:"render",value:function(){var e=this.props,t=e.TrafficApiV2Count.overLimitData,a=t.columns,n=t.tableData,l=e.loading;return w.a.createElement(M.Fragment,null,Object(I.c)(B[0])?null:w.a.createElement(D.a,{to:"/exception/403"}),w.a.createElement(r.a,{bordered:!1},w.a.createElement("div",{className:G.a.tableListForm},this.renderForm())),w.a.createElement("div",null,w.a.createElement(r.a,{bordered:!1,style:{marginTop:8}},w.a.createElement(r.a.Grid,{style:{width:"70%"}},w.a.createElement(i.a,{spinning:l},this.getLineChart())),w.a.createElement(r.a.Grid,{style:{width:"30%"}},w.a.createElement(i.a,{spinning:l},this.pieChart())),w.a.createElement(r.a.Grid,{style:{width:"100%"}},w.a.createElement(V.a,{tableAlert:!1,selectedRows:0,rowSelection:null,loading:l,data:{list:n},size:"middle",columns:a,pagination:!1,scroll:{x:"160%"}})))))}}]),t}(M.PureComponent))||n)||n;t.default=j}}]);