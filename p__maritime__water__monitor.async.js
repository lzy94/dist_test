(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{PQPe:function(e,t,a){"use strict";a.r(t);a("g9YV");var n,i=a("wCAj"),r=(a("DjyN"),a("NUBc")),o=(a("T2oS"),a("W9HT")),l=(a("nRaC"),a("5RzL")),s=a("MVZn"),c=a.n(s),p=(a("R9oj"),a("ECub")),m=(a("miYZ"),a("tsqr")),u=(a("+BJd"),a("mr32")),d=a("lwsE"),g=a.n(d),h=a("W8MJ"),f=a.n(h),y=a("a1gu"),v=a.n(y),E=a("Nsbk"),C=a.n(E),P=a("7W2i"),w=a.n(P),S=a("q1tI"),b=a.n(S),D=a("MuoO"),L=a("wd/R"),I=a.n(L),M=a("zT9C"),N=a.n(M),k=a("cVA7"),H=a.n(k),x=a("zOGa"),R=a("lS5u"),z=a.n(R),B=Object(D.connect)(function(e){return{Live:e.Live,system:e.system,MaritimePoint:e.MaritimePoint,loading:e.loading.models.MaritimePoint}})(n=function(e){function t(e){var a;return g()(this,t),(a=v()(this,C()(t).call(this,e))).columns=[{title:"地点",dataIndex:"addr"},{title:"时间",dataIndex:"createTime",width:170,render:function(e){return I()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"正常水位",width:100,dataIndex:"normalHigh"},{title:"预警水位",width:100,dataIndex:"warningHigh"},{title:"当前水位",width:100,dataIndex:"waterLevel"},{title:"状态",width:130,render:function(e,t){return t.warning?b.a.createElement(u.a,{color:"#f50"},"预警"):b.a.createElement(u.a,{color:"#108ee9"},"正常")}}],a.getInitialState=function(){return{msg:{},tableData:[],chartData:[],formValue:[],waterPointQuery:{},pageBean:{page:1,pageSize:10,showTotal:!0},chartOption:a.getChartOption()}},a.myClearInterval=function(){a.autoData&&clearInterval(a.autoData)},a.getChartOption=function(){return{color:["#516b91","#59c4e6","#edafda","#93b7e3","#a5e7f0","#cbb0e3"],grid:{left:"0",right:"3%",bottom:"0",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},legend:{data:["水位"]},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:[{type:"value",name:"水位",axisLabel:{formatter:"{value} m"}}],series:[]}},a.getList=function(e){(0,a.props.dispatch)({type:"MaritimePoint/fetch",payload:e})},a.getGBSPath=function(e){(0,a.props.dispatch)({type:"Live/GBSPath",payload:{serial:e},callback:function(e){a.videoRef.player.src(e),a.videoRef.player.play()}})},a.getDetail=function(e){(0,a.props.dispatch)({type:"MaritimePoint/detail",payload:{ponitCode:e},callback:function(e){var t=e.roadMonitor;t&&Object.keys(t).length?a.getGBSPath(e.roadMonitor.serial):m.a.error("暂无监控")}})},a.setChartOption=function(e){var t=a.state,n=t.chartOption,i=t.msg,r=N()(n),o=e.map(function(e){return e.HOUR});r.xAxis.data=o;var l=[{name:"水位",smooth:!0,data:e.map(function(e){return e.WATERLEVEL}),type:"line",areaStyle:{},markLine:{silent:!0,data:[{yAxis:i.normalHigh,label:{show:!0,position:"middle",formatter:"正常水位线 ".concat(i.normalHigh)},lineStyle:{color:"#5176FD"}},{yAxis:i.warningHigh,label:{show:!0,position:"middle",formatter:"水位预警线 ".concat(i.warningHigh)},lineStyle:{color:"#F9787C"}}]}}];r.series=l,a.setState({chartOption:r})},a.renderChart=function(){var e=a.state,t=e.chartOption;return e.chartData.length?b.a.createElement(H.a,{option:t,style:{height:"100%"}}):b.a.createElement(p.a,{style:{lineHeight:"200px"},image:p.a.PRESENTED_IMAGE_SIMPLE})},a.getWaterPoint=function(e){(0,a.props.dispatch)({type:"MaritimePoint/waterPointList",payload:e,callback:function(e){var t=a.state.msg,n=e.rows.map(function(e,a){return c()({},e,{key:a,addr:t.addr,normalHigh:t.normalHigh,warningHigh:t.warningHigh,warning:t.normalHigh<e.waterLevel})});a.setState({tableData:{list:n,total:e.total,current:e.page,pageSize:e.pageSize}})}})},a.getPointInfoForDay=function(e){(0,a.props.dispatch)({type:"MaritimePoint/pointInfoForDay",payload:{ponitCode:e},callback:function(e){a.setState({chartData:e},function(){return a.setChartOption(e.reverse())})}})},a.renderPointList=function(){var e=a.props.MaritimePoint.data,t=a.state.msg;return e.list.length?e.list.map(function(e,n){return b.a.createElement("li",{onClick:function(){return a.pointClick(e)},className:t.ponitCode===e.ponitCode?z.a.active:"",key:n},e.addr)}):b.a.createElement(p.a,{image:p.a.PRESENTED_IMAGE_SIMPLE})},a.pointClick=function(e){var t={property:"ponitCode",value:e.ponitCode,group:"main",operation:"EQUAL",relation:"AND"};a.myClearInterval(),a.setState({msg:e,waterPointQuery:t},function(){a.initData(e.ponitCode,t),a.getDetail(e.ponitCode),a.autoData=setInterval(function(){return a.initData(e.ponitCode,t)},3e5)})},a.initData=function(e,t){var n=a.state.pageBean;a.getPointInfoForDay(e),a.getWaterPoint({pageBean:n,querys:[t]})},a.treeChange=function(e){var t=a.state.pageBean,n=[{property:"organCode",value:e,group:"main",operation:"RIGHT_LIKE",relation:"AND"}].filter(function(e){return e.value});a.setState({formValue:n}),a.getList({pageBean:t,querys:n})},a.paginationChange=function(e,t){var n=a.state.formValue;a.getList({pageBean:{page:e,pageSize:t,showTotal:!0},querys:n})},a.tablePaginationChange=function(e,t){var n=a.state.waterPointQuery;a.getWaterPoint({pageBean:{page:e,pageSize:t,showTotal:!0},querys:[n]})},a.state=a.getInitialState(),a.videoRef=b.a.createRef(),a.autoData=null,a}return w()(t,e),f()(t,[{key:"componentDidMount",value:function(){var e=this.state.pageBean;this.getList({pageBean:e})}},{key:"componentWillUnmount",value:function(){this.myClearInterval()}},{key:"render",value:function(){var e=this,t=this.props,a=t.loading,n=t.system.treeList,s=t.MaritimePoint.data,c=this.state,p=c.msg,m=c.tableData,u=m.list,d=m.total,g=m.pageSize,h=m.current;return b.a.createElement("div",{className:z.a.main},b.a.createElement("div",{className:z.a.leftList},b.a.createElement("div",{className:z.a.title},b.a.createElement("h3",null,b.a.createElement("span",null," "),"点位"),b.a.createElement(l.a,{treeData:n,placeholder:"请选择区域",style:{width:"100%"},onChange:this.treeChange})),b.a.createElement(o.a,{spinning:a},b.a.createElement("ul",{className:z.a.pointList},this.renderPointList())),b.a.createElement("div",{className:z.a.pagination},b.a.createElement(r.a,{size:"small",simple:!0,total:s.pagination.total,pageSize:s.pagination.pageSize,onChange:this.paginationChange}))),b.a.createElement("div",{className:z.a.content},b.a.createElement("div",{className:z.a.topContent},b.a.createElement("div",{className:z.a.title},p.addr),b.a.createElement("div",{className:z.a.chartContent},b.a.createElement("div",{className:z.a.chartPanel},this.renderChart()),b.a.createElement("div",{className:z.a.videoPanel},b.a.createElement("h3",null,"水位监控"),b.a.createElement("div",{style:{height:"100%",background:"#000",borderRadius:6}},b.a.createElement(x.a,{ref:function(t){return e.videoRef=t},src:""}))))),b.a.createElement("div",{className:z.a.bottomList},b.a.createElement("h3",null,b.a.createElement("span",null," "),"预警信息"),b.a.createElement(i.a,{size:"middle",pagination:{total:d,current:h,pageSize:g,onChange:this.tablePaginationChange},columns:this.columns,dataSource:u,loading:a,scroll:{y:155}}))))}}]),t}(S.PureComponent))||n;t.default=B}}]);