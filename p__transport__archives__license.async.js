(window.webpackJsonp=window.webpackJsonp||[]).push([[202],{Szwh:function(e,a,t){"use strict";t.r(a);var l,n,i,r,s,o,c,d=t("pVnL"),m=t.n(d),u=(t("IzEo"),t("bx4M")),p=(t("14J3"),t("BMrR")),h=(t("jCWc"),t("kPKH")),f=(t("5NDa"),t("5rEg")),g=(t("miYZ"),t("tsqr")),b=(t("P2fV"),t("NJEC")),E=(t("/zsF"),t("PArb")),y=(t("+L6B"),t("2/Rp")),v=(t("5Dmo"),t("3S7+")),V=t("lwsE"),k=t.n(V),F=t("W8MJ"),C=t.n(F),L=t("a1gu"),M=t.n(L),S=t("Nsbk"),D=t.n(S),N=t("7W2i"),w=t.n(N),T=(t("OaEy"),t("2fM7")),A=(t("y8nQ"),t("Vl3Y")),I=t("q1tI"),q=t.n(I),x=t("MuoO"),B=t("wd/R"),j=t.n(B),O=t("CkN6"),z=t("+n12"),P=(t("2qtc"),t("kLXV")),R=(t("DZo9"),t("8z0m")),H=(t("Pwec"),t("CtXQ")),J=(t("iQDF"),t("+eQT")),Y=t("MVZn"),K=t.n(Y),U=t("y01j"),X=t("ZP6J"),Z=t.n(X),Q=A.a.Item,W=Object(x.connect)(function(e){return{TransportArchivesLicense:e.TransportArchivesLicense,loading:e.loading.models.TransportArchivesLicense}})(l=A.a.create()((i=n=function(e){function a(){var e,t;k()(this,a);for(var l=arguments.length,n=new Array(l),i=0;i<l;i++)n[i]=arguments[i];return(t=M()(this,(e=D()(a)).call.apply(e,[this].concat(n)))).state={modalFirmVisible:!1,fileList:[],companyId:""},t.handleFirmModalVisible=function(e){t.setState({modalFirmVisible:!!e})},t.setSelectData=function(e){var a=t.props.form;t.setState({companyId:e.id_}),a.setFieldsValue({companyName:e.companyName,addr:e.addr,companyTel:e.account})},t.uploadConfig=function(){return{name:"files",action:"/result/api/file/v1/fileUpload",listType:"picture",accept:".jpg,.jpeg,.png",className:"upload-list-inline",data:{type:9},headers:{Authorization:"Bearer ".concat(Object(z.z)("token")[0]),"x-requested-with":"XMLHttpRequest"},beforeUpload:z.D,onChange:t.uploadChange}},t.uploadChange=function(e){"done"===e.file.status?200===e.file.response.code?(g.a.success("上传成功"),t.setState({fileList:e.fileList})):g.a.error(e.file.response.code.msg):"error"===e.file.status?g.a.error("上传失败"):"removed"===e.file.status&&t.setState({fileList:e.fileList})},t.save=function(){var e=t.props,a=e.dispatch,l=e.form,n=e.modalCallback,i=e.handleModalVisible,r=t.state,s=r.fileList,o=r.companyId;l.validateFields(function(e,t){if(!e){if(!s.length)return g.a.error("请选择图片");var l=K()({},t,{companyId:o,licenceImg:s.length?s[0].response.filePath:"",status:2});delete l.img,a({type:"TransportArchivesLicense/add",payload:l,callback:function(){g.a.success("添加成功"),i(),setTimeout(function(){return n()},300)}})}})},t.cancelClick=function(){var e=t.props.handleModalVisible;t.setState({fileList:[]}),e()},t}return w()(a,e),C()(a,[{key:"render",value:function(){var e=this,a=this.props,t=a.form,l=a.modalVisible,n=a.loading,i=this.state,r=i.modalFirmVisible,s=i.fileList;return q.a.createElement(I.Fragment,null,q.a.createElement(P.a,{destroyOnClose:!0,title:"添加",className:Z.a.formModal,visible:l,width:800,onCancel:this.cancelClick,footer:[q.a.createElement(y.a,{key:"back",onClick:this.cancelClick},"取消"),q.a.createElement(y.a,{key:"submit",type:"primary",loading:n,onClick:this.save},"确定")]},q.a.createElement("div",{className:Z.a.formModalBody},q.a.createElement(p.a,{gutter:40},q.a.createElement(h.a,{md:12,sm:24},q.a.createElement(Q,{label:"许可证名称"},t.getFieldDecorator("licenceName",{rules:[{required:!0,message:"请输入许可证名称！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(Q,{label:"许可证编号"},t.getFieldDecorator("licenceNo",{rules:[{required:!0,message:"请输入许可证编号！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(Q,{label:"核发机关"},t.getFieldDecorator("issuingAuth",{rules:[{required:!0,message:"请输入核发机关！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(Q,{label:"许可证有效期"},t.getFieldDecorator("termValidity",{rules:[{required:!0,message:"请选择许可证有效期！"}]})(q.a.createElement(J.a,{style:{width:"100%"}}))),q.a.createElement(Q,{label:"许可证照"},t.getFieldDecorator("img",{rules:[{required:!0,message:"请上传营业执照"}]})(q.a.createElement(R.a,m()({},this.uploadConfig(),{defaultFileList:s}),s.length>0?null:q.a.createElement(y.a,null,q.a.createElement(H.a,{type:"upload"})," 请上传营业执照(jpg,jpeg,png)"))))),q.a.createElement(h.a,{md:12,sm:24},q.a.createElement(Q,{label:"公司名称"},t.getFieldDecorator("companyName",{rules:[{required:!0,message:"请输入公司名称！"}]})(q.a.createElement(f.a,{readOnly:!0,placeholder:"请输入",onClick:function(){return e.handleFirmModalVisible(!0)}}))),q.a.createElement(Q,{label:"公司联系电话"},t.getFieldDecorator("companyTel",{rules:[{required:!0,message:"请输入公司联系电话！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(Q,{label:"地址"},t.getFieldDecorator("addr",{rules:[{required:!0,message:"请输入地址！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(Q,{label:"经营范围"},t.getFieldDecorator("businessScop",{rules:[{required:!0,message:"请输入经营范围！"}]})(q.a.createElement(f.a.TextArea,{placeholder:"请输入"}))))))),r?q.a.createElement(U.a,{modalVisible:r,setSelectData:this.setSelectData,handleModalVisible:this.handleFirmModalVisible}):null)}}]),a}(I.PureComponent),n.defaultProps={modalVisible:!1,handleModalVisible:function(){}},l=i))||l)||l,_=(t("7Kak"),t("9yH6")),G=A.a.Item,$=["待审核","审核通过","驳回"],ee=Object(x.connect)(function(e){return{TransportArchivesLicense:e.TransportArchivesLicense,loading:e.loading.models.TransportArchivesLicense}})(r=A.a.create()((o=s=function(e){function a(){var e,t;k()(this,a);for(var l=arguments.length,n=new Array(l),i=0;i<l;i++)n[i]=arguments[i];return(t=M()(this,(e=D()(a)).call.apply(e,[this].concat(n)))).state={modalFirmVisible:!1,fileList:[],companyId:""},t.handleFirmModalVisible=function(e){t.setState({modalFirmVisible:!!e})},t.setSelectData=function(e){var a=t.props.form;t.setState({companyId:e.id_}),a.setFieldsValue({companyName:e.companyName,addr:e.addr,companyTel:e.account})},t.uploadConfig=function(){return{name:"files",action:"/result/api/file/v1/fileUpload",listType:"picture",accept:".jpg,.jpeg,.png",className:"upload-list-inline",data:{type:9},headers:{Authorization:"Bearer ".concat(Object(z.z)("token")[0]),"x-requested-with":"XMLHttpRequest"},beforeUpload:z.D,onChange:t.uploadChange}},t.uploadChange=function(e){"done"===e.file.status?200===e.file.response.code?(g.a.success("上传成功"),t.setState({fileList:e.fileList})):g.a.error(e.file.response.code.msg):"error"===e.file.status?g.a.error("上传失败"):"removed"===e.file.status&&t.setState({fileList:e.fileList})},t.save=function(){var e=t.props,a=e.dispatch,l=e.form,n=e.modalCallback,i=e.handleModalVisible,r=t.state,s=r.companyId,o=r.detail,c=r.fileList;l.validateFields(function(e,t){if(!e){if(!c.length)return g.a.error("请选择图片");var l=K()({},t,{companyId:s});if("object"==typeof l.img){var r=l.licenceImg.file.response;l.licenceImg=r?r.filePath:""}delete l.img;for(var d=JSON.parse(JSON.stringify(o)),m=Object.keys(l),u=0;u<m.length;u+=1)d[m[u]]=l[m[u]];a({type:"TransportArchivesLicense/update",payload:d,callback:function(){g.a.success("编辑成功"),i(),setTimeout(function(){return n()},300)}})}})},t.cancelClick=function(){var e=t.props.handleModalVisible;t.setState({fileList:[]}),e()},t}return w()(a,e),C()(a,[{key:"render",value:function(){var e=this,a=this.props,t=a.form,l=a.modalVisible,n=a.loading,i=this.state,r=i.modalFirmVisible,s=i.fileList,o=i.detail;return q.a.createElement(I.Fragment,null,q.a.createElement(P.a,{destroyOnClose:!0,title:"编辑",className:Z.a.formModal,visible:l,width:800,onCancel:this.cancelClick,footer:[q.a.createElement(y.a,{key:"back",onClick:this.cancelClick},"取消"),q.a.createElement(y.a,{key:"submit",type:"primary",loading:n,onClick:this.save},"确定")]},q.a.createElement("div",{className:Z.a.formModalBody},q.a.createElement(p.a,{gutter:40},q.a.createElement(h.a,{md:12,sm:24},q.a.createElement(G,{label:"许可证名称"},t.getFieldDecorator("licenceName",{initialValue:o.licenceName,rules:[{required:!0,message:"请输入许可证名称！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(G,{label:"许可证编号"},t.getFieldDecorator("licenceNo",{initialValue:o.licenceNo,rules:[{required:!0,message:"请输入许可证编号！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(G,{label:"核发机关"},t.getFieldDecorator("issuingAuth",{initialValue:o.issuingAuth,rules:[{required:!0,message:"请输入核发机关！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(G,{label:"许可证有效期"},t.getFieldDecorator("termValidity",{initialValue:j()(o.termValidity,"YYYY-MM-DD"),rules:[{required:!0,message:"请选择许可证有效期！"}]})(q.a.createElement(J.a,{style:{width:"100%"}}))),q.a.createElement(G,{label:"许可证照"},t.getFieldDecorator("img",{initialValue:o.licenceImg,rules:[{required:!0,message:"请上传营业执照"}]})(q.a.createElement(R.a,m()({},this.uploadConfig(),{defaultFileList:s}),s.length>0?null:q.a.createElement(y.a,null,q.a.createElement(H.a,{type:"upload"})," 请上传营业执照(jpg,jpeg,png)"))))),q.a.createElement(h.a,{md:12,sm:24},q.a.createElement(G,{label:"公司名称"},t.getFieldDecorator("companyName",{initialValue:o.companyName,rules:[{required:!0,message:"请输入公司名称！"}]})(q.a.createElement(f.a,{readOnly:!0,placeholder:"请输入",onClick:function(){return e.handleFirmModalVisible(!0)}}))),q.a.createElement(G,{label:"公司联系电话"},t.getFieldDecorator("companyTel",{initialValue:o.companyTel,rules:[{required:!0,message:"请输入公司联系电话！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(G,{label:"地址"},t.getFieldDecorator("addr",{initialValue:o.addr,rules:[{required:!0,message:"请输入地址！"}]})(q.a.createElement(f.a,{placeholder:"请输入"}))),q.a.createElement(G,{label:"经营范围"},t.getFieldDecorator("businessScop",{initialValue:o.businessScop,rules:[{required:!0,message:"请输入经营范围！"}]})(q.a.createElement(f.a.TextArea,{placeholder:"请输入"}))),q.a.createElement(G,{label:"状态"},t.getFieldDecorator("status",{initialValue:o.status,rules:[{required:!0,message:"请选择状态！"}]})(q.a.createElement(_.a.Group,null,$.map(function(e,a){return q.a.createElement(_.a,{value:a+1,key:a},e)})))))))),r?q.a.createElement(U.a,{modalVisible:r,setSelectData:this.setSelectData,handleModalVisible:this.handleFirmModalVisible}):null)}}],[{key:"getDerivedStateFromProps",value:function(e,a){var t=e.detail,l=a.isSet;if(!l){var n=t.companyId,i=t.licenceImg;return{isSet:!l,detail:t,companyId:n,fileList:i?[{uid:"-1",name:"当前图片",status:"done",url:/http/.test(i)?i:z.E+i}]:[]}}return null}}]),a}(I.PureComponent),s.defaultProps={detail:{},modalVisible:!1,handleModalVisible:function(){}},r=o))||r)||r,ae=t("ytuB"),te=t("ns75"),le=t.n(te),ne=t("9zHi"),ie=t.n(ne),re=t("15hv"),se=t.n(re),oe=A.a.Item,ce=T.a.Option,de=["待审核","审核通过","驳回"],me=Object(x.connect)(function(e){return{TransportArchivesLicense:e.TransportArchivesLicense,loading:e.loading.models.TransportArchivesLicense}})(c=A.a.create()(c=function(e){function a(){var e,t;k()(this,a);for(var l=arguments.length,n=new Array(l),i=0;i<l;i++)n[i]=arguments[i];return(t=M()(this,(e=D()(a)).call.apply(e,[this].concat(n)))).state={exportVisible:!1,modalVisible:!1,updateModalVisible:!1,selectedRows:[],formValues:[],detail:{},pageBean:{page:1,pageSize:10,showTotal:!0}},t.columns=[{title:"公司名称",dataIndex:"companyName"},{title:"经营范围",dataIndex:"businessScop",render:function(e){return e.length>10?q.a.createElement(v.a,{title:e},e.substring(0,10),"..."):e}},{title:"地址",dataIndex:"addr"},{title:"证件有效期",dataIndex:"termValidity",width:120,render:function(e){return j()(e).format("YYYY-MM-DD")}},{title:"许可证名称",dataIndex:"licenceName"},{title:"许可证编号",dataIndex:"licenceNo"},{title:"核发机关",dataIndex:"issuingAuth"},{title:"许可证照",dataIndex:"licenceImg",width:110,render:function(e){var a=/http/.test(e)?e:z.E+e;return q.a.createElement("img",{style:{width:90},src:a,alt:"许可证照",onError:function(e){e.target.onerror=null,e.target.src=se.a}})}},{title:"状态",width:90,dataIndex:"status",render:function(e){return de[e-1]}},{title:"操作",width:100,render:function(e,a){return q.a.createElement(I.Fragment,null,q.a.createElement(v.a,{placement:"left",title:"编辑"},q.a.createElement(y.a,{onClick:function(){return t.showDetailModal(a)},type:"primary",shape:"circle",icon:"edit",size:"small"})),q.a.createElement(E.a,{type:"vertical"}),q.a.createElement(b.a,{title:"是否删除数据?",onConfirm:function(){return t.dataDel(a.id_)},okText:"确定",cancelText:"取消"},q.a.createElement(v.a,{placement:"left",title:"删除"},q.a.createElement(y.a,{type:"danger",shape:"circle",icon:"delete",size:"small"}))))}}],t.getList=function(e){(0,t.props.dispatch)({type:"TransportArchivesLicense/fetch",payload:e})},t.showDetailModal=function(e){return t.setState({detail:e},function(){return t.handleUpdateModalVisible(!0)})},t.dataDel=function(e){(0,t.props.dispatch)({type:"TransportArchivesLicense/remove",payload:e,callback:function(){var e=t.state.pageBean;g.a.success("删除成功"),t.getList({pageBean:e})}})},t.handleStandardTableChange=function(e){var a=t.state.formValues,l={pageBean:{page:e.current,pageSize:e.pageSize,showTotal:!0},querys:a};t.getList(l)},t.handleFormReset=function(){var e=t.props.form,a=t.state.pageBean;e.resetFields(),t.setState({formValues:[],selectedRows:[]}),t.getList({pageBean:a})},t.handleSelectRows=function(e){t.setState({selectedRows:e})},t.handleSearch=function(e){e.preventDefault();var a=t.props.form,l=t.state.pageBean;a.validateFields(function(e,a){if(!e){var n={companyName:a.comName,licenceName:a.XKZMC,licenceNo:a.XKZBH,issuingAuth:a.HFJG,status:a.state},i=Object.keys(n).map(function(e){return n[e]?{property:e,value:n[e],group:"main",operation:"status"===e?"EQUAL":"LIKE",relation:"AND"}:""}).filter(function(e){return e});t.setState({formValues:i}),t.getList({pageBean:l,querys:i})}})},t.handleExportVisible=function(e){t.setState({exportVisible:!!e})},t.handleModalVisible=function(e){t.setState({modalVisible:!!e})},t.handleUpdateModalVisible=function(e){t.setState({updateModalVisible:!!e}),e||t.setState({detail:{}})},t.modalCallback=function(){var e=t.state.pageBean;t.getList({pageBean:e})},t}return w()(a,e),C()(a,[{key:"componentDidMount",value:function(){var e=this.state.pageBean;this.getList({pageBean:e})}},{key:"renderSimpleForm",value:function(){var e=this.props.form.getFieldDecorator;return q.a.createElement(A.a,{onSubmit:this.handleSearch,layout:"inline"},q.a.createElement(p.a,{gutter:16},q.a.createElement(h.a,{md:4,sm:24},q.a.createElement(oe,null,e("comName")(q.a.createElement(f.a,{addonBefore:"公司名称",placeholder:"请输入"})))),q.a.createElement(h.a,{md:4,sm:24},q.a.createElement(oe,null,e("XKZMC")(q.a.createElement(f.a,{addonBefore:"许可证名称",placeholder:"请输入"})))),q.a.createElement(h.a,{md:4,sm:24},q.a.createElement(oe,null,e("XKZBH")(q.a.createElement(f.a,{addonBefore:"许可证编号",placeholder:"请输入"})))),q.a.createElement(h.a,{md:4,sm:24},q.a.createElement(oe,null,e("HFJG")(q.a.createElement(f.a,{addonBefore:"核发机关",placeholder:"请输入"})))),q.a.createElement(h.a,{md:4,sm:24},q.a.createElement("div",{className:le.a.inputMain},q.a.createElement("span",{style:{width:"80px",lineHeight:"30px",height:"32px"},className:"ant-input-group-addon"},"状态"),q.a.createElement(oe,{style:{flex:1,flexShrink:0}},e("state")(q.a.createElement(T.a,{placeholder:"请选择",style:{width:"100%"},dropdownMatchSelectWidth:!1},de.map(function(e,a){return q.a.createElement(ce,{value:a+1,key:a},e)})))))),q.a.createElement(h.a,{md:4,sm:24},q.a.createElement("span",{className:ie.a.submitButtons},q.a.createElement(y.a,{type:"primary",htmlType:"submit"},"查询"),q.a.createElement(y.a,{style:{marginLeft:8},onClick:this.handleFormReset},"重置")))))}},{key:"render",value:function(){var e=this,a=this.props,t=a.TransportArchivesLicense.data,l=a.loading,n=this.state,i=(n.selectedRows,n.exportVisible),r=n.modalVisible,s=n.updateModalVisible,o=n.detail,c={modalCallback:this.modalCallback,handleModalVisible:this.handleModalVisible},d={detail:o,modalCallback:this.modalCallback,handleModalVisible:this.handleUpdateModalVisible};return q.a.createElement(I.Fragment,null,q.a.createElement(u.a,{bordered:!1},q.a.createElement("div",{className:ie.a.tableList},q.a.createElement("div",{className:ie.a.tableListForm},this.renderSimpleForm()),q.a.createElement("div",{className:ie.a.tableListOperator},q.a.createElement(y.a,{icon:"plus",type:"primary",onClick:function(){return e.handleModalVisible(!0)}},"新建"),q.a.createElement(y.a,{className:le.a.import,icon:"export",onClick:function(){return e.handleExportVisible(!0)}},"导入")),q.a.createElement(O.a,{rowKey:"id_",size:"middle",tableAlert:!1,selectedRows:0,rowSelection:null,loading:l,data:t,columns:this.columns,onChange:this.handleStandardTableChange}))),q.a.createElement(W,m()({},c,{modalVisible:r})),s&&Object.keys(o).length?q.a.createElement(ee,m()({},d,{modalVisible:s})):null,i&&q.a.createElement(ae.a,{modalVisible:i,path:"/transport/api/tsAdmin/companyLicence/importCompanyLicence",modalCallback:this.modalCallback,handleModalVisible:this.handleExportVisible}))}}]),a}(I.PureComponent))||c)||c;a.default=me}}]);